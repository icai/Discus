var TSINA_FACE_URL_PRE= THEME_SERVER_URL+"/faces/sina/";var TSINA_FACE_TPL="[{{name}}]";
var TSINA_FACES_L={"\u5475\u5475":"smile.gif","\u563b\u563b":"tooth.gif","\u54c8\u54c8":"laugh.gif","\u7231\u4f60":"love.gif","\u6655":"dizzy.gif","\u6cea":"sad.gif","\u998b\u5634":"cz_thumb.gif","\u6293\u72c2":"crazy.gif","\u54fc":"hate.gif","\u62b1\u62b1":"bb_thumb.gif","\u53ef\u7231":"tz_thumb.gif","\u6012":"angry.gif","\u6c57":"sweat.gif","\u56f0":"sleepy.gif","\u5bb3\u7f9e":"shame_thumb.gif","\u7761\u89c9":"sleep_thumb.gif","\u94b1":"money_thumb.gif","\u5077\u7b11":"hei_thumb.gif","\u9177":"cool_thumb.gif",
"\u8870":"cry.gif","\u5403\u60ca":"cj_thumb.gif","\u95ed\u5634":"bz_thumb.gif","\u9119\u89c6":"bs2_thumb.gif","\u6316\u9f3b\u5c4e":"kbs_thumb.gif","\u82b1\u5fc3":"hs_thumb.gif","\u9f13\u638c":"gz_thumb.gif","\u5931\u671b":"sw_thumb.gif","\u601d\u8003":"sk_thumb.gif","\u751f\u75c5":"sb_thumb.gif","\u4eb2\u4eb2":"qq_thumb.gif","\u6012\u9a82":"nm_thumb.gif","\u592a\u5f00\u5fc3":"mb_thumb.gif","\u61d2\u5f97\u7406\u4f60":"ldln_thumb.gif","\u53f3\u54fc\u54fc":"yhh_thumb.gif","\u5de6\u54fc\u54fc":"zhh_thumb.gif",
"\u5618":"x_thumb.gif","\u59d4\u5c48":"wq_thumb.gif","\u5410":"t_thumb.gif","\u53ef\u601c":"kl_thumb.gif","\u6253\u54c8\u6c14":"k_thumb.gif","\u9876":"d_thumb.gif","\u7591\u95ee":"yw_thumb.gif","\u505a\u9b3c\u8138":"zgl_thumb.gif","\u63e1\u624b":"ws_thumb.gif","\u8036":"ye_thumb.gif","good":"good_thumb.gif","\u5f31":"sad_thumb.gif","\u4e0d\u8981":"no_thumb.gif","ok":"ok_thumb.gif","\u8d5e":"z2_thumb.gif","\u6765":"come_thumb.gif","\u86cb\u7cd5":"cake.gif","\u5fc3":"heart.gif","\u4f24\u5fc3":"unheart.gif",
"\u949f":"clock_thumb.gif","\u732a\u5934":"pig.gif","\u8bdd\u7b52":"m_thumb.gif","\u6708\u4eae":"moon.gif","\u592a\u9633":"sun.gif","\u4e0b\u96e8":"rain.gif","\u5496\u5561":"cafe_thumb.gif","\u5e72\u676f":"cheer.gif","\u7eff\u4e1d\u5e26":"green.gif","\u8721\u70db":"candle.gif","\u5fae\u98ce":"wind_thumb.gif","\u6708\u997c":"mooncake3_thumb.gif","\u6ee1\u6708":"moon1_thumb.gif","\u9152\u58f6":"wine_thumb.gif","\u56e2":"tuan_thumb.gif","\u5706":"yuan_thumb.gif","\u5de6\u62b1\u62b1":"left_thumb.gif",
"\u53f3\u62b1\u62b1":"right_thumb.gif","\u4e50\u4e50":"guanbuzhao_thumb.gif","\u56e2\u5706\u6708\u997c":"tuanyuan_thumb.gif","\u5feb\u5feb":"lbq1_thumb.gif","\u7ec7":"zz2_thumb.gif","\u56f4\u89c2":"wg_thumb.gif","\u5a01\u6b66":"vw_thumb.gif","\u7231\u5fc3\u4f20\u9012":"axcd_thumb.gif","\u5965\u7279\u66fc":"otm_thumb.gif","\u56fd\u65d7":"flag_thumb.gif","\u91d1\u724c":"jinpai_thumb.gif","\u94f6\u724c":"yinpai_thumb.gif","\u94dc\u724c":"tongpai_thumb.gif","\u56f4\u8116":"weijin_thumb.gif","\u6e29\u6696\u5e3d\u5b50":"wennuanmaozi_thumb.gif",
"\u624b\u5957":"shoutao_thumb.gif","\u843d\u53f6":"yellowMood_thumb.gif","\u7167\u76f8\u673a":"camera_thumb.gif","\u793c\u7269":"liwu_thumb.gif","v5":"v5_org.gif","\u4e66\u5446\u5b50":"sdz_org.gif","\u7537\u5b69\u513f":"kissboy_org.gif","\u5973\u5b69\u513f":"kissgirl_org.gif","\u98ce\u6247":"fan.gif","\u51b0\u68cd":"ice.gif","\u897f\u74dc":"watermelon.gif","\u7ed9\u529b":"geili_thumb.gif","\u795e\u9a6c":"horse2_thumb.gif","\u6d6e\u4e91":"fuyun_thumb.gif","\u5154\u5b50":"rabbit_thumb.gif","\u7325\u7410":"weisuo_thumb.gif",
"\u6311\u7709":"tiaomei_thumb.gif","\u6311\u9017":"tiaodou_thumb.gif","\u4eb2\u8033\u6735":"qinerduo_thumb.gif","\u5a9a\u773c":"meiyan_thumb.gif","\u5192\u4e2a\u6ce1":"maogepao_thumb.gif","\u56e7\u8033\u6735":"jiongerduo_thumb.gif","\u9b3c\u8138":"guilian_thumb.gif","\u653e\u7535":"fangdian_thumb.gif","\u60b2\u5267":"beiju_thumb.gif","Hi":"hi.gif"};
var TQQ_EMOTIONS_URL_PRE= THEME_SERVER_URL+"/faces/qq/";var TQQ_FACE_TPL="/{{name}}";
var TQQ_EMOTIONS={"\u5fae\u7b11":"face/14.gif","\u6487\u5634":"face/1.gif","\u8272":"face/2.gif","\u53d1\u5446":"face/3.gif","\u5f97\u610f":"face/4.gif","\u6d41\u6cea":"face/5.gif","\u5bb3\u7f9e":"face/6.gif","\u95ed\u5634":"face/7.gif","\u7761":"face/8.gif","\u5927\u54ed":"face/9.gif","\u5c34\u5c2c":"face/10.gif","\u53d1\u6012":"face/11.gif","\u8c03\u76ae":"face/12.gif","\u5472\u7259":"face/13.gif","\u60ca\u8bb6":"face/0.gif","\u96be\u8fc7":"face/15.gif","\u9177":"face/16.gif","\u51b7\u6c57":"face/96.gif",
"\u6293\u72c2":"face/18.gif","\u5410":"face/19.gif","\u5077\u7b11":"face/20.gif","\u53ef\u7231":"face/21.gif","\u767d\u773c":"face/22.gif","\u50b2\u6162":"face/23.gif","\u9965\u997f":"face/24.gif","\u56f0":"face/25.gif","\u60ca\u6050":"face/26.gif","\u6d41\u6c57":"face/27.gif","\u61a8\u7b11":"face/28.gif","\u5927\u5175":"face/29.gif","\u594b\u6597":"face/30.gif","\u5492\u9a82":"face/31.gif","\u7591\u95ee":"face/32.gif","\u5618":"face/33.gif","\u6655":"face/34.gif","\u6298\u78e8":"face/35.gif","\u8870":"face/36.gif",
"\u9ab7\u9ac5":"face/37.gif","\u6572\u6253":"face/38.gif","\u518d\u89c1":"face/39.gif","\u64e6\u6c57":"face/97.gif","\u62a0\u9f3b":"face/98.gif","\u9f13\u638c":"face/99.gif","\u7cd7\u5927\u4e86":"face/100.gif","\u574f\u7b11":"face/101.gif","\u5de6\u54fc\u54fc":"face/102.gif","\u53f3\u54fc\u54fc":"face/103.gif","\u54c8\u6b20":"face/104.gif","\u9119\u89c6":"face/105.gif","\u59d4\u5c48":"face/106.gif","\u5feb\u54ed\u4e86":"face/107.gif","\u9634\u9669":"face/108.gif","\u4eb2\u4eb2":"face/109.gif","\u5413":"face/110.gif",
"\u53ef\u601c":"face/111.gif","\u83dc\u5200":"face/112.gif","\u897f\u74dc":"face/89.gif","\u5564\u9152":"face/113.gif","\u7bee\u7403":"face/114.gif","\u4e52\u4e53":"face/115.gif","\u5496\u5561":"face/60.gif","\u996d":"face/61.gif","\u732a\u5934":"face/46.gif","\u73ab\u7470":"face/63.gif","\u51cb\u8c22":"face/64.gif","\u793a\u7231":"face/116.gif","\u7231\u5fc3":"face/66.gif","\u5fc3\u788e":"face/67.gif","\u86cb\u7cd5":"face/53.gif","\u95ea\u7535":"face/54.gif","\u70b8\u5f39":"face/55.gif","\u5200":"face/56.gif",
"\u8db3\u7403":"face/57.gif","\u74e2\u866b":"face/117.gif","\u4fbf\u4fbf":"face/59.gif","\u6708\u4eae":"face/75.gif","\u592a\u9633":"face/74.gif","\u793c\u7269":"face/69.gif","\u62e5\u62b1":"face/49.gif","\u5f3a":"face/76.gif","\u5f31":"face/77.gif","\u63e1\u624b":"face/78.gif","\u80dc\u5229":"face/79.gif","\u62b1\u62f3":"face/118.gif","\u52fe\u5f15":"face/119.gif","\u62f3\u5934":"face/120.gif","\u5dee\u52b2":"face/121.gif","\u7231\u4f60":"face/122.gif","NO":"face/123.gif","OK":"face/124.gif","\u7231\u60c5":"face/42.gif",
"\u98de\u543b":"face/85.gif","\u8df3\u8df3":"face/43.gif","\u53d1\u6296":"face/41.gif","\u6004\u706b":"face/86.gif","\u8f6c\u5708":"face/125.gif","\u78d5\u5934":"face/126.gif","\u56de\u5934":"face/127.gif","\u8df3\u7ef3":"face/128.gif","\u6325\u624b":"face/129.gif","\u6fc0\u52a8":"face/130.gif","\u8857\u821e":"face/131.gif","\u732e\u543b":"face/132.gif","\u5de6\u592a\u6781":"face/133.gif","\u53f3\u592a\u6781":"face/134.gif","b\u56e7":"cFace/b1.gif","b\u60ca":"cFace/b2.gif","b\u5927\u7b11":"cFace/b3.gif",
"b\u95ea\u7535":"cFace/b4.gif","b\u518d\u89c1":"cFace/b5.gif","b\u4e4c\u9e26":"cFace/b6.gif","b\u53e3\u6c34":"cFace/b7.gif","b\u98de":"cFace/b8.gif","b\u5f97\u610f":"cFace/b9.gif","b\u5403":"cFace/b10.gif","b\u8d70\u7740":"cFace/b11.gif","b\u8def\u8fc7":"cFace/b12.gif","b\u6d41\u6c57":"cFace/b13.gif","c\u7231\u5fc3":"cFace/c1.gif","c\u64e6\u6c57":"cFace/c2.gif","c\u5472\u7259":"cFace/c3.gif","c\u5927\u54ed":"cFace/c4.gif","c\u5927\u7b11":"cFace/c5.gif","c\u53d1\u5446":"cFace/c6.gif","c\u6fc0\u52a8":"cFace/c7.gif",
"c\u53ef\u7231":"cFace/c8.gif","c\u5389\u5bb3":"cFace/c9.gif","c\u6572\u6253":"cFace/c10.gif","c\u8272":"cFace/c11.gif","c\u751f\u6c14":"cFace/c12.gif","c\u8c03\u76ae":"cFace/c13.gif","c\u5077\u7b11":"cFace/c14.gif","c\u5410":"cFace/c15.gif","c\u6447\u5934":"cFace/c16.gif","c\u518d\u89c1":"cFace/c17.gif","c\u6298\u78e8":"cFace/c18.gif","j\u5403\u996d":"cFace/j1.gif","j\u98de\u543b":"cFace/j2.gif","j\u6d6e\u4e91":"cFace/j3.gif","j\u9f13\u638c":"cFace/j4.gif","j\u5bb3\u7f9e":"cFace/j5.gif","j\u56e7":"cFace/j6.gif",
"j\u7ea0\u7ed3":"cFace/j7.gif","j\u5f00\u5fc3":"cFace/j8.gif","j\u54ed\u6ce3":"cFace/j9.gif","j\u665a\u5b89":"cFace/j10.gif","j\u6c57":"cFace/j11.gif","j\u65e0\u5948":"cFace/j12.gif","j\u62db\u624b":"cFace/j13.gif","j\u9707\u60ca":"cFace/j14.gif","j\u5492\u9a82":"cFace/j15.gif"};
var FACE_TYPES = [
	['tsina', TSINA_FACES_L, TSINA_FACE_URL_PRE, TSINA_FACE_TPL, '表情']
	//['tqq', TQQ_EMOTIONS, TQQ_EMOTIONS_URL_PRE, TQQ_FACE_TPL, '腾讯表情']
	];


if ($.browser.msie && parseInt($.browser.version) < 7) {
	try {
		document.execCommand('BackgroundImageCache', false, true);
	} catch (e) {}
}


if ($(document).find('.sex_btn').length) {
	$('.sex_btn').click(function() {
		if ($(this).hasClass('selected')) {
			return false;
		} else {
			$(this).addClass('selected');
			$(this).siblings().removeClass('selected');
			if ($(this).hasClass('women_btn')) {
				$('#is_women').attr('checked', true);
				$('#is_men').attr('checked', false);
			} else {
				$('#is_men').attr('checked', true);
				$('#is_women').attr('checked', false);
			}
		}
	});
}


/*$(selector).getsPos() return{
				sTop:eScreenTop,
				sLeft:eScreeneLeft,
				sWidth:w_width,
				sHeight:w_height,
				top: eTop,
				left: eLeft,
				curPos:curPos
};
$(selector).hoverClass(['hoverclass'[,'selector']]);
$(selector).swapVal(['value']); //for input textarea
$.isScroll([number || string['bottom'||'top']]); return boolen;*/

(function(e) {
	e.fn.hoverDelay = function(t, n, r, i) {
		var r = r || 200,
			i = i || 200,
			n = n || t,
			s = [],
			o = [];
		return this.each(function(u) {
			e(this).mouseenter(function() {
				var e = this;
				clearTimeout(o[u]), s[u] = setTimeout(function() {
					t.apply(e)
				}, r)
			}).mouseleave(function() {
				var e = this;
				clearTimeout(s[u]), o[u] = setTimeout(function() {
					n.apply(e)
				}, i)
			})
		}), this
	}
})(jQuery), function(e) {
	e.fn.ieFixed = function(t) {
		var n = t || 0;
		return this.each(function() {
			var t = e(this),
				r = (new Date).getTime();
			e.browser.msie && parseInt(e.browser.version) == 6 ? (t.css({
				top: n,
				position: "absolute"
			}), e(window).bind("scroll.iefixed" + r, function() {
				var r = e(window).scrollTop();
				t.css({
					top: r + n,
					position: "absolute"
				})
			})) : t.css({
				top: n,
				position: "fixed"
			})
		}), this
	}, e.fn.swapVal = function(t) {
		var n = t || "\u63d0\u793a",
			r = [];
		return this.each(function(t) {
			r[t] = e(this).val(), r[t] == "" && (r[t] = n, e(this).val(r[t])), e(this).focusin(function() {
				e(this).val() == r[t] && e(this).val("")
			}).focusout(function() {
				e.trim(e(this).val()) == "" && e(this).val(r[t])
			})
		}), this
	}, e.fn.hoverClass = function(t) {
		var n = "",
			r = "";
		if(arguments.length > 2) return console.log("[jQuery.hoverClass] arguments.length only allow 2 or less!");
		arguments.length == 2 ? (r = arguments[0], n = arguments[1]) : arguments.length == 1 ? r = arguments[0] : arguments.length == 0 && (r = "hover");
		if(n != "") var i = e(this).find(n);
		else var i = e(this);
		return this.each(function() {
			e(this).hover(function() {
				i.addClass(r)
			}, function() {
				i.removeClass(r)
			})
		})
	}, e.extend({
		isScrollTo: function(t) {
			var n = !1;
			if(arguments.length) {
				var r = arguments[0],
					i = e(window).height(),
					s = e(document).scrollTop(),
					o = e(document).height();
				typeof r == "number" && (n = s >= r);
				if(typeof r == "string") {
					var u = 0;
					if(r == "bottom" || r == "100%") n = s + 10 >= o - i;
					if(r == "top" || r == "0%") n = s == 0;
					/\%$/.test(r) && (u = r.replace(/\%$/, ""), u *= .01, u != NaN && u < 1 && (n = s >= u * (o - i)))
				}
			} else n = s + 10 >= o - i;
			return n
		}
	}), e.fn.extend({
		getsPos: function() {
			if(!this[0]) return null;
			var t = e(this[0]).offset(),
				n = t.top,
				r = t.left,
				i = n - e(window).scrollTop(),
				s = r - e(window).scrollLeft(),
				o = e(window).height(),
				u = e(window).width(),
				a = !1,
				f = !1,
				l = !1,
				c = !1,
				h = 0;
			return o / 2 - i > 0 ? a = !0 : f = !0, u / 2 - s > 0 ? l = !0 : c = !0, a && l && (h = 1), a && c && (h = 2), f && c && (h = 3), f && l && (h = 4), {
				sTop: i,
				sLeft: s,
				sWidth: u,
				sHeight: o,
				top: n,
				left: r,
				curPos: h
			}
		}
	})
}(jQuery);



/* 
 * Scroller
 * author: Marcin Dziewulski
 * web: http://www.jscraft.net
 * email: info@jscraft.net
 * license: http://www.jscraft.net/licensing.html
 */

(function($) {
    $.fn.scroller = function(options) {
        var D = {
            element: 'a',
            direction: 'horizontal',
            container: {
                name: 'inside',
                easing: 'easeOutBack',
                duration: 800
            },
            options: {
                margin: -20,
                zoom: 1.5,
                easing: ['easeOutBack', 'easeOutBounce'],
                duration: [300, 500]
            },
            onclick: function(a, img) {},
            onmouseover: function(a, img) {},
            onmouseout: function(a, img) {}
        } // default settings

        var S = $.extend(true, D, options);

        return this.each(function() {
            var M = $(this),
                IN = M.find('.' + S.container.name),
                E = M.find(S.element),
                P = {
                    init: function() {
                        this._globals.init();
                        this._container.init();
                        this._position.init();
                        this.events.init();
                    },
                    _globals: {
                        init: function() {
                            D = {
                                w: M.width(),
                                h: M.height()
                            }, I = {
                                w: E.width(),
                                h: E.height()
                            }, DIR = S.direction, MW = I.w + S.options.margin, MH = I.h + S.options.margin;
                        }
                    },
                    _container: {
                        init: function() {
                            this.dimensions();
                            this.center();
                        },
                        dimensions: function() {
                            var css = {}
                            if (DIR == 'horizontal') {
                                css.width = E.length * MW;
                            } else if (DIR == 'vertical') {
                                css.height = E.length * MH;
                            }
                            IN.css(css);
                            C = {
                                w: IN.width(),
                                h: IN.height()
                            }
                        },
                        center: function() {
                            var css = {},
                                l = E.length;
                            if (DIR == 'horizontal') {
                                css.left = -(l * MW) / l * 2 - MW / 2;
                            } else if (DIR == 'vertical') {
                                css.top = -(l * MH) / l * 2;
                            }
                            IN.css(css);
                        }
                    },
                    _position: {
                        init: function() {
                            this.set();
                        },
                        set: function() {
                            E.each(function(i) {
                                var t = $(this),
                                    img = t.find('img'),
                                    src = img.attr('src');
                                if (DIR == 'horizontal') {
                                    var x = MW * i,
                                        css = {
                                            left: parseInt(x),
                                            top: 0
                                        }
                                } else if (DIR == 'vertical') {
                                    var y = MH * i,
                                        css = {
                                            left: 0,
                                            top: parseInt(y)
                                        }
                                }
                                css.background = 'url(' + src + ') no-repeat center';
                                img.hide();
                                t.css(css);
                            });
                        }
                    },
                    _helper: {
                        zoomin: function() {
                            var zoom = S.options.zoom,
                                easing = S.options.easing[0],
                                duration = S.options.duration[0],
                                animation = {
                                    width: I.w * zoom,
                                    height: I.h * zoom,
                                    marginLeft: (I.w - I.w * zoom) / 2,
                                    marginTop: (I.h - I.h * zoom) / 2
                                },
                                css = {
                                    zIndex: 10
                                }
                            return {
                                animation: animation,
                                easing: easing,
                                css: css,
                                duration: duration
                            }
                        },
                        zoomout: function() {
                            var easing = S.options.easing[1],
                                duration = S.options.duration[1],
                                animation = {
                                    width: I.w,
                                    height: I.h,
                                    marginLeft: 0,
                                    marginTop: 0
                                },
                                css = {
                                    zIndex: 1
                                }
                            return {
                                animation: animation,
                                easing: easing,
                                css: css,
                                duration: duration
                            }
                        },
                        animate: function(t, o) {
                            t.css(o.css).stop(true, true).animate(o.animation, o.duration, o.easing);
                        }
                    },
                    events: {
                        init: function() {
                            this.hover();
                            this.click();
                        },
                        hover: function() {
                            E.bind('mouseover mouseleave', function(e) {
                                var t = $(this),
                                    img = t.find('img');
                                if (e.type == 'mouseover') {
                                    var h = P._helper.zoomin();
                                    S.onmouseover.call(this, t, img);
                                } else {
                                    var h = P._helper.zoomout();
                                    S.onmouseout.call(this, t, img);
                                }
                                if (!t.hasClass('active')) {
                                    P._helper.animate(t, h);
                                }
                            });
                        },
                        click: function() {
                            E.click(function() {
                                var t = $(this),
                                    img = t.find('img'),
                                    container = S.container,
                                    position = t.position(),
                                    y = position.top,
                                    x = position.left,
                                    animate = {};
                                if (DIR == 'horizontal') {
                                    animate.left = -x + D.w / 2 - MW / 2;
                                } else if (DIR == 'vertical') {
                                    animate.top = -y + D.h / 2 - MH / 2;
                                }
                                if (!t.hasClass('active')) {
                                    var zoomin = P._helper.zoomin(),
                                        zoomout = P._helper.zoomout();

                                    P._helper.animate(E, zoomout);
                                    P._helper.animate(t, zoomin);

                                    E.removeClass('active');
                                    t.addClass('active');
                                }
                                IN.animate(animate, container.duration, container.easing);
                                S.onclick.call(this, t, img);
                                return false;
                            });
                        }
                    }
                }
            P.init();
        });
    };
}(jQuery)); 





define('common', ['jquery', 'init'], function($, FUNLR) {


	FUNLR.namespace('common.Window.center', function(a) {
		return function(obj) {
			var wW = $(window).width(),
				wH = $(window).height(),
				oH = obj.height(),
				oW = obj.width(),
				scrollY = 0;
			if (arguments[1] != undefined) {
				scrollY = arguments[1];
			}
			obj.css({
				position: 'absolute',
				left: (wW - oW) / 2,
				top: (wH - oH) / 2 + scrollY
			})
			return obj;
		}
	})

	FUNLR.namespace('layer', function(a) {
		var b = {
			mask: function() {
				var scrollTop = $('body').scrollTop(),
					winH = $(window).height(),
					winW = $(window).width(),
					docH = Math.max($('body').height(), $(document).height());
				$('<div/>', {
					'style': 'position: absolute;z-index:9999;left:0;top:0px;width:100%;height:' + docH + 'px;background:rgb(0,0,0);',
					'class': 'W_mask'
				}).css({
					opacity: 0.3
				}).appendTo('body')
				return {
					scrollY: scrollTop,
					winH: winH,
					winW: winW
				}
			},
			nomark: function() {
				$('.W_mask').animate({
					"opacity": 0
				}, 600, function() {
					$(this).remove();
				});
			},
			empty: function() {

			}
		}
		return b;
	})

	FUNLR.namespace('string.mintmpl',function(a){


		
		function formatText(msg, values, filter) {
			var pattern = /\{\{([\w\s\.\(\)"',-\[\]]+)?\}\}/g;
			return msg.replace(pattern, function(match, key) {
				var value = values[key] || eval('(values.' + key + ')');
				return jQuery.isFunction(filter) ? filter(value, key) : value;
			});
		}
		String.prototype.format = function(data) {
			return formatText(this, data);
		};
		return formatText;
	})

	/**
	 * FUNLR.string.template
	 * des: 模板引擎
	 * fork: aui-artTemplate
	 * url: http://t.cn/zW7QlML 
	 */
	FUNLR.namespace('string.template',function(a){
		/*artTemplate - Template Engine*/
		var template = function(id, content) {
		        return template[typeof content === 'object' ? 'render' : 'compile'].apply(template, arguments);
		};
		(function(exports, global) {
		    "use strict";
		    exports.version = '1.3.0';
		    exports.openTag = '<%';
		    exports.closeTag = '%>';
		    exports.parser = null;
		    exports.render = function(id, data) {
		        var cache = _getCache(id);
		        if (cache === undefined) {
		            return _debug({
		                id: id,
		                name: 'Render Error',
		                message: 'Not Cache'
		            });
		        }
		        return cache(data);
		    };
		    exports.compile = function(id, source) {
		        var debug = arguments[2];
		        if (typeof source !== 'string') {
		            debug = source;
		            source = id;
		            id = null;
		        }
		        try {
		            var Render = _compile(source, debug);
		        } catch (e) {
		            e.id = id || source;
		            e.name = 'Syntax Error';
		            return _debug(e);
		        }

		        function render(data) {
		            try {
		                return new Render(data).template;
		            } catch (e) {
		                if (!debug) {
		                    return exports.compile(id, source, true)(data);
		                }
		                e.id = id || source;
		                e.name = 'Render Error';
		                e.source = source;
		                return _debug(e);
		            };
		        };
		        render.prototype = Render.prototype;
		        render.toString = function() {
		            return Render.toString();
		        };
		        if (id) {
		            _cache[id] = render;
		        }
		        return render;
		    };
		    exports.helper = function(name, helper) {
		        _helpers[name] = helper;
		    };
		    var _cache = {};
		    var _isNewEngine = ''.trim;
		    var _isServer = _isNewEngine && !global.document;
		    var _keyWordsMap = {};
		    var _forEach = function() {
		            var forEach = Array.prototype.forEach ||
		            function(block, thisObject) {
		                var len = this.length >>> 0;
		                for (var i = 0; i < len; i++) {
		                    if (i in this) {
		                        block.call(thisObject, this[i], i, this);
		                    }
		                }
		            };
		            return function(array, callback) {
		                forEach.call(array, callback);
		            };
		        }();
		    var _create = Object.create ||
		    function(object) {
		        function Fn() {};
		        Fn.prototype = object;
		        return new Fn;
		    };
		    var _helpers = exports.prototype = {
		        $forEach: _forEach,
		        $render: exports.render,
		        $getValue: function(value) {
		            return value === undefined ? '' : value;
		        }
		    };

		    _forEach(('break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if' + ',in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with' + ',abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto' + ',implements,import,int,interface,long,native,package,private,protected,public,short' + ',static,super,synchronized,throws,transient,volatile' + ',arguments,let,yield').split(','), function(key) {
		        _keyWordsMap[key] = true;
		    });

		    var _compile = function(source, debug) {
		            var openTag = exports.openTag;
		            var closeTag = exports.closeTag;
		            var parser = exports.parser;
		            var code = source;
		            var tempCode = '';
		            var line = 1;
		            var uniq = {
		                $out: true,
		                $line: true
		            };
		            var variables = "var $helpers=this," + (debug ? "$line=0," : "");
		            var replaces = _isNewEngine ? ["$out='';", "$out+=", ";", "$out"] : ["$out=[];", "$out.push(", ");", "$out.join('')"];
		            var concat = _isNewEngine ? "if(content!==undefined){$out+=content;return content}" : "$out.push(content);";
		            var print = "function(content){" + concat + "}";
		            var include = "function(id,data){" + "if(data===undefined){data=$data}" + "var content=$helpers.$render(id,data);" + concat + "}";
		            _forEach(code.split(openTag), function(code, i) {
		                code = code.split(closeTag);
		                var $0 = code[0];
		                var $1 = code[1];
		                if (code.length === 1) {
		                    tempCode += html($0);
		                } else {
		                    tempCode += logic($0);
		                    if ($1) {
		                        tempCode += html($1);
		                    }
		                }
		            });
		            code = tempCode;
		            if (debug) {
		                code = 'try{' + code + '}catch(e){' + 'e.line=$line;' + 'throw e' + '}';
		            }
		            code = variables + replaces[0] + code + 'this.template=' + replaces[3];
		            try {
		                var render = new Function('$data', code);
		                var proto = render.prototype = _create(_helpers);
		                proto.toString = function() {
		                    return this.template;
		                };
		                return render;
		            } catch (e) {
		                e.temp = 'function anonymous($data) {' + code + '}';
		                throw e;
		            };

		            function html(code) {
		                line += code.split(/\n/).length - 1;
		                code = code.replace(/('|"|\\)/g, '\\$1').replace(/\r/g, '\\r').replace(/\n/g, '\\n');
		                code = replaces[1] + "'" + code + "'" + replaces[2];
		                return code + '\n';
		            };

		            function logic(code) {
		                var thisLine = line;
		                if (parser) {
		                    code = parser(code);
		                } else if (debug) {
		                    code = code.replace(/\n/g, function() {
		                        line++;
		                        return '$line=' + line + ';';
		                    });
		                }
		                if (code.indexOf('=') === 0) {
		                    code = code.substring(1).replace(/[\s;]*$/, '');
		                    if (_isNewEngine) {
		                        code = '$getValue(' + code + ')';
		                    }
		                    code = replaces[1] + code + replaces[2];
		                }
		                if (debug) {
		                    code = '$line=' + thisLine + ';' + code;
		                }
		                getKey(code);
		                return code + '\n';
		            };

		            function getKey(code) {
		                code = code.replace(/\/\*.*?\*\/|'[^']*'|"[^"]*"|\.[\$\w]+/g, '');
		                _forEach(code.split(/[^\$\w\d]+/), function(name) {
		                    if (/^this$/.test(name)) {
		                        throw {
		                            message: 'Prohibit the use of the "' + name + '"'
		                        };
		                    }
		                    if (!name || _keyWordsMap.hasOwnProperty(name) || /^\d/.test(name)) {
		                        return;
		                    }
		                    if (!uniq.hasOwnProperty(name)) {
		                        setValue(name);
		                        uniq[name] = true;
		                    }
		                });
		            };

		            function setValue(name) {
		                var value;
		                if (name === 'print') {
		                    value = print;
		                } else if (name === 'include') {
		                    value = include;
		                } else if (_helpers.hasOwnProperty(name)) {
		                    value = '$helpers.' + name;
		                } else {
		                    value = '$data.' + name;
		                }
		                variables += name + '=' + value + ',';
		            };
		        };
		    var _getCache = function(id) {
		            var cache = _cache[id];
		            if (cache === undefined && !_isServer) {
		                var elem = document.getElementById(id);
		                if (elem) {
		                    exports.compile(id, elem.value || elem.innerHTML);
		                }
		                return _cache[id];
		            } else if (_cache.hasOwnProperty(id)) {
		                return cache;
		            }
		        };
		    var _debug = function(e) {
		            var content = '[template]:\n' + e.id + '\n\n[name]:\n' + e.name;
		            if (e.message) {
		                content += '\n\n[message]:\n' + e.message;
		            }
		            if (e.line) {
		                content += '\n\n[line]:\n' + e.line;
		                content += '\n\n[source]:\n' + e.source.split(/\n/)[e.line - 1].replace(/^[\s\t]+/, '');
		            }
		            if (e.temp) {
		                content += '\n\n[temp]:\n' + e.temp;
		            }
		            if (global.console) {
		                console.error(content);
		            }

		            function error() {
		                return error + '';
		            };
		            error.toString = function() {
		                return '{Template Error}';
		            };
		            return error;
		        };
		})(template, this);
		return  template;
		// if (typeof module !== 'undefined' && module.exports) {
		//     module.exports = template;
		// }
	})


	



	FUNLR.namespace('string.timeFormatString', function(a) {



		var b = {
			_re: /\{([_yYMdhms]{1,2})(?:\:([\d\w\s]))?\}/g,
			_map: {
				y: ['getYear', 31104000000],
				Y: ['getFullYear', 31104000000, '年前'],
				M: ['getMonth', 2592000000, '个月前'],
				d: ['getDate', 86400000, '天前'],
				h: ['getHours', 3600000, '小时前'],
				m: ['getMinutes', 60000, '分钟前'],
				s: ['getSeconds', 1000, '秒前']
			},
			_units: ['Y', 'M', 'd', 'h', 'm', 's']
		}
		return function(date, ptn, baseTime) {
			try {
				date = date.getTime ? date : (new Date(date));
			} catch (ign) {
				return '';
			}
			var me = b,
				map = me._map,
				unt = me._units,
				rel = false,
				t, delta, v;
			if (!ptn) {
				baseTime = baseTime || new Date();
				delta = Math.abs(date - baseTime);
				for (var i = 0, len = unt.length; i < len; ++i) {
					t = map[unt[i]];
					if (delta > t[1]) {
						return Math.floor(delta / t[1]) + t[2];
					}
				}
				return "刚刚";
			} else {
				return ptn.replace(me._re, function($0, b, c) {
					(rel = b.charAt(0) == '_') && (b = b.charAt(1));
					if (!map[b]) {
						return $0;
					}
					if (!rel) {
						v = date[map[b][0]]();
						b == 'y' && (v %= 100);
						b == 'M' && v++;
						return v < 10 ? a.string.fillLength(v, 2, c) : v.toString();
					} else {
						return Math.floor(Math.abs(date - baseTime) / map[b][1]);
					}
				});
			}
		};
	});

	FUNLR.namespace("extra.textareaUtils", function(a) {
		/*sina*/
		var b = {},
			z = a,
			c = document.selection;
		b.selectionStart = function(a) { //返回选中字符串 开始位置
			if (!c) try {
				return a.selectionStart
			} catch (b) {
				return 0
			}
			var d = c.createRange(),
				e, f, g = 0,
				h = document.body.createTextRange();
			h.moveToElementText(a);
			for (g; h.compareEndPoints("StartToStart", d) < 0; g++)
			h.moveStart("character", 1);
			return g
		};
		b.selectionBefore = function(a) { // 返回选中前的字符串
			return a.value.slice(0, b.selectionStart(a))
		};
		b.selectText = function(a, b, d) { //a::对象   b::开始位置   d::结束位置
			a.focus();
			if (!c) a.setSelectionRange(b, d);
			else {
				var e = a.createTextRange();
				e.collapse(1);
				e.moveStart("character", b);
				e.moveEnd("character", d - b);
				e.select()
			}
		};
		b.insertText = function(a, d, e, f) { //(obj, insertstring, 位置, 0)
			a.focus();
			f = f || 0;
			if (!c) {
				var g = a.value,
					h = e - f,
					i = h + d.length;
				a.value = g.slice(0, h) + d + g.slice(e, g.length);
				b.selectText(a, i, i)
			} else {
				var j = c.createRange();
				j.moveStart("character", -f);
				j.text = d;
				j.select();
			}
		};
		b.insertAtCursor = function(el, val) {
			if (c) { //ie
				el.focus();
				sel = c.createRange();
				sel.text = val;
				sel.select();
			} else if (el.selectionStart || el.selectionStart == '0') {
				var sPos = el.selectionStart;
				var ePos = el.selectionEnd;
				var restoreTop = el.scrollTop;
				el.value = el.value.substring(0, sPos) + val + el.value.substring(ePos, el.value.length);
				if (restoreTop > 0) {
					el.scrollTop = restoreTop;
				}
				el.focus();
				el.selectionStart = sPos + val.length;
				el.selectionEnd = sPos + val.length;
			} else {
				el.value += val;
				el.focus();
			}
		};
		b.replaceText = function(a, d) { //a::对象  d::替换选中的文本
			a.focus();
			var e = a.value,
				f = b.getSelectedText(a),
				g = f.length;
			if (f.length == 0) b.insertText(a, d, b.getCursorPos(a));
			else {
				var h = b.getCursorPos(a);
				if (!c) {
					var j = h + f.length;
					a.value = e.slice(0, h) + d + e.slice(h + g, e.length);
					b.setCursor(a, h + d.length);
					return
				}
				var i = c.createRange();
				i.text = d;
				b.setCursor(a, h + d.length)
			}
		};
		b.getCursorPos = function(a) { //a::对象
			var b = 0;
			if (z._ms_) {
				a.focus();
				var d = null;
				d = c.createRange();
				var e = d.duplicate();
				e.moveToElementText(a);
				e.setEndPoint("EndToEnd", d);
				a.selectionStart = e.text.length - d.text.length;
				a.selectionEnd = a.selectionStart + d.text.length;
				b = a.selectionStart
			} else if (a.selectionStart || a.selectionStart == "0") b = a.selectionStart;
			return b
		};
		b.getSelectedText = function(a) { // a :: 对象
			var b = "",
				d = function(a) {
					return a.selectionStart != undefined && a.selectionEnd != undefined ? a.value.substring(a.selectionStart, a.selectionEnd) : ""
				};
			window.getSelection ? b = d(a) : b = c.createRange().text;
			return b
		};
		b.setCursor = function(a, b, c) { // a :: 对象,b::开始,c::结束 
			b = b == null ? a.value.length : b;
			c = c == null ? 0 : c;
			a.focus();
			if (a.createTextRange) {
				var d = a.createTextRange();
				d.move("character", b);
				d.moveEnd("character", c);
				d.select()
			} else a.setSelectionRange(b, b + c)
		};
		b.unCoverInsertText = function(a, b, c) { // a:: 对象 b::string  c :: {rcs:8,rccl:1}
			c = c == null ? {} : c;
			c.rcs = c.rcs == null ? a.value.length : c.rcs * 1;
			c.rccl = c.rccl == null ? 0 : c.rccl * 1;
			var d = a.value,
				e = d.slice(0, c.rcs),
				f = d.slice(c.rcs + c.rccl, d == "" ? 0 : d.length);
			a.value = e + b + f;
			this.setCursor(a, c.rcs + (b == null ? 0 : b.length))
		};
		return b
	});



	FUNLR.namespace("common.textarea.range", function(a) {
		var m = a.extra.textareaUtils;
		var cacheCurPos = function(obj) {
				var b = m.getSelectedText(obj[0]),
					c = b == "" || b == null ? 0 : b.length,
					d = m.getCursorPos(obj[0]),
					f = d + "|" + c;
				obj.attr('range', f);
			}
		var countCharctor = function(obj) {
				var max_num = 240;
				var limit = max_num - obj.val().length,
					maxval = obj.val().substr(0, 240);
				if (limit < 0) {
					$(obj).val(maxval);
					limit = 0;
				}
			}
		$(document).on("click focus keyup select", "textarea", function() {
			var that = $(this);
			cacheCurPos(that);
		}).on('keydown keyup', "textarea", function() {
			var that = $(this);
			countCharctor(that);

		});
		var getCurPos = function(obj) {
				var a = obj.attr("range") || "0|0";
				return a.split("|")
			};
		return {
			getCurPos: getCurPos
		}
	});


/**
 * namespace: FUNLR.fn
 * 
 * des: 抽象性功能模块
 *
 * ::{
 *   docfire:'docuemnt事件触发',
 *   json2str:'json转string',
 *   triggerwin：'触发A标签',
 *   DateFormat:'日期格式化',
 *   \*filter\*:'数据过滤',
 *   imgReady:'图片预加载::fork form planeArt http://t.cn/S4jXb4 ',
 *   getzoomSize:'图片缩放' 
 * }
 */

	FUNLR.namespace('fn.docfire',function(a){
        return function(hidelist,callback){
        	var plist = typeof hidelist == "string" ? hidelist.split(0) : hidelist;
	        function checkin(etg,list){ 
	            var k = 1,p = list;
	            for (var i = 0; i < p.length; i++) {
	                var nodelist = !$(etg.target).closest(p[i]).length;
	                if(!nodelist){
	                    return 0;
	                }
	                k = nodelist && k; 
	            };
	           return k;
	        }
	        var time = (new Date).getTime();
	        var hash = 'mouseup.'+time;
	        $(document).bind(hash,function(e) {
	            var ev = e;
	            if (checkin(ev,plist)) {
	            	if(typeof callback != undefined && a.isFunction(callback)){
	            			callback.call(null,hash);
	            	}else{
	            		for (var i = 0; i < plist.length; i++) {
	            			$(plist[i]).hide();
	            		};
	            	}
	            }
	        }) 	
        }
	})

	FUNLR.namespace('fn.json2str', function(a) {
		return function(e) {
			var t = this;
			switch (typeof e) {
			case "string":
				return '"' + e.replace(/(["\\])/g, "\\$1") + '"';
			case "array":
				return "[" + e.map(t.json2str).join(",") + "]";
			case "object":
				if (e instanceof Array) {
					var n = [],
						r = e.length;
					for (var i = 0; i < r; i++) n.push(t.json2str(e[i]));
					return "[" + n.join(",") + "]"
				}
				if (e == null) return "null";
				var s = [];
				for (var o in e) s.push(t.json2str(o) + ":" + t.json2str(e[o]));
				return "{" + s.join(",") + "}";
			case "number":
				return e;
			case !1:
				return e
			}
		}
	})


	FUNLR.namespace('fn.triggerwin',function(a){
		return function(el){

			function wopen(link,type){

				if(type == '_seft'){
					top.location.replace(link);
				}else{
					window.open(link,type);
				}
			}
			var link = el.attr('href'),
				type = el.attr('target') || '_seft';
				wopen(link,type);
		}
	})


	FUNLR.namespace('fn.DateFormat', function(a) {
		var timeFormatString = a.string.timeFormatString;
		return function(time) {
			var tmp, _t, td = new Date(),
				nowt = new Date(),
				d = 3600 * 24 * 1000,
				fix8 = 3600 * 8 * 1000;
			var _nt = new Date().getTime(),
				_t = time * 1000,
				nyear, tyear;
			nowt.setTime(_nt);
			td.setTime(time * 1000);
			nyear = nowt.getFullYear();
			tyear = td.getFullYear();
			_t = Math.floor(((_nt + fix8) / d) - Math.floor((_t + fix8) / d));
			if (_t < 1) {
				tmp = timeFormatString(td, " {h}:{m}");
			} else if (_t < 2) {
				tmp = "昨天" + timeFormatString(td, " {h}:{m}");
			} else if (_t < 3) {
				tmp = "前天" + timeFormatString(td, " {h}:{m}");
			} else if (nyear != tyear) {
				tmp = timeFormatString(td, "{Y: }年{M: }月{d: }日").replace(/\s/g, "") + timeFormatString(td, " {h}:{m}");
			} else {
				tmp = timeFormatString(td, "{M: }月{d: }日").replace(/\s/g, "") + timeFormatString(td, " {h}:{m}");
			}
			return tmp;
		}
	})


	FUNLR.namespace('fn.filter', function(a) { // 
		return function(j, key, val) {
			if (j.length == undefined) {
				return;
			}
			var len = j.length,
				tmplarr = [];
			for (var i = 0; i < len; i++) {
				if (j[i][key].indexOf(val) != -1) {
					tmplarr.push(j[i])
				}
			}
			return tmplarr;
		}
	})

	FUNLR.namespace('fn.nocasefilter', function(a) { // 
		return function(j, key, val) {
			if (j.length == undefined) {
				return;
			}
			var len = j.length,
				tmplarr = [];
			for (var i = 0; i < len; i++) {
				if (j[i][key].toLowerCase().indexOf(val.toLowerCase()) != -1) {
					tmplarr.push(j[i])
				}
			}
			return tmplarr;
		}
	})


	FUNLR.namespace('fn.unfilter', function(a) {
		return function(j, key, val) {
			if (j.length == undefined) {
				return;
			}
			var len = j.length,
				tmplarr = [];
			for (var i = 0; i < len; i++) {
				if (j[i][key].indexOf(val) == -1) {
					tmplarr.push(j[i])
				}
			}
			return tmplarr;
		}
	})
	FUNLR.namespace('fn.unfilters', function(a) {
		return function(j, key, val) {
			if (j.length == undefined) {
				return;
			}
			if (typeof val == "string") {
				val = val.split(0);
			}
			if (!val.length) {
				return j;
			}
			var tmplarr = [];
			while (val.length) {
				var k = val.shift();
				var len = j.length;
				for (var i = 0; i < len; i++) {
					if (j[i][key] != k) {
						tmplarr.push(j[i])
					}
				}
				j = tmplarr;
			}
			return tmplarr;
		}
	})

	FUNLR.namespace('fn.nocaseunfilters', function(a) {
		return function(j, key, val) {
			if (j.length == undefined) {
				return;
			}
			if (typeof val == "string") {
				val = val.split(0);
			}
			if (!val.length) {
				return j;
			}
			var tmplarr = [];
			while (val.length) {
				var k = val.shift();
				var len = j.length;
				for (var i = 0; i < len; i++) {
					if (j[i][key] != k) {
						tmplarr.push(j[i])
					}
				}
				j = tmplarr;
			}
			return tmplarr;
		}
	})


	FUNLR.namespace('fn.getOriginalSizeOfImg', function(a) {
		return function(obj) {
			var t = new Image();
			t.src = (obj.getAttribute ? obj.getAttribute("src") : false) || obj.src;
			var width, height;
			width = t.width, height = t.height;
			if(t.complete){
				width = t.width, height = t.height;
			}
			return {
				width: width,
				height: height
			};
		}
	})

	FUNLR.namespace('fn.imgReady',function(){
		var imgReady = (function () {
			var list = [],
			intervalId = null,
			tick = function () {
				var i = 0;
				for (; i < list.length; i++) {
					list[i].end ? list.splice(i--, 1) : list[i]();
				};
				!list.length && stop();
			},
			stop = function () {
				clearInterval(intervalId);
				intervalId = null;
			};
			return function (url, ready, load, error) {
				var onready,
				width,
				height,
				newWidth,
				newHeight,
				img = new Image();
				img.src = url;
				if (img.complete) {
					ready.call(img);
					load && load.call(img);
					return;
				};
				width = img.width;
				height = img.height;

				img.onerror = function () {
					error && error.call(img);
					onready.end = true;
					img = img.onload = img.onerror = null;
				};
				onready = function () {
					newWidth = img.width;
					newHeight = img.height;
					if (newWidth !== width || newHeight !== height || newWidth * newHeight > 1024) {
						ready.call(img);
						onready.end = true;
					};
				};
				onready();
				img.onload = function () {
					!onready.end && onready();
					load && load.call(img);
					img = img.onload = img.onerror = null;
				};
				if (!onready.end) {
					list.push(onready);
					if (intervalId === null)
						intervalId = setInterval(tick, 40);
				};
			};
		})();
		return imgReady;
	})

	FUNLR.namespace('fn.getzoomSize', function(a) {

		var b = function(_w, _h,_mw,_mh) {
				var MAX_W = _mw ||450;
				var MAX_H = _mh ||600;
				var precent = MAX_W/MAX_H;
				var w = _w;
				var h = _h;
                if (w <= 0 || h <= 0) {
                	throw new TypeError("no height or width ");
                }
				if (w <= MAX_W) {
					return {
						width: w * 1,
						height: h * 1
					};
				}

				if(w > MAX_W){
					var zoom = MAX_W / w;
					return {
						width: w * zoom,
						height: h * zoom
					}
				}
			}

		var _b = b;	
		return b
	});
	/**
	 * FUNLR.face
	 * des: 系统表情
	 * fork：FaWave
	 * url: http://t.cn/hGUog4
	 */
	FUNLR.namespace('face', function(a) {
		var m = a.extra.textareaUtils,
			k = a.common.textarea.range;
		var b = {
			show: function(ele, target_id) {
				$('#'+target_id).focus();
				var opos = $(ele).getsPos();
				var f = $("#face_box");
				if (f.css('display') !== 'none' && $("#face_box_target_id").val() === target_id) {
					f.hide();
					return;
				}
				if ($('#face_box .faceItemPicbg .face_icons').length === 0) {
					var blogTypes = {
						tsina: 1,
						tqq: 1
					};
					for (var i = 0, len = FACE_TYPES.length; i < len; i++) {
						var face_type = FACE_TYPES[i];
						if (!blogTypes[face_type[0]]) {
							continue;
						}
						var $face_tab = $('<span face_type="' + face_type[0] + '">' + face_type[4] + '</span>');
						$face_tab.click(function() {
							var $this = $(this);
							if (!$this.hasClass('active')) {
								$('.face_tab span').removeClass('active');
								$('#face_box .faceItemPicbg .face_icons').hide();
								$('#face_box .faceItemPicbg .' + $this.attr('face_type') + '_faces').show();
								$this.addClass('active');
							}
						});
						var $face_icons = $('<div style="display:none;" class="face_icons ' + face_type[0] + '_faces"></div>');
						$('#face_box .face_tab p').append($face_tab);
						$('#face_box .faceItemPicbg').append($face_icons);
						var exists = {};
						$('#face_icons li a').each(function() {
							exists[$(this).attr('title')] = true;
						});
						var face_tpl = face_type[3];
						var faces = face_type[1];
						if (face_tpl) {
							var tpl = '<li><a href="javascript:void(0)" onclick="FUNLR.face.insert(this)"' + ' value="' + face_tpl + '" title="{{name}}"><img src="{{url}}" alt="{{name}}"></a></li>';
							var url_pre = face_type[2];
							for (var name in faces) {
								if (exists[name]) continue;
								$face_icons.append(tpl.format({
									'name': name,
									'url': url_pre + faces[name]
								}));
								exists[name] = true;
							}
						} else {
							var tpl = '<li class="yanwenzi"><a href="javascript:void(0)" onclick="FUNLR.face.insert(this)"' + ' value="{{name}}" title="{{title}}">{{name}}</a></li>';
							for (var name in faces) {
								$face_icons.append(tpl.format({
									'name': name,
									'title': faces[name]
								}));
							}
						}
					}
					var current_blogtype = 'tsina'; //getUser().blogType;
					var $selected = $("#accountsForSend li.sel");
					if ($selected.length > 1) {
						current_blogtype = 'yanwenzi';
					} else if ($selected.length === 1) {
						current_blogtype = $selected.attr('blogType');
					}
					var $face_type_tab = $('#face_box .face_tab span[face_type="' + current_blogtype + '"]');
					if ($face_type_tab.length === 0) {
						$face_type_tab = $('#face_box .face_tab span[face_type="yanwenzi"]');
					}
					$face_type_tab.click();
				}
				$("#face_box_target_id").val(target_id);
				var elwidth = $(ele).innerWidth(),
					elheight = $(ele).innerHeight();
					elheight = elheight > 20 ? 22 : 16
	
				var arrow_array = ['layerArrow_topleft','layerArrow_topright','layerArrow_bottomright','layerArrow_bottomleft'],
					arrow_tar;

				var popSize = {
					width:470,
					height:278
				};
				var cssparam = {};
				if(opos.curPos == 1) {//左上
					cssparam = {
						top:  opos.top + 8 + elheight,
						left: opos.left - 40 - 8 + elwidth / 2,
						position: 'absolute'
					};
					arrow_tar = arrow_array[0];

				};
				if(opos.curPos == 2) { //右上
					cssparam = {
						top: opos.top + 8 + elheight,
						left: opos.left + 40 + 16 - popSize.width,
						position: 'absolute'
					};
					arrow_tar = arrow_array[1];
				}
				if(opos.curPos == 3){ //右下
					cssparam = {
						top: opos.top - 8 - popSize.height,
						left: opos.left + 40 + 16 - popSize.width,
						position: 'absolute'	
					};
					arrow_tar = arrow_array[2];
				}
				if(opos.curPos == 4){ // 左下
					cssparam = {
						top: opos.top - 8 - popSize.height,
						left: opos.left - 40 - 8 + elwidth / 2,
						position: 'absolute'					
					};
					arrow_tar = arrow_array[3];
				}

				f.attr('style','').css(cssparam).show();
				f.find('.layerArrow').removeAttr('class').addClass('layerArrow').addClass(arrow_tar);
			},
			hide: function() {
				$("#face_box").hide();
				$("#face_box_target_id").val('');
			},
			insert: function(ele) {
				var $target_textbox = $("#" + $("#face_box_target_id").val());
				if ($target_textbox.length === 1) {
					var tb = $target_textbox[0],u
						str = $(ele).attr('value');
					var pos = k.getCurPos($target_textbox);
					var end = pos[0] * 1 + pos[1] * 1;

					if (pos[1] > 0) {
						m.selectText(tb, pos[0], end)
						m.replaceText(tb, str);
						$target_textbox.focus();
					} else {
						var p = m.getCursorPos(tb)
						m.insertText(tb, str, p, 0)
						$target_textbox.focus();
						//m.setCursor(tb,m.getCursorPos(tb)+str.length);
					}
					if($target_textbox.attr('id') == 'txtContent'){
						$('.cnt_publish').addClass('onpublish');
					} 
				}
				this.hide();
			},
			format: function(text) {
				var fn = this,
					retxt;
				if ($.trim(text) == '') {
					return '';
				}
				retxt = text.replace(/\[([\w\u4e00-\u9fa5]+)\]/g, function($0, $1) {
					var tpl = "",
						url;
					for (x in TSINA_FACES_L) {
						if (x == $1) {
							url = TSINA_FACES_L[x];
						}
					}
					tpl = !! url ? '<img src="' + TSINA_FACE_URL_PRE + url + '" alt="[' + $1 + ']">' : $0;
					return tpl;
				})
				return retxt;
			},
			reformat: function(text){
				var t = text;
				t  = t.toLowerCase().replace(/\<[^\<\[]+(\[[^\]]+\])[^\>]*\>/g,function(a,$1){return $1})
				return t;
			}
		};
		a.fn.docfire('#face_box',function(){
			b.hide();
		});

		return b;
	});


	FUNLR.extend('string', {
		fillLength: function(a) {
			return function(source, l, ch, isRight) {
				if ((source = String(source)).length < l) {
					var ar = new Array(l - source.length);
					ar[isRight ? 'unshift' : 'push'](source);
					source = ar.join(ch || '0');
				}
				return source;
			}
		},
		bLength: function(a) {
			return function(a) {
				if (!a) return 0;
				var b = a.match(/[^\x00-\xff]/g);
				return a.length + (b ? b.length : 0)
			}
		},
		cLength: function(a) {
			var b = a.string.bLength,
				c;
			return function(a) {
				c = b(a);
				return c / 2
			}
		}
	});

	FUNLR.namespace('common.unit.copyStyle', function(a) {
		return function(source,str) {
			var style = {};
			if(str){
				var cstyle = str.split('|');

				for (var i = 0; i < cstyle.length; i++) {
					style[cstyle[i]] = source.css(cstyle[i]);
				};
			}else{

				style = a.common.unit.copyCSS(source);
			}

			return style;
		};
	})
	FUNLR.namespace('common.unit.copyCSS', function(a) {
		return function(source) {
			var dom = source.get(0);
			var style;
			var dest = {};
			if (window.getComputedStyle) {
				var camelize = function(a, b) {
						return b.toUpperCase();
					};
				style = window.getComputedStyle(dom, null);
				for (var i = 0, l = style.length; i < l; i++) {
					var prop = style[i];
					var camel = prop.replace(/\-([a-z])/g, camelize);
					var val = style.getPropertyValue(prop);
					dest[camel] = val;
				};
				return dest;
			};

			if (style = dom.currentStyle) {
				for (var prop in style) {
					dest[prop] = style[prop];
				};
				return dest;
			};
			if (style = dom.style) {
				for (var prop in style) {
					if (typeof style[prop] != 'function') {
						dest[prop] = style[prop];
					};
				};
			};
			return dest;
		};
	})
	FUNLR.namespace('common.unit.cloneEl', function(a) {
		var b = a.common.unit.copyStyle;
		return function(source, target,str) {
			var sc = b(source,str),
				tg = $('<' + target + '/>').css(sc);
			return tg;
		};
	})

	FUNLR.namespace('common.animate', function(a) {
		var b = {};
		b.shineColor = function(obj,colorQ) {
			var colorQueue = colorQ || ['#fcc', '#fff'];
			colorQueue = colorQueue.concat(colorQueue);
			while (colorQueue.length) {
				obj.animate({
					backgroundColor: colorQueue.shift()
				}, 200)
			}
		};
		b.twinkling = b.shineColor;
		b.shake = function(id, callback) {
			var callback = callback;
			var _shakeing = function(id, pos) {
					(typeof id == "string" || typeof id.length == "undefined") && (id = $(id));
					var curleft = parseInt($(id).css('left')) || 0;
					id.css('left', curleft + pos + 'px');
				};
			var _shake = function(id, a, d) {
					c = a.shift();
					_shakeing(id, c);
					if (a.length > 0) {
						setTimeout(function() {
							_shake(id, a, d);
						}, d);
					} else {
						setTimeout(callback, 200);
					}
				};

			var p = new Array(15, 30, 15, 0, -15, -30, -15, 0);
			p = p.concat(p.concat(p));
			_shake(id, p, 20);
		}
		return b;
	})


	FUNLR.namespace('UI.pop.tips',function(a){

		var poptips = {
			exm_info: function(tips) {
				var defaultval = '不期待的默认提示!';
				if (arguments.length) {
					defaultval = arguments[0];
				}
				var exm_info_tip = '<div class="pop_common exm_info_tip">' + '<div class="pop_commom_main exm_info_tip_main clearfix">' + '<span>' + defaultval + '</span>' + '</div></div>';
				return exm_info_tip;
			},
			sur_info: function(tips) {
				var defaultval = '成功的默认提示!';
				if (arguments.length) {
					defaultval = arguments[0];
				}
				var sur_info_tip = '<div class="pop_common sur_info_tip">' + '<div class="pop_commom_main sur_info_tip_main clearfix">' + '<span>' + defaultval + '</span>' + '</div></div>';
				return sur_info_tip;
			},
			exm_ch: function(val) {
				$('body').find('.exm_info_tip').find('span').text(val);
			},
			sur_ch: function(val) {
				$('body').find('.sur_info_tip').find('span').text(val);
			},
			isvisible: function(obj) {
				return $(obj).is(':visible');
			}
		}

		/**
		 * [uiPoptips description]
		 * @param  {[string]} str [提示内容]
		 * @param  {[object||string]} obj [定位对象]
		 * @param  {[string]} typ [提示内容类型：'sur'||['exm']]
		 * @param  {[number]} x   [定位对象偏移x]
		 * @param  {[number]} y   [定位对象偏移y]
		 */
		var uiPoptips = function(param) {

				var defval = "请输入提示值！",
					vObj, $this, stype, offx = 0,
					offy = 0;
				if (arguments[0] == "undefined" || arguments[0] == null) {
					return console.log('uiPoptips::str::' + arguments[0]);
				} else {
					defval = arguments[0];
				}

				if (arguments[1] == "undefined" || arguments[1] == null) {
					return console.log('uiPoptips::obj::' + arguments[1]);
				} else {
					vObj = arguments[1];
					if (typeof vObj == "string" || typeof vObj.length == "undefined") {
						vObj = $(vObj);
					}
				}

				if (arguments[2] == "undefined" || arguments[2] == null || typeof arguments[2] == "number" || arguments[2] == "sur") {
					stype = "sur";
				} else if (arguments[2] == "exm") {
					stype = "exm";

				} else {
					console.log('uiPoptips::obj::' + arguments[2]);
					return;
				}

				if (arguments.length >= 3 && typeof arguments[2] == "number") {
					offx = arguments[2] || 0;
					offy = arguments[3] || 0;
				} else if (typeof arguments[2] == "string") {
					offx = arguments[3] || 0;
					offy = arguments[4] || 0;
				}
				var iPos = vObj.offset();

				if ($('.' + stype + '_info_tip').length) {
					poptips[stype + '_ch'](defval);
					$('.' + stype + '_info_tip').css({
						'position': 'absolute',
						'left': iPos.left + offx + 'px',
						'top': iPos.top + offy + 'px'
					}).fadeIn(200).delay(1000).fadeOut(200);
				} else {
					a.fn.loadCss('widget',function(){
						var ztips = poptips[stype + '_info'](defval);
						$(ztips).css({
							'position': 'absolute',
							'left': iPos.left + offx + 'px',
							'top': iPos.top + offy + 'px',
							'z-index': '10020'
						}).appendTo('body').fadeIn(200).delay(1000).fadeOut(200);
					});
				}
			};

		(function(global){
			global.uiPoptips = uiPoptips
		})(window);

		return function(param){
			var defOpts = {
				tips:'提示信息',
				type:'sur', // || 'exm'
				obj: $(body),
				left:0,
				top:0
			};
			var opts = $.extend(defOpts,param,{});
			uiPoptips(opts.tips,opts.obj,opts.type,opts.left,opts.top);
		}
	});

	FUNLR.namespace('UI.pop.ANW', function(a) {
		return function(option) {
			var defOpt = {
				left: 0,
				top: 0,
				zIndex: 10001,
				tips: "默认提示",
				sure: function() {},
				cancel: function() {}
			}
			$.extend(defOpt, option,{});
			var outer, inner, btnplate;
			outer = $('<div/>', {
				'class': 'pop_common ans_info_tip',
				'style': 'position:absolute;left:' + defOpt.left + 'px;top:' + defOpt.top + 'px;z-index:' + defOpt.zIndex
			});
			inner = $('<div/>', {
				'class': 'pop_commom_main ans_info_tip_main clearfix'
			}).appendTo(outer);
			$('<span/>').text(defOpt.tips).appendTo(inner);
			btnplate = $('<p/>').appendTo(inner);
			$('<a/>', {
				'href': "javascript:;",
				'alt': "确定",
				'class': 'ans_info_btn_sur',
				'html': '<span>确定</span>'
			}).appendTo(btnplate).click(function() {
				$('.ans_info_tip').fadeOut(600).remove();
				defOpt.sure();
			})
			$('<a/>', {
				'href': "javascript:;",
				'alt': "取消",
				'class': 'ans_info_btn_cansl',
				'html': '<span>取消</span>'
			}).appendTo(btnplate).click(function() {
				$('.ans_info_tip').fadeOut(600).remove();
				defOpt.cancel();
			});
			outer.appendTo('body').hide().fadeIn(800);
		}
	})

FUNLR.namespace("API",function(e){var t={Index:{publish:"/fun/publish",updatetips:"/fun/get_new_count",updatelist:"/fun/get_new_list",grouplist:"/friends/ajax_get_group_list",allfriends:"/friends/get_all_my_friends",settimes:"/timeasix/get_time_list",fun:{getone:"/fun/get_fun_info",list:"/fun/get_fun_list",loading:"/fun/loading",transmit:"/fun/forward",commment:"/fun/comment",commentlist:"/fun/get_comment_list",commentchildlist:"/fun/get_comment_child_list",emocom:"/fun/add_express",delcomment:"/fun/del_comment",delchildcomment:"/fun/del_comment_child",del:"/fun/del",addemo:"/fun/add_express",atme:"/friends/search_by_name"},recStatic:{mlist:"/mood/get_list",add:"/mood/add",lastMood:"/mood/get_current_mood",moodById:"/mood/get_mood_by_id",moodcmt:"/mood/comment"}},Message:{tipsCount:"/message/count",tipsgetAll:"/message/get_all",noticelist:"/message/get_notice_list",atmelist:"/fun/at_me",commentlist:"/fun/get_my_fun_has_comment"},Friend:{reqpop:"/friends/show_request_user_card",frireq:"/friends/send_friend_request",scard:"/friends/pop_user_card",getgrlist:"/friends/pop_add_friend_to_groups",addgroup:"/friends/add_group",accNigfreq:"/friends/pass_apply_friend",delfriend:"/friends/del",delfriendFgroup:"/friends/del_to_group",dropfriend:"/friends/add_many_friend_to_groups",cgroupNaddfri:"/friends/create_group_and_add_friends",delgroup:"/friends/del_group_by_id",getgroupfriends:"/friends/get_friends_list_by_group",updategroup:"/friends/update_group_name_by_id"}};return t})
FUNLR.extend("ajax.request",{funload:function(e){return function(t,n){$.ajax({url:e.API.Index.fun.loading,type:"POST",dataType:"json",async:!1,data:{lasttime:t},success:function(e){n.call(this,e)}})}},tipsCount:function(e){return function(t,n){$.post(e.API.Message.tipsCount,{type:t},function(e){n.call(this,e)},"text")}},delcomment:function(e){return function(t,n){$.post(e.API.Index.fun.delcomment,{uid:userconfig.uid,id:t},function(e){n.call(this,e)},"text")}},delchildcomment:function(e){return function(t,n){$.post(e.API.Index.fun.delchildcomment,{uid:userconfig.uid,id:t},function(e){n.call(this,e)},"text")}},settimes:function(e){return function(){$.post(e.API.Index.settimes,{},function(e){callback.call(this,e)},"json")}},updateTips:function(e){return function(t,n){jQuery.post(e.API.Index.updatetips,{timenum:t},function(e){e>0&&n.call(this,e)})}},updateList:function(e){return function(t,n){jQuery.post(e.API.Index.updatelist,{timenum:t},function(e){e&&n.call(this,e)},"json")}},frireq:function(e){return function(t,n,r){jQuery.post(e.API.Friend.frireq,{friendId:t,groupId:n},function(e){r.call(this,e)},"json")}},scard:function(e){return function(t,n){jQuery.post(e.API.Friend.scard,{friendId:t},function(e){n.call(this,e)},"html")}},getgrlist:function(e){return function(t,n,r){jQuery.post(e.API.Friend.getgrlist,{friendsId:t,accept:n},function(e){r.call(this,e)},"html")}},addgroup:function(e){return function(t,n){jQuery.post(e.API.Friend.addgroup,{groupName:t},function(e){n.call(this,e)},"text")}},ignorefreq:function(e){return function(t,n){jQuery.post(e.API.Friend.accNigfreq,{uid:userconfig.uid,id:t},function(e){n.call(this,e)},"text")}},acceptfreq:function(e){return function(t,n,r){jQuery.post(e.API.Friend.accNigfreq,{uid:userconfig.uid,id:t,state:1,groupIds:n},function(e){r.call(this,e)},"text")}},moodcmt:function(e){return function(t,n,r){jQuery.post(e.API.Index.recStatic.moodcmt,{mid:t,content:n},function(e){r.call(this,e)},"text")}},delfriend:function(e){return function(t,n){jQuery.post(e.API.Friend.delfriend,{friendIds:t},function(e){n.call(this,e)},"text")}},delfriendFgroup:function(e){return function(t,n,r){jQuery.post(e.API.Friend.delfriendFgroup,{friendIds:t,groupId:n},function(e){r.call(this,e)},"text")}},dropfriend:function(e){return function(t,n,r){jQuery.post(e.API.Friend.dropfriend,{friendIds:t,groupIds:n},function(e){r.call(this,e)},"text")}},cgroupNaddfri:function(e){return function(t,n){jQuery.post(e.API.Friend.cgroupNaddfri,{groupName:t,friendIds:n},function(e){callback.call(this,e)},"text")}},delgroup:function(e){return function(t,n){jQuery.post(e.API.Friend.delgroup,{groupId:t},function(e){n.call(this,e)},"text")}},getgroupfriends:function(e){return function(t,n){jQuery.post(e.API.Friend.getgroupfriends,{gid:t},function(e){n.call(this,e)},"json")}},updategroup:function(e){return function(t,n,r){jQuery.post(e.API.Friend.updategroup,{uid:userconfig.uid,groupId:t,groupName:n},function(e){r.call(this,e)},"text")}}})

	FUNLR.namespace('common.language.text', function(a) {
		return function() {
			var t = {
				success: '发表成功！',
				empty: '说点什么先吧！'
			}
			return t;
		}
	})

	return FUNLR;
})