!function(a,b){"use strict";a.module("dg",["ngRoute","ngTouch","ngAnimate","ngResource","ngSanitize","dgConfig","dgCommon","dgHome","dgUser","dgSearch","dgMusic","dgPage","dgPost","dgConnect","dgSetting","dgFeedback","dgWizard","dgTemplates","l42y.match-path"]).controller("DragonCtrl",["$scope","$window","$timeout","$location","G","Like","Flash","Title","Device","Player","Layout","Tracker","Session","PlaybackState",function(b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=this;n.requestCurrentUser(),this.g=f,this.like=g,this.flash=h,this.title=i,this.layout=l,this.device=j,this.player=k,this.session=n,this.tracker=m,this.location=e,this.modernizr=Modernizr,this.playbackState=o;var q,r,s=a.element(c);s.bind("scroll touchmove",function(){r=s[0].scrollY,b.$apply(function(){f.hideStickyElement=0>=r?!1:!0,d.cancel(q),q=d(function(){f.hideStickyElement=!1},500)})}),this.toggleMobileNav=function(b){return f.mobileNavExpanded=a.isDefined(b)?b:!f.mobileNavExpanded,f.mobileNavExpanded},this.whatShouldIDo=function(){j.isDesktop()?e.url("/"):p.toggleMobileNav()}}]),a.module("dgConfig",["restangular","dgSharing","l42y.meta.title"]).constant("apiPrefix","/v1").config(["SharingProvider",function(a){a.settings.jiathisUid="1373659662160721",a.settings.appKey={tqq:"801186114",tsina:"3633818594",douban:"04ee4bdc9db6f50d0ecae395d924df27"}}]).config(["RestangularProvider","apiPrefix",function(a,b){a.setBaseUrl(b),a.requestParams.get={per:30}}]).config(["$httpProvider","$locationProvider",function(a,b){a.defaults.headers.common["Content-Type"]="application/json",b.hashPrefix("!").html5Mode(!0)}]).config(["TitleProvider",function(a){a.config({name:"合拍",slogan:"一起做好音乐",format:"%(page)s - %(name)s"})}]).factory("Cached",["apiPrefix","Restangular",function(a,b){return b.withConfig(function(b){b.setBaseUrl(a),b.setDefaultHttpFields({cache:!0})})}]),a.module("dgConfig").config(["$routeProvider",function(a){a.when("/",{title:{format:"%(name)s - %(slogan)s"},controller:"HomeCtrl as home",templateUrl:"views/home/home.html"}).when("/wizard",{redirectTo:"/wizard/profile"}).when("/wizard/profile",{title:{page:"完善资料"},layout:"1col",controller:"WizardProfileCtrl as wizard",templateUrl:"views/wizard/profile.html",loginRequired:!0}).when("/wizard/social",{title:{page:"添加好友"},layout:"1col",controller:"WizardSocialCtrl as wizardSocial",templateUrl:"views/wizard/social.html",loginRequired:!0}).when("/explore",{title:{page:"探索"},controller:"ExploreCtrl as explore",templateUrl:"views/home/explore.html",loginRequired:!0}).when("/about",{title:{page:"关于合拍"},layout:"1col",templateUrl:"views/page/about.html"}).when("/about/services",{title:{page:"音乐孵化器"},layout:"1col",controller:"ServicesCtrl as services",templateUrl:"views/page/services.html"}).when("/links",{title:{page:"友情链接"},controller:"LinkCtrl as link",templateUrl:"views/page/links.html"}).when("/404",{title:{page:"找不到此页面"},layout:"1col",templateUrl:"views/page/404.html"}).when("/connect",{redirectTo:"/connect/like"}).when("/connect/message",{title:{page:"私信"},controller:"MessageListCtrl",templateUrl:"views/connect/message/conversation.html",loginRequired:!0}).when("/connect/message/:username",{title:{page:"私信"},controller:"MessageDetailCtrl",templateUrl:"views/connect/message/message.html",loginRequired:!0}).when("/connect/like",{title:{page:"赞"},controller:"NotificationCtrl",templateUrl:"views/connect/like.html",loginRequired:!0}).when("/connect/follow",{title:{page:"关注"},controller:"NotificationCtrl",templateUrl:"views/connect/follow.html",loginRequired:!0}).when("/connect/comment",{title:{page:"评论"},controller:"NotificationCtrl",templateUrl:"views/connect/comment.html",loginRequired:!0}).when("/signup",{title:{page:"注册"},controller:"AuthCtrl as signup",templateUrl:"views/user/auth/signup.html"}).when("/login",{title:{page:"登录"},controller:"AuthCtrl as login",templateUrl:"views/user/auth/login.html"}).when("/password/lost",{title:{page:"忘记密码"},layout:"1col",controller:"LostPasswordCtrl as lost",templateUrl:"views/user/auth/lost-password.html"}).when("/password/reset",{title:{page:"重置密码"},layout:"1col",controller:"ResetPasswordCtrl as reset",templateUrl:"views/user/auth/reset-password.html"}).when("/search",{title:{page:"搜索"},controller:"SearchCtrl as search",templateUrl:"views/search/search.html"}).when("/music",{title:{page:"音乐"},controller:"MusicListCtrl as music",templateUrl:"views/music/music-list.html"}).when("/music/new",{title:{page:"上传音乐"},controller:"MusicUploadingCtrl as uploading",templateUrl:"views/music/uploading.html",loginRequired:!0}).when("/music/:musicId",{controller:"MusicCtrl",templateUrl:"views/music/music.html"}).when("/music/:musicId/update",{controller:"MusicUploadingCtrl as uploading",templateUrl:"views/music/uploading.html",loginRequired:!0}).when("/posts",{title:{page:"合作信息"},controller:"PostsCtrl as posts",templateUrl:"views/post/posts.html"}).when("/posts/new",{title:{page:"发布合作信息"},controller:"NewPostCtrl as newPost",templateUrl:"views/post/new.html",loginRequired:!0}).when("/posts/:postId",{controller:"PostCtrl",templateUrl:"views/post/post.html"}).when("/posts/:postId/update",{controller:"NewPostCtrl as newPost",templateUrl:"views/post/new.html",loginRequired:!0}).when("/feedback",{title:{page:"反馈"},controller:"FeedbackCtrl",templateUrl:"views/feedback/feedback.html",loginRequired:!0}).when("/settings",{redirectTo:"/settings/account"}).when("/settings/account",{title:{page:"账号设置"},controller:"SettingAccountCtrl as setting",templateUrl:"views/setting/account.html",loginRequired:!0}).when("/settings/password",{title:{page:"密码设置"},controller:"SettingAccountCtrl as setting",templateUrl:"views/setting/password.html",loginRequired:!0}).when("/settings/notifications",{title:{page:"邮件通知设置"},controller:"SettingNotifCtrl as setting",templateUrl:"views/setting/notification.html",loginRequired:!0}).when("/settings/profile",{title:{page:"个人资料设置"},controller:"SettingProfileCtrl as setting",templateUrl:"views/setting/profile.html",loginRequired:!0}).when("/users",{title:{page:"用户"},controller:"UserListCtrl as users",templateUrl:"views/user/users.html"}).when("/:username",{controller:"UserActivityCtrl as userActivity",templateUrl:"views/user/profile/activity.html",caseInsensitiveMatch:!0}).when("/:username/music",{controller:"UserMusicCtrl as userMusic",templateUrl:"views/user/profile/music.html",caseInsensitiveMatch:!0}).when("/:username/posts",{controller:"UserPostsCtrl as userPosts",templateUrl:"views/user/profile/post.html",caseInsensitiveMatch:!0}).when("/:username/info",{controller:"UserInfoCtrl as userInfo",templateUrl:"views/user/profile/info.html",caseInsensitiveMatch:!0}).when("/:username/:type",{controller:"UserFollowCtrl as userFollow",templateUrl:"views/user/profile/follow.html",caseInsensitiveMatch:!0}).otherwise({title:{page:"找不到此页面"},layout:"1col",templateUrl:"views/page/404.html"})}]),a.module("dgCommon",["gaiamagic","dgDevice","dgTreasure","dgLayout","dgQuery","dgComment","dgError","dgAnalytics","dgTracker","dgLike","dgFollow","dgAction","dgSharing","dgTaxonomy","dgNavigation","dgConversation","dgImage","dgSlider","dgFlash","dgUpload"]),a.module("dgDevice",[]).factory("Device",["$window",function(a){var b={width:function(){return a.innerWidth||a.document.documentElement.clientWidth},isPhone:function(){return b.width()<768},isTablet:function(){return b.width()>=768&&b.width()<980},isDesktop:function(){return b.width()>=980},pixelRatio:a.devicePixelRatio>=1.5?2:1};return b}]),a.module("dgTreasure",[]).factory("G",["$rootScope","$location",function(b,c){var d={searchString:"",hideStickyElement:!1,mobileNavExpanded:!1},e="search";return b.$on("$locationChangeSuccess",function(){d.isSearchPage="/search"===c.path()?!0:!1}),b.$on("$routeChangeSuccess",function(b,f,g){a.isDefined(g)&&(d.mobileNavExpanded=!1),c.path().substring(0,e.length)!==e&&(d.searchString="")}),d}]),a.module("dgLayout",[]).run(["$rootScope","Layout",function(a,b){a.$on("$routeChangeSuccess",function(a,c){b.current=c.layout||b.defaultLayout})}]).factory("Layout",function(){return{defaultLayout:"2cols"}}),a.module("dgQuery",[]).service("Query",["$timeout","Tracker",function(b,c){var d=c.objects,e=function(){var c=this;this.page=1,this.paused=!1,this.get=function(e,f){c.paused=!0,a.isDefined(f)&&f&&(c.page=1,e.scope.objects=[],e.scope.isDataEmpty=!1);var g=a.extend({page:c.page},e.extraParams),h=e.thing.getList(g).then(function(d){return e.scope.objects=a.isDefined(e.scope.objects)?e.scope.objects.concat(d):d,d.length>0&&(c.page++,b(function(){c.paused=!1},1e3)),e.scope.isDataEmpty=0===e.scope.objects.length&&0===d.length?!0:!1,d});d.addPromise(h)}};return{getInstance:function(){return new e}}}]),a.module("dgError",[]).config(["$httpProvider",function(a){a.interceptors.push(["$q","Error",function(a,b){return{responseError:function(c){return b.report(c.config.method+" "+c.config.url+" return "+c.status,{requestUrl:c.config.url,requestMethod:c.config.method}),a.reject(c)}}}])}]).factory("Error",["$rootScope",function(b){var c={setUser:function(a){a?(Raven.setUser(a),mixpanel.identify(a.id),mixpanel.name_tag(a.name+" ("+a.email+")"),mixpanel.people.set({$email:a.email,$created:a.created,$username:a.name,$first_name:a.nickname,$last_login:new Date})):(Raven.setUser(),mixpanel.cookie.remove())},report:function(b,c){401!==b&&404!==b&&(a.isString(b)||a.isNumber(b)?Raven.captureMessage(b,{tags:c}):Raven.captureException(b,{tags:c}))}};return b.$on("auth:logoutSuccess",function(){c.setUser()}),b.$on("auth:currentUserLoaded",function(a,b){c.setUser(b)}),c}]),a.module("dgAnalytics",["angulartics","angulartics.ga","angulartics.mixpanel"]),a.module("dgLike",[]).factory("Like",["$analytics","Restangular",function(a,b){return{toggle:function(c){var d=c.like_count,e=b.one("user/liked/music",c.id);c.liked?e.remove().then(function(){c.liked=!1,c.like_count>d-1&&(c.like_count=c.like_count-1),a.eventTrack("unlike",{category:"Music"})}):e.put().then(function(){c.liked=!0,c.like_count<d+1&&(c.like_count=c.like_count+1),a.eventTrack("like",{category:"Music"})})}}}]),a.module("dgFollow",[]).directive("dgFollow",["$location","Session","$analytics","Restangular",function(b,c,d,e){return{scope:{target:"=dgFollow"},replace:!0,restrict:"EA",templateUrl:"views/partials/follow.html",link:function(b){b.session=c;var f=e.one("user/following",b.target.name);b.toggleFollow=function(){a.isDefined(b.target.is_following)&&(b.target.is_following?f.remove().then(function(){d.eventTrack("unfollow",{category:"User"}),b.target.is_following=!b.target.is_following,b.target.followers_count--}):f.put().then(function(){d.eventTrack("follow",{category:"User"}),b.target.is_following=!b.target.is_following,b.target.followers_count++}))}}}}]),a.module("dgTracker",["ajoslin.promise-tracker"]).factory("Tracker",["promiseTracker",function(a){return{session:a("session"),objects:a("objects")}}]).directive("dgTracker",["$timeout","promiseTracker",function(b,c){var d={color:"#888",lines:10,width:2,length:6,radius:5,direction:-1};return{scope:!0,replace:!0,restrict:"EA",templateUrl:function(b,c){return a.isDefined(c.type)?"views/partials/tracker/"+c.type+".html":"views/partials/tracker/"+c.dgTracker+".html"},link:function(e,f,g){b(function(){new Spinner(d).spin(f.find("i")[0])},500),e.tracker=c(g.dgTracker),e.tracker.on("start",function(){e.isHidden=!1,e.onSuccess=null,e.onFailure=null}).on("error",function(){e.onFailure=!0}).on("success",function(c){e.onSuccess=!0,b(function(){e.onSuccess=!1},3e3),a.isArray(c)&&!c.length?e.onLastPage=!0:e.isHidden=!0})}}}]),a.module("dgComment",[]).directive("dgComment",["Conversation","Restangular",function(b,c){var d={post:"posts",music:"music"};return{scope:{hostId:"@dgComment",hostType:"@"},replace:!0,restrict:"EA",templateUrl:"views/partials/comment.html",link:function(e){var f=c.one(d[e.hostType],e.hostId).all("comments");e.$watch("hostId",function(){a.isDefined(e.hostId)&&""!==e.hostId&&f.getList({flatten:!0}).then(function(a){e.comments=a})}),e.removeComment=function(a){b.removeMessage({type:"comment",host:{id:e.hostId,type:e.hostType},message:a,messages:e.comments})}}}}]),a.module("dgAction",[]).factory("Action",["Flash","Restangular",function(a,b){var c={post:{url:"posts",name:"合作信息"},music:{url:"music",name:"音乐"}},d={remove:function(d,e,f){var g=b.one(c[f].url,d.id);g.remove().then(function(){e&&e.splice(e.indexOf(d),1),a.pushMessage(c[f].name+"已删除")},function(){a.pushMessage(c[f].name+"删除失败，请重试")})}};return d}]).controller("ActionCtrl",["$scope",function(b){var c,d=function(a){switch(a){case"comment":case"sharing":return b.thing;case"reply":return b.object;default:throw"unknow actionType: "+a}};return b.dispatch=function(e,f){b.actionType=e,b.actionTarget=a.extend(d(e),{type:f||"music"}),b.extendedStatus=e!==c?!0:!b.extendedStatus,c=e},b}]),a.module("dgSharing",[]).provider("Sharing",function(){var b={appKey:{}},c={settings:b,$get:["$window","$location",function(c,d){return{getLink:function(e){var f=a.isDefined(e.url)?e.url:d.absUrl(),g=a.isDefined(e.title)?e.title:c.document.title,h=a.isDefined(e.pic),i=a.isDefined(b.jiathisUid),j=a.isDefined(e.summary),k=b.appKey[e.service],l=a.isDefined(k),m="http://www.jiathis.com/send/?webid="+e.service+"&url="+f+"&title="+encodeURIComponent(g)+(h?"&pic="+e.pic:"")+(i?"&uid="+b.jiathisUid:"")+(j?"&summary="+e.summary:"")+(l?"&appkey="+k:"");return m}}}]};return c}).controller("SharingCtrl",["$location","Sharing",function(b,c){var d=b.protocol()+"://"+b.host();this.getLink=function(b,e,f){var g,h,i;switch(f){case"post":g=e.title,h={url:d+"/posts/"+e.id},i="分享合作信息《"+g+"》。";break;case"user":g=e.nickname,h={url:d+"/"+e.name,pic:e.avatars.origin},i="分享音乐人 "+g+"。";break;default:g=e.name,h={url:d+"/music/"+e.id,pic:e.covers.origin},i="分享 "+e.user.nickname+" 的《"+g+"》。"}switch(b){case"tsina":h=a.extend(h,{title:i+"（来自@合拍网）"});break;case"tqq":h=a.extend(h,{title:i+"（来自 @hepaimusic）"});break;default:h=a.extend(h,{title:g,summary:i})}return h=a.extend(h,{service:b}),c.getLink(h)}}]),a.module("dgTaxonomy",[]).factory("Taxonomy",function(){var b={isTagActive:function(a,b){return b?-1!==b.indexOf(a):!1},activeTag:function(a,b){return b.multi_selectable?b.activeTags.push(a):b.activeTags=[a],b.activeTags},deactiveTag:function(a,b){var c=_.findIndex(b.activeTags,{id:a.id});return b.activeTags.splice(c,1),b.activeTags},deactiveTags:function(a,b){return b.forEach(function(a){a.groups.forEach(function(a){null!==a.activeTags&&(a.activeTags=[])})}),_.find(b,{id:a.id})},selectTag:function(a,c){return c.activeTags=c.activeTags||[],c.activeTags=b.isTagActive(a,c.activeTags)?b.deactiveTag(a,c):b.activeTag(a,c),c.activeTags},initActiveTags:function(a,c,d){d&&_.find(d,{id:a.id})&&(c.activeTags=b.selectTag(a,c))},getTagIds:function(b){var c=[];return a.forEach(b,function(b){a.forEach(b.activeTags,function(a){c=c.concat(a.id)})}),c}};return b}).factory("Tag",["$location","$routeParams",function(a,b){var c={isActive:function(a){return b.q?-1!==b.q.indexOf(a):!1},append:function(c){b.q&&-1!==b.q.indexOf("#")?a.search("q",b.q+"+#"+c):a.search("q","#"+c)},remove:function(c){var d="#"+c,e=b.q===d,f=-1===b.q.indexOf("+"+d);f?e?a.search("q",null):a.search("q",b.q.replace(d+"+","")):a.search("q",b.q.replace("+"+d,""))},toggle:function(a){return c.isActive(a)?c.remove(a):c.append(a)}};return c}]).directive("dgTaxonomy",["G","Tag","Cached",function(a,b,c){return{restrict:"EA",controller:["$scope","$element","$attrs",function(d,e,f){var g=this;g.g=a,g.tag=b,g.taxonomyName=f.taxonomyName,c.all(f.dgTaxonomy).getList().then(function(a){return g.taxonomies=a,a})}],controllerAs:"taxonomy"}}]),a.module("dgNavigation",[]).controller("NavCtrl",["$location","G","Tracker",function(a,b,c){this.g=b,this.tracker=c.session,this.submit=function(){b.searchString&&""!==b.searchString&&a.path("/search").search("q",b.searchString)}}]).directive("dgNavPush",["$animate","G",function(a,b){return{restrict:"EA",link:function(c,d,e){c.g=b;var f=e.dgNavPush;c.$watch("g.mobileNavExpanded",function(b){b?a.addClass(d,f):a.removeClass(d,f)})}}}]).controller("SearchMatchingCtrl",["$location",function(a){this.location=a,this.test=function(b,c){return a.search()[b]===c}}]),a.module("dgConversation",[]).factory("Conversation",["Flash","$analytics","Restangular",function(a,b,c){var d={post:"posts",music:"music"};return{addMessage:function(e){if(!e.message||!e.message.content)return void a.pushMessage("请输入内容","warning");if(e.require){var f=e.message.content.length,g=e.require.actionTarget.actor.name.length;if(f===g+2)return void a.pushMessage("请输入回复","warning")}var h={comment:c.one(d[e.host.type],e.host.id).all("comments"),message:c.all("messages/"+e.host.id),feedback:c.all("feedback")};h[e.type].post({content:e.message.content}).then(function(a){var c=e.type.charAt(0).toUpperCase()+e.type.slice(1);b.eventTrack("create",{category:c,label:e.host.type}),e.require&&(e.require.extendedStatus=!1),e.messages.unshift(a),e.message.content="",e.messageForm.$setPristine()})},removeMessage:function(a){var b={comment:c.one(d[a.host.type],a.host.id).one("comments",a.message.id),message:c.one("messages",a.host.id).one(a.message.id),conversation:c.one("messages",a.host.id)};b[a.type].remove().then(function(){a.messages.splice(a.messages.indexOf(a.message),1)})}}}]).directive("dgNewMessage",["Conversation",function(b){return{scope:{type:"@dgNewMessage",hostId:"=",hostType:"=",messages:"=",placeholder:"@"},replace:!0,restrict:"EA",require:"?^ngController",templateUrl:"views/partials/conversation/message-new.html",link:function(c,d,e,f){var g,h=d.find("textarea");c.message={},a.isDefined(f)&&"reply"===f.actionType&&(g=f,c.message.content="@"+g.actionTarget.actor.name+" ",h.focus()),c.addMessage=function(){b.addMessage({type:c.type,host:{id:c.hostId,type:c.hostType},message:c.message,messages:c.messages,messageForm:c.messageForm,require:g})}}}}]).directive("dgLinkify",["$location",function(a){return{restrict:"EA",link:function(b,c,d){d.$observe("ngHref",function(d){c.css("cursor","pointer"),c.bind("click",function(){b.$apply(function(){a.path(d)})})})}}}]),a.module("dgImage",[]).directive("dgImage",["Device",function(a){return{restrict:"EA",link:function(b,c,d){d.$observe("dgImage",function(b){var c=b+"?imageView/1/w/"+d.width*a.pixelRatio+"/h/"+d.height*a.pixelRatio+"/q/100/format/jpg";d.$set("src",c)})}}}]).directive("dgIcon",function(){return{restrict:"A",link:function(a,b,c){b.addClass("i-"+c.dgIcon);var d="i-"+c.dgIcon+"Active";b.bind("mouseenter focus",function(){b.addClass(d)}),b.bind("mouseleave blur",function(){b.removeClass(d)}),c.iconSize&&(b[0].style.cssText+=";width:"+c.iconSize+"px;height:"+c.iconSize+"px;")}}}),a.module("dgSlider",[]).directive("dgSlider",[function(){var b=function(a,b,c){var d,e,f,g,h=0,i=function(){h=new Date,f=null,g=a.apply(d,e)};return function(){var j=new Date;h||c!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(f),f=null,h=j,g=a.apply(d,e)):f||(f=setTimeout(i,k)),g}},c={bar:".bar",handle:".handle"},d=function(a,b,c){a.width(c+"%"),b.css({left:c+"%"})};return{restrict:"A",scope:{bar:"@sliderBar",handle:"@sliderHandle",sliderValue:"=",sliderChange:"&"},link:function(e,f){var g=f,h=g.find(e.bar||c.bar),i=g.find(e.handle||c.handle);d(h,i,e.sliderValue);var j,k,l=b(function(a){var b,c=a.pageX-j;b=0>c?0:c>k?100:c/k*100,d(h,i,b),e.sliderChange({sliderValue:b}),e.sliderValue=Math.round(b),e.$apply(),window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},10);i.on("mousedown",function(b){b.preventDefault(),j=g.offset().left,k=g.width(),a.element(document).on("mousemove",l),a.element(document).one("mouseup",function(){a.element(document).off("mousemove",l)})})}}}]),a.module("dgFlash",[]).factory("Flash",["$rootScope","$timeout",function(a,b){var c={messages:[],removeMessage:function(a){c.messages.splice(c.messages.indexOf(a),1)},pushMessage:function(a,d,e){var f={content:a,category:d||"info"};c.messages.push(f),b(function(){c.removeMessage(f)},e||5e3)}};return c}]),a.module("dgUpload",[]).directive("dgUploader",["$http","$timeout","Flash","Error","apiPrefix",function(b,c,d,e,f){var g={audio:{title:"请选择音频文件",extensions:"mp3,wav,aac"},image:{title:"请选择图片",extensions:"gif,jpg,jpeg,png"}};return{scope:{uploadType:"@",targetModel:"=?",uploadCallback:"&"},replace:!0,restrict:"EA",transclude:!0,templateUrl:function(b,c){return a.isDefined(c.templateName)?"views/partials/uploading/"+c.templateName+".html":"views/partials/uploading/dragndrop.html"},controller:["$scope","$element","$attrs",function(h,i,j){h.uploadState="normal",h.uploadThing=j.uploadThing,h.supportFeatures={dragndrop:Modernizr.draganddrop&&!Modernizr.touch},h.getToken=b.get(f+"/upload/token?type="+j.uploadType).then(function(b){return h.uploader=new plupload.Uploader({url:"http://up.qbox.me:80/",runtimes:"flash,html5,html4",container:i[0],browse_button:i.find("a")[0],flash_swf_url:"/components/plupload/js/Moxie.swf",file_data_name:"file",multipart_params:{},filters:{mime_types:[g[j.uploadType]],max_file_size:"100mb"},init:{FilesAdded:function(a){a.settings.multipart_params={key:j.uploadFolder+"/"+uuid.v4(),token:b.data.token},a.start()},StateChanged:function(a){a.state===plupload.STARTED&&h.$apply(function(){h.uploadState="uploading"})},UploadProgress:function(a,b){h.$apply(function(){h.percentUploaded=b.percent+"%"})},FileUploaded:function(b,d,e){var f=a.fromJson(e.response);h.$apply(function(){f.success?(h.uploadState="success",h.targetModel="https://"+f.domain+"/"+f.key,h.uploadCallback&&h.uploadCallback({url:h.targetModel})):h.uploadState="failed","image"===h.uploadType&&c(function(){h.percentUploaded="",h.uploadState="normal"},3e3)}),b.refresh()},Error:function(a,b){e.report(b),a.refresh()}}}),h.uploader.init(),b},function(){d.pushMessage("非常抱歉，网站发生错误，我们已经记录下这个问题，如果你有疑问请通过反馈联系我们","warning",1e4),e.report("Failed to get uploading Token")})}]}}]),a.module("gaiamagic",["gaiamagic.humanizeTime"]),a.module("dgHome",["infinite-scroll"]).controller("HomeCtrl",["$scope","Session",function(a,b){var c=this;a.session=b,a.$watch("session.currentUser",function(a){c.templateName=a?"activity":"explore"})}]).controller("ExploreCtrl",["Query","Restangular",function(a,b){var c=this;c.query=a.getInstance(),c.getObjects=function(){c.query.get({scope:c,thing:b.all("recommendations")})}}]).controller("TimelineCtrl",["Query","Title","Restangular",function(a,b,c){var d=this;b.set({page:"首页",format:"%(page)s - %(name)s"}),d.query=a.getInstance(),d.getObjects=function(){d.query.get({scope:d,thing:c.all("activities")})}}]),a.module("dgUser",["dgUserAuth","dgUserProfile","dgUsers"]).factory("UserRestangular",["$injector","apiPrefix","Restangular",function(a,b,c){var d;return c.withConfig(function(c){c.setBaseUrl(b),c.requestParams.get=null,c.setResponseInterceptor(function(b){return d=a.get("Session"),d.currentUser=b,b})})}]),a.module("dgUsers",[]).controller("UserListCtrl",["Query","Restangular",function(a,b){this.query=a.getInstance(),this.getObjects=function(){this.query.get({scope:this,thing:b.all("users"),extraParams:{with_avatar:!0}})}}]),a.module("dgUserAuth",["dgUser","dgConfig","restangular","http-auth-interceptor"]).factory("Session",["$q","$http","$location","$rootScope","apiPrefix","Restangular",function(a,c,d,e,f,g){function h(a){a=a||"/",d.url(a)}var i={currentUser:null,logout:function(){c({url:f+"/users/logout",method:"DELETE"}).success(function(){e.$broadcast("auth:logoutSuccess"),i.currentUser=null,d.path("/")})},requestCurrentUser:function(){return i.currentUser?a.when(i.currentUser):g.one("user").withHttpConfig({tracker:"session",ignoreAuthModule:!0}).get().then(function(a){return e.$broadcast("auth:currentUserLoaded",a),i.currentUser=a,a})},isAuthenticated:function(){return!!i.currentUser}};return e.$on("auth:currentUserLoaded",function(a,b){i.currentUser=b}),e.$on("auth:loginSuccess",function(a,b){h(b)}),e.$on("event:auth-loginRequired",function(){d.path("/login")}),e.$on("$routeChangeSuccess",function(c,e){e.loginRequired&&i.requestCurrentUser().then(b,function(b){d.url("/login?returnUrl="+d.url()),a.reject(b)})}),i}]).controller("AuthCtrl",["$q","$http","$location","$analytics","$rootScope","$routeParams","Flash","Session","apiPrefix","authService",function(a,b,c,d,e,f,g,h,i,j){var k=this;if(h.isAuthenticated()&&h.requestCurrentUser().then(function(a){return c.path("/"),a},function(b){h.logout(),a.reject(b)}),f.by_sns){k.bySns=!0,k.user={uid:f.uid,token:f.token,secret:f.secret,nickname:f.nickname,provider:f.provider};var l={tqq:"腾讯微博",weibo:"新浪微博",douban:"豆瓣"},m="Hi, "+k.user.nickname+"，欢迎通过"+l[k.user.provider]+"登录合拍，请进一步补全账号资料。";g.pushMessage(m,"info")}k.submitLogin=function(){b({url:i+"/users/login",data:{email:k.user.email,password:k.user.password,remember_me:"1"},method:"POST",ignoreAuthModule:!0}).success(function(a){d.eventTrack("login",{category:"User"}),e.$broadcast("auth:loginSuccess",c.search().returnUrl),e.$broadcast("auth:currentUserLoaded",a),j.loginConfirmed()}).error(function(a){g.pushMessage(a.message),k.errors=a.errors})},k.submitSignup=function(){k.user=k.user||{};var a={email:k.user.email,nickname:k.user.nickname,password:k.user.password,password_confirmation:k.user.password};k.bySns?(a.uid=k.user.uid,a.token=k.user.token,a.secret=k.user.secret,a.provider=k.user.provider,n(a)):o(a)};var n=function(a){b({url:i+"/users/sns_signup",data:a,method:"POST",ignoreAuthModule:!0}).success(function(a){p(a)}).error(function(a){k.errors=a.errors})},o=function(a){b({url:i+"/users",data:a,method:"POST",ignoreAuthModule:!0}).success(function(a){p(a)}).error(function(a){k.errors=a.errors})},p=function(a){d.eventTrack("signup",{category:"User"});var b=c.search().returnUrl||"/wizard/profile";e.$broadcast("auth:loginSuccess",b),e.$broadcast("auth:currentUserLoaded",a),g.pushMessage("恭喜！注册成功。","success"),j.loginConfirmed()}}]).controller("LostPasswordCtrl",["$timeout","Restangular",function(a,b){var c=this,d=/^[A-Za-z0-9._%+-]+@([A-Za-z0-9.-]+\.[A-Za-z]{2,6})$/,e={"qq.com":"https://mail.qq.com","163.com":"http://mail.163.com","sina.cn":"https://mail.sina.com.cn","sina.com":"https://mail.sina.com.cn","sohu.com":"https://mail.sohu.com","gmail.com":"https://mail.google.com","yahoo.com":"https://mail.yahoo.com"};c.submit=function(d,e){var f=b.one("password");f.email=d,f.post().then(function(b){b.success&&(c.submitSucceed=!0),c.isSubmitAgain=e,a(function(){c.isSubmitAgain=!1},5e3)},function(a){c.errors=a.data.errors})},c.getEmailDomain=function(a){var b=a.match(d),c=b[1];return e[c]||"http://"+c}}]).controller("ResetPasswordCtrl",["$location","$routeParams","Flash","Restangular",function(b,c,d,e){var f=this;return c.reset_password_token?void(f.submit=function(g){var h=e.one("password");g.reset_password_token=c.reset_password_token,h=a.extend(h,g),h.put().then(function(){d.pushMessage("重置密码成功","success"),b.url("/login")},function(a){d.pushMessage(a.data.message),f.errors=a.data.errors})}):void d.pushMessage("重置密码链接错误")}]),a.module("dgUserProfile",["dgUserActivity","dgUserMusic","dgUserPosts","dgUserInfo","dgUserFollow"]),a.module("dgUserActivity",[]).controller("UserActivityCtrl",["$scope","$location","$routeParams","Query","Title","Restangular",function(a,b,c,d,e,f){var g=this;f.one("users",c.username).get().then(function(a){g.user=a,e.set({page:a.nickname})},function(){b.url("/404")}),a.query=d.getInstance(),a.getObjects=function(){a.query.get({scope:a,thing:f.one("users",c.username).all("activities")})}}]),a.module("dgUserMusic",[]).controller("UserMusicCtrl",["$scope","$location","$routeParams","Flash","Query","Music","Title","Restangular",function(a,b,c,d,e,f,g,h){var i=this;h.one("users",c.username).get().then(function(a){i.user=a,g.set({page:a.nickname+" 的音乐"})}),a.query=e.getInstance(),a.getObjects=function(){a.query.get({scope:a,thing:h.one("users",c.username).all("music")})},this.music=f}]),a.module("dgUserPosts",[]).controller("UserPostsCtrl",["$scope","$routeParams","Query","Title","Action","Restangular",function(a,b,c,d,e,f){var g=this;g.actions=e,f.one("users",b.username).get().then(function(a){g.user=a,d.set({page:a.nickname+" 的合作信息"})}),g.query=c.getInstance(),g.getObjects=function(){g.query.get({scope:g,thing:f.one("users",b.username).all("posts"),extraParams:{without_owner:!1}})}}]),a.module("dgUserInfo",[]).controller("UserInfoCtrl",["$scope","$routeParams","$location","Flash","Query","Title","Action","EditPostUtils","Restangular",function(b,c,d,e,f,g,h,i,j){var k=this;k.actions=h,j.one("users",c.username).get().then(function(a){k.user=a,g.set({page:a.nickname+" 的详细信息"})}),k.submit=function(){var b=j.one("user"),c={personal_page:k.user.personal_page};a.extend(b,c),b.put().then(function(a){e.pushMessage("更新个人详细信息成功","success"),k.user=a,k.isEditing=!1},function(a){k.errors=a.data.errors})},k.editInfo=function(){k.isEditing=!0},k.insertImg=function(a,b){var c="\n![图片]("+b+")\n",d=i.insertContent(a,c);k.user.personal_page=d}}]),a.module("dgUserFollow",[]).controller("UserFollowCtrl",["$scope","$location","$routeParams","Query","Title","Restangular",function(a,b,c,d,e,f){var g=this;f.one("users",c.username).get().then(function(a){g.user=a,e.set({page:a.nickname+" 的"+("following"===c.type?"关注":"粉丝")})}),-1===["following","followers"].indexOf(c.type)&&b.url("/404"),a.query=d.getInstance(),a.getObjects=function(){a.query.get({scope:a,thing:f.one("users",c.username).all(c.type)})}}]),a.module("dgSearch",[]).controller("SearchCtrl",["$location","$routeParams","G","Tag","Query","Cached","Restangular",function(b,c,d,e,f,g,h){var i=this;i.g=d,i.tag=e,i.query=f.getInstance(),i.type=c.type,b.search().q!==d.searchString&&(d.searchString=b.search().q),i.isTag=function(){return!!d.searchString&&"#"===d.searchString.charAt(0)&&d.searchString.length>1};var j=function(a){var b={user:"users",post:"posts",music:"music"},c={scope:i,thing:h.all(b[a])};return"user"===a&&(c.extraParams={with_avatar:!0}),i.query.get(c)},k=function(a,b,c){return i.query.get({scope:i,thing:h.one("tags").all("taggable"),extraParams:{type:a,"slugs[]":b}},c)},l=function(a,b,c){return i.query.get({scope:i,thing:h.all("search"),extraParams:{q:a,type:b}},c)},m=function(b){var c=[];return a.forEach(b.split("+"),function(a){"#"===a.charAt(0)&&c.push(a.substring(1))}),c},n=function(b){var c=[];return a.forEach(b,function(a){g.one("tags",a).get().then(function(a){c.push(a)})}),c};i.getObjects=function(a){if(d.searchString)if(b.search("q",d.searchString),"#"===d.searchString.charAt(0)){var e=m(c.q);i.tags=n(e),k(i.type,e,a)}else l(d.searchString,i.type,a);else j(i.type)},this.getObjects()}]),a.module("dgMusic",["dgMusicPlayer","dgMusicUploading"]).factory("Music",["$location","Flash","Action","Restangular",function(b,c,d,e){return{publish:function(d){var f=e.one("music",d.id);f.published=!0,f.put().then(function(a){b.path("/music/"+a.data.id)},function(b){var d=[];a.forEach(b.data.errors,function(a){d.push(a.field+a.message)}),c.pushMessage(b.data.message+"。"+d.join("，"),"warning")})},remove:d.remove}}]).controller("MusicCtrl",["$scope","$location","$routeParams","Music","Title","Restangular",function(a,b,c,d,e,f){a.actions=d,f.one("music",c.musicId).get().then(function(b){return a.music=b,e.set({page:b.user.nickname+" 的 "+b.name}),b},function(a){404===a.status&&b.url("/404")})}]).controller("MusicListCtrl",["Query","Restangular",function(a,b){this.query=a.getInstance(),this.getObjects=function(){this.query.get({scope:this,thing:b.all("music")})}}]),a.module("dgMusicPlayer",[]).run(["Error",function(a){soundManager.setup({url:"/components/soundmanager/swf/",wmode:"transparent",flashVersion:9,ontimeout:function(b){a.report("SoundManager 2 failed to start",{status:b})}})}]).directive("progressBar",function(){return{scope:{percentLoaded:"=",percentPlayed:"=",onSeek:"&"},replace:!0,restrict:"EA",templateUrl:"views/music/progress-bar.html",link:function(b,c){var d=function(a){var c=a.offsetX/a.currentTarget.clientWidth;b.onSeek({percentOffset:c})};c.on("mousedown",function(b){d(b),c.on("mousemove",d),a.element(document).one("mouseup",function(){c.off("mousemove",d)
})})}}}).factory("PlaybackState",function(){var b={states:{paused:"paused",stopped:"stopped",playing:"playing"},sounds:{},expanded:!1,lastMusic:null,getLastSound:function(){return b.sounds[b.lastMusic.id]},syncState:function(c,d){a.isDefined(b.sounds[c])?b.sounds[c].state=d:b.sounds[c]={state:d}},toggleExpandStatus:function(){b.expanded=!b.expanded}};return b}).factory("Player",["$rootScope","Restangular","$analytics","PlaybackState",function(b,c,d,e){var f=soundManager,g=e,h={events:{onplay:function(){var a=this;g.syncState(a.id,g.states.playing)},onstop:function(){var a=this;g.syncState(a.id,g.states.stopped)},onpause:function(){var a=this;g.syncState(a.id,g.states.paused)},onresume:function(){var a=this;g.syncState(a.id,g.states.playing)},onfinish:function(){var a=this;b.$apply(function(){g.syncState(a.id,g.states.stopped),g.sounds[a.id].timePlayed=a.position}),g.lastMusic.$next&&h.play(g.lastMusic.$next)},whileloading:function(){var a=this;b.$apply(function(){g.sounds[a.id].percentLoaded=100*a.bytesLoaded/a.bytesTotal})},whileplaying:function(){var a=this;_.defer(function(){b.$apply(function(){g.sounds[a.id].percentPlayed=100*a.position/a.durationEstimate,g.sounds[a.id].timeTotal=a.durationEstimate,g.sounds[a.id].timeTotalHumanized=moment.duration(a.durationEstimate).minutes()+":"+moment.duration(a.durationEstimate).seconds(),g.sounds[a.id].timePlayedHumanized=moment.duration(a.position).minutes()+":"+moment.duration(a.position).seconds()})})}},createSound:function(b,c,d){if(a.isUndefined(f.getSoundById(b))){var e={id:b,url:c,type:a.isDefined(d)?d:"audio/mpeg"},g=a.extend(e,h.events);return f.createSound(g)}return f.sounds[b]},addListenCount:function(a){a.listen_count++,c.one("music",a.id).one("listen_count").put()},play:function(a){h.createSound(a.id,a.audio_file).play(),h.addListenCount(a)},seek:function(a){g.getLastSound().state===g.states.stopped&&(f.play(g.lastMusic.id),f.pause(g.lastMusic.id));var b=a*g.getLastSound().timeTotal;f.setPosition(g.lastMusic.id,b)},toggle:function(b){if(g.lastMusic=b,a.isDefined(g.sounds[b.id])){var c=g.sounds[b.id].state;return c===g.states.stopped?(f.pauseAll(),f.play(b.id),h.addListenCount(b)):c===g.states.paused?(f.pauseAll(),f.resume(b.id),d.eventTrack("play",{category:"Music"})):c===g.states.playing&&(f.pause(b.id),d.eventTrack("pause",{category:"Music"})),f.sounds[b.id]}return f.pauseAll(),h.play(b),d.eventTrack("play",{category:"Music"}),f.sounds[b.id]}};return Mousetrap.bind("space",function(){return g.lastMusic&&b.$apply(function(){h.toggle(g.lastMusic)}),!1}),h}]),a.module("dgMusicUploading",[]).controller("MusicUploadingCtrl",["$scope","$location","$routeParams","Flash","Restangular","$analytics","promiseTracker",function(b,c,d,e,f,g,h){var i=this;if(f.all("music/types").getList().then(function(a){return i.types=a,a}),f.all("music/genres").getList().then(function(a){return i.genres=a,a}),i.inputTracker=h("uploading"),i.objectsTracker=h("objects"),a.isDefined(d.musicId)){var j=f.one("music",d.musicId).get().then(function(a){return i.music=a,a});this.objectsTracker.addPromise(j)}this.submit=function(){if(a.isUndefined(this.music))return void e.pushMessage("请上传音乐","warning");var b,d=i.music,h=a.isDefined(d.id),j={name:d.name,audio:d.audio,cover:d.cover,lyric:d.lyric,type_id:d.type?d.type.id:null,genre_id:d.genre?d.genre.id:null,published:d.published};if(h){var k=f.one("music",d.id);a.extend(k,j),b=k.put()}else{var l=f.one("music");a.extend(l,j),b=l.post()}b.then(function(a){return h||g.eventTrack("create",{category:"Music"}),i.music=a,c.url("/music/"+a.id),a},function(a){return i.errors=a.data.errors,a}),this.inputTracker.addPromise(b)}}]),a.module("dgPost",[]).factory("EditPostUtils",function(){return{insertContent:function(a,b){var c,d,e,f=document.getElementById(a),g=f.value,h="undefined"!=typeof f.selectionStart&&"undefined"!=typeof f.selectionEnd,i="undefined"!=typeof document.selection&&"undefined"!=typeof document.selection.createRange;return h?(c=f.selectionStart,d=f.selectionEnd,f.value=g.slice(0,c)+b+g.slice(d),f.selectionStart=f.selectionEnd=c+b.length):i?(f.focus(),e=document.selection.createRange(),e.collapse(!1),e.text=b,e.select()):f.value+=b,f.value}}}).controller("PostsCtrl",["Query","Restangular",function(a,b){var c=this;c.query=a.getInstance(),c.getObjects=function(){c.query.get({scope:c,thing:b.all("posts")})}}]).controller("PostCtrl",["$scope","$location","$routeParams","Title","Restangular",function(a,b,c,d,e){e.one("posts",c.postId).get().then(function(b){return a.post=b,d.set({page:b.title}),b},function(a){404===a.status&&b.url("/404")})}]).controller("NewPostCtrl",["$location","$routeParams","Flash","Taxonomy","Restangular","EditPostUtils","promiseTracker","$analytics",function(b,c,d,e,f,g,h,i){var j=this;j.taxonomy=e;var k=f.all("posts/categories").getList();k.then(function(a){j.categories=a}),c.postId&&f.one("posts",c.postId).get().then(function(a){return j.post=a,k.then(function(b){j.activeCategory=_.find(b,{id:a.category.id})}),a}),j.insertImg=function(a,b){var c="\n![图片]("+b+")\n",d=g.insertContent(a,c);j.post?j.post.content=d:j.post={content:d}},j.submit=function(){if(!j.post)return void d.pushMessage("请填写信息","warning");var g=[];j.activeCategory&&(g=e.getTagIds(j.activeCategory.groups));var k,l={title:j.post.title,content:j.post.content,tag_ids:g,category_id:j.activeCategory?j.activeCategory.id:null},m=function(a){return b.path("/posts/"+a.id),i.eventTrack(c.postId?"Edit":"Create",{category:"Post"}),a},n=function(a){return j.errors=a.data.errors,a};if(c.postId){var o=f.one("posts",c.postId);a.extend(o,l),k=o.put()}else{var p=f.one("posts");a.extend(p,l),k=p.post()}k.then(m,n),h("updating").addPromise(k)}}]),a.module("dgConnect",["dgConnectNotification","dgConnectMessage"]),a.module("dgConnectMessage",[]).controller("MessageListCtrl",["$scope","$routeParams","Query","Conversation","Restangular",function(a,b,c,d,e){a.query=c.getInstance(),a.getObjects=function(){a.query.get({scope:a,thing:e.all("messages")})},a.removeConversation=function(b){d.removeMessage({type:"conversation",host:{id:b.target_user.name},message:b,messages:a.objects})}}]).controller("MessageDetailCtrl",["$scope","$routeParams","Query","Conversation","Restangular",function(a,b,c,d,e){a.query=c.getInstance(),a.getObjects=function(){a.query.get({scope:a,thing:e.one("messages").all(b.username)})},a.username=b.username,a.removeMessage=function(c){d.removeMessage({type:"message",host:{id:b.username},message:c,messages:a.objects})}}]),a.module("dgConnectNotification",[]).factory("UnreadNotification",["Restangular",function(b){var c={objects:[],get:function(){return b.all("user/notifications").getList({page:0,state:"unread"}).then(function(a){return c.objects=a,a})},markAsRead:function(d){if(a.isUndefined(d)||a.isString(d))b.one("user/notifications",d).put().then(function(){c.get()});else if(a.isArray(d)){var e=b.one("user/notifications");e.ids=d,e.put().then(function(){c.get()})}}};return c}]).directive("dgUnreadNotification",["UnreadNotification",function(b){return{replace:!0,restrict:"EA",templateUrl:"views/connect/notification-unread.html",link:function(c,d,e){c.notification=b,c.notification.get(),c.notificationLimit=e.limit,c.setNotificationLimit=function(a){c.notificationLimit=a},c.getIds=function(b){var d=[];return a.forEach(c.notification.objects.slice(0,b),function(a){d.push(a.id)}),d}}}}]).controller("NotificationCtrl",["$scope","Query","Restangular",function(a,b,c){a.query=b.getInstance(),a.getObjects=function(b){a.query.get({scope:a,thing:c.all("user/notifications"),extraParams:{"types[]":b}})}}]),a.module("dgFeedback",[]).controller("FeedbackCtrl",["$scope","$http","apiPrefix","Query","Restangular",function(a,b,c,d,e){a.query=d.getInstance(),a.getObjects=function(){a.query.get({scope:a,thing:e.all("feedback")})},a.toggleVote=function(a){a.voted?b({url:c+"/feedback/"+a.id+"/vote",method:"DELETE"}).success(function(){a.voted=!1,a.vote_count--}):b({url:c+"/feedback/"+a.id+"/vote",method:"PUT"}).success(function(){a.voted=!0,a.vote_count++})}}]),a.module("dgSetting",["dgFlash","dgUserAuth"]).controller("SettingProfileCtrl",["$routeParams","Flash","Session","Taxonomy","Restangular","UserRestangular",function(b,c,d,e,f,g){var h=this,i={weibo:"新浪微博",tqq:"腾讯微博",douban:"豆瓣"};h.taxonomy=e,h.success=b.success,h.connected=b.connected,h.disconnected=b.disconnected,"1"===h.success?i[h.connected]?c.pushMessage("绑定"+i[h.connected]+"成功","success"):i[h.disconnected]&&c.pushMessage("解除绑定"+i[h.disconnected]+"成功","success"):"0"===h.success&&c.pushMessage("绑定社交帐号失败","warning"),h.changeProvince=function(a,b){return h.cities=_.find(b,{id:a}).cities,h.cities},h.resetSelectedCity=function(){h.user&&(h.user.city=_.first(h.cities))},h.changeIdentity=function(a,b){h.activeIdentity=h.taxonomy.deactiveTags(a,b)},h.changeIdentityClick=function(a,b){h.changeIdentity(a,b),h.user.domains=[]};var j=f.all("areas").getList(),k=f.all("users/identities").getList();d.requestCurrentUser().then(function(a){return h.user=d.currentUser,j.then(function(b){return h.areas=b,null!=a.province&&h.changeProvince(a.province.id,b),b}),k.then(function(b){return h.identities=b,null!=a.identity&&h.changeIdentity(a.identity,b),b}),a});var l=g.one("user");h.submit=function(){var b;h.activeIdentity&&(b=e.getTagIds(h.activeIdentity.groups));var d={avatar:h.user.avatar,website:h.user.website,nickname:h.user.nickname,description:h.user.description,province_id:h.user.province?h.user.province.id:null,city_id:h.user.city?h.user.city.id:null,identity_id:h.activeIdentity?h.activeIdentity.id:null,domain_ids:b};a.extend(l,d),l.put().then(function(a){return c.pushMessage("更新个人资料成功","success"),a},function(a){h.errors=a.data.errors})}}]).controller("SettingAccountCtrl",["Flash","Session","Restangular","UserRestangular",function(b,c,d,e){function f(a){return h.errors=null,b.pushMessage("更改设置成功","success"),a}function g(a){h.errors=a.data.errors}var h=this,i=e.one("user");d.one("user/settings/notification").get().then(function(a){return h.notification=a,a}),c.requestCurrentUser().then(function(a){return h.user=a,a}),h.submitNotif=function(){h.notification.put().then(f,g)},h.submit=function(b){var c=_.pick(h.user,b);a.extend(i,c),i.put().then(f,g)}}]),a.module("dgPage",[]).controller("LinkCtrl",["Restangular",function(a){var b=this;a.all("links").getList({with_image:!0}).then(function(a){return b.objectsWithImage=a,a}),a.all("links").getList({with_image:!1}).then(function(a){return b.objectsWithoutImage=a,a})}]).controller("ServicesCtrl",["$timeout","Sharing","Restangular",function(b,c,d){var e=this,f=d.one("contacts"),g=d.one("subscribes");e.successes={},e.sharingLink=c.getLink({title:"音乐孵化器：",service:"tsina",summary:"音乐从此大不同！从台前到幕后，从新人到巨星，从艺术到科技，从线上到线下，从上游到下游。新模式，大整合，音乐人服务平台。（来自@合拍网）"}),this.subscribe=function(c){g=a.extend(g,c),g.post().then(function(){e.successes.subscribe=!0,b(function(){e.successes.subscribe=!1},5e3)},function(a){e.errors.subscribe=a.data.errors})},this.contact=function(c){f=a.extend(f,c),f.post().then(function(){c=null,e.successes.contact=!0,b(function(){e.successes.contact=!1},5e3)},function(a){e.errors.contact=a.data.errors})}}]),a.module("dgTemplates",[]).run(["$templateCache",function(a){a.put("views/connect/comment.html",'<div class="streams" infinite-scroll="getObjects([\'comment\', \'mention\', \'reply\']);" infinite-scroll-disabled="query.paused" infinite-scroll-distance="1"><div ng-include="\'views/connect/navigation.html\'"></div><div class="Box u-textCenter u-marginVl u-paddingAxl" ng-if="isDataEmpty" ng-init="hintType = \'comment\'"><div ng-include="\'views/partials/hint/hint-\' + hintType + \'.html\'"></div></div><ol><li class="activity u-cf" ng-repeat="object in objects"><article class="thing thing-conversation"><a class="thing-highlight" ng-href="/{{ object.actor.name }}"><img class="avatar avatar-medium" width="50" height="50" dg-image="{{ object.actor.avatars.origin }}"></a><div class="u-textTruncate" ng-switch="object.operation"><a ng-href="/{{ object.actor.name }}" ng-bind="object.actor.nickname"></a> <span ng-switch-when="comment" ng-switch="object.notifiable.type">评论了你的 <a ng-switch-when="music" ng-href="/music/{{ object.notifiable.id }}" ng-bind-template="{{ object.notifiable.content }}"></a> <a ng-switch-when="post" ng-href="/posts/{{ object.notifiable.id }}" ng-bind-template="{{ object.notifiable.content }}"></a></span> <span ng-switch-when="mention">在评论中提到了你</span> <span ng-switch-when="reply">回复了你的评论</span><time class="u-colorGray" datetime="{{ object.created_at }}"></time><div class="thing-content u-textBreak" ng-bind="object.notifiable.comment_content"></div></div></article></li></ol><i ng-if="!isDataEmpty" dg-tracker="objects"></i></div>'),a.put("views/connect/follow.html",'<div class="streams" infinite-scroll="getObjects(\'follow\')" infinite-scroll-disabled="query.paused" infinite-scroll-distance="1"><div ng-include="\'views/connect/navigation.html\'"></div><div class="Box u-textCenter u-marginVl u-paddingAxl" ng-if="isDataEmpty" ng-init="hintType = \'follow\'"><div ng-include="\'views/partials/hint/hint-\' + hintType + \'.html\'"></div></div><ol><li class="activity u-cf" ng-repeat="object in objects"><a class="thing-highlight" ng-href="/{{ object.actor.name }}"><img class="avatar" width="40" height="40" dg-image="{{ object.actor.avatars.origin }}"></a> <i class="u-pullRight" dg-follow="object.actor"></i><div class="thing-info"><a ng-href="/{{ object.actor.name }}" ng-bind="object.actor.nickname"></a> 关注了你<time class="u-colorGray" datetime="{{ object.created_at }}"></time><dl class="separated list-inline"><dt ng-if="object.actor.city || object.actor.province"><dfn>地址</dfn>：</dt><dd ng-if="object.actor.city || object.actor.province" ng-bind="object.actor.city.name || object.actor.province.name"></dd><dt ng-if="object.actor.identity.name" ng-show="object.actor.identity.name"><dfn>身份</dfn>：</dt><dd ng-if="object.actor.identity.name" ng-bind="object.actor.identity.name"></dd></dl></div></li></ol><i ng-if="!isDataEmpty" dg-tracker="objects"></i></div>'),a.put("views/connect/like.html",'<div class="streams" infinite-scroll="getObjects(\'like\')" infinite-scroll-disabled="query.paused" infinite-scroll-distance="1"><div ng-include="\'views/connect/navigation.html\'"></div><div class="Box u-textCenter u-marginVl u-paddingAxl" ng-if="isDataEmpty" ng-init="hintType = \'like\'"><div ng-include="\'views/partials/hint/hint-\' + hintType + \'.html\'"></div></div><ol><li class="activity u-cf" ng-repeat="object in objects"><a class="thing-highlight" ng-href="/{{ object.actor.name }}"><img class="avatar" width="40" height="40" dg-image="{{ object.actor.avatars.origin }}"></a><div class="thing-info" ng-switch="object.notifiable.type"><a ng-href="/{{ object.actor.name }}" ng-bind="object.actor.nickname"></a> 赞了你的 <span ng-switch-default="">音乐</span><time class="u-colorGray" datetime="{{ object.created_at }}"></time><div class="thing-content"><a ng-bind="object.notifiable.content" ng-href="/music/{{ object.notifiable.id }}" ng-switch-default=""></a></div></div></li></ol><i ng-if="!isDataEmpty" dg-tracker="objects"></i></div>'),a.put("views/connect/message/conversation.html",'<div class="streams" infinite-scroll="getObjects();" infinite-scroll-disabled="query.paused" infinite-scroll-distance="1"><div ng-include="\'views/connect/navigation.html\'"></div><div class="Box u-textCenter u-marginVl u-paddingAxl" ng-if="isDataEmpty" ng-init="hintType = \'messageList\'"><div ng-include="\'views/partials/hint/hint-\' + hintType + \'.html\'"></div></div><ol class="conversations"><li class="activity" ng-repeat="object in objects"><article class="thing thing-conversation u-cf"><div class="thing-highlight"><a title="{{ object.target_user.nickname }}" ng-href="/{{ object.target_user.name }}"><img class="avatar" alt="{{ object.target_user.nickname }}" width="40" height="40" dg-image="{{ object.target_user.avatars.origin }}"></a></div><div class="thing-well"><div dg-linkify="" ng-href="/connect/message/{{ object.target_user.name }}"><div class="headline u-colorGray">和 <a title="{{ object.target_user.nickname }}" ng-href="/{{ object.target_user.name }}" ng-bind="object.target_user.nickname"></a> <span class="u-colorGray" ng-bind-template="共 {{ object.messages_count }} 条有往来信息"></span></div><div class="thing-content u-textBreak" ng-bind-html="object.last_message.content"></div></div><footer class="u-cf"><div class="u-pullLeft"><time class="u-colorGray" datetime="{{ object.updated_at }}"></time></div><div class="u-pullRight"><a ng-click="removeConversation(object)">忽略</a></div></footer></div></article></li></ol><i ng-if="!isDataEmpty" dg-tracker="objects"></i></div>'),a.put("views/connect/message/message.html",'<div class="streams" infinite-scroll="getObjects();" infinite-scroll-disabled="query.paused" infinite-scroll-distance="1"><div ng-include="\'views/connect/navigation.html\'"></div><div class="conversation-outer"><i host-id="username" messages="objects" placeholder="输入新消息" dg-new-message="message"></i><ol class="conversation" ng-if="objects.length"><li class="message" ng-repeat="object in objects"><article class="u-cf"><div class="thing-highlight"><a title="{{ object.actor.nickname }}" ng-href="/{{ object.actor.name }}"><img class="avatar" alt="{{ object.actor.nickname }}" width="40" height="40" dg-image="{{ object.actor.avatars.origin }}"></a></div><div class="thing-well"><a title="{{ object.actor.nickname }}" ng-href="/{{ object.actor.name }}" ng-bind="object.actor.nickname"></a><div class="thing-content u-textBreak" ng-bind-html="object.content_html"></div><footer class="u-cf"><div class="u-pullLeft"><time class="u-colorGray" datetime="{{ object.updated_at }}"></time></div><div class="u-pullRight"><a ng-show="object.own" ng-click="removeMessage(object)">删除</a></div></footer></div></article></li></ol></div><i dg-tracker="objects"></i></div>'),a.put("views/connect/navigation.html",'<div class="tabs-outer tabs-4cols u-cf"><a class="tab" href="/connect/like" ng-class="{\'tab-current\': l42y.isPathMatched}" l42y-match-path="true"><i class="icon-thumbs-up"></i>赞</a> <a class="tab" href="/connect/follow" ng-class="{\'tab-current\': l42y.isPathMatched}" l42y-match-path="true"><i class="icon-eye"></i>关注</a> <a class="tab" href="/connect/comment" ng-class="{\'tab-current\': l42y.isPathMatched}" l42y-match-path="true"><i class="icon-comment"></i>评论</a> <a class="tab" href="/connect/message" ng-class="{\'tab-current\': l42y.isPathMatched}" l42y-match-path="true"><i class="icon-mail"></i>私信 <a></a></a></div>'),a.put("views/connect/notification-unread.html",'<div class="notifications Box Box--small" ng-show="notification.objects"><div class="Box-header u-bgBlue" ng-bind-template="{{ notification.objects.length }} 条新通知"></div><ol><li class="Box-item u-cf" ng-repeat="object in notification.objects | limitTo:notificationLimit"><div ng-include="\'views/partials/notification.html\'"></div></li></ol><div class="Box-footer u-cf"><a class="u-pullLeft" ng-show="notification.objects.length > notificationLimit" ng-click="setNotificationLimit(notification.objects.length)" ng-bind-template="显示全部 {{ notification.objects.length }} 条新通知"></a> <a class="u-pullRight" ng-if="notification.objects.length <= notificationLimit" ng-click="notification.markAsRead()">忽略全部</a> <a class="u-pullRight" ng-if="notification.objects.length > notificationLimit" ng-click="notification.markAsRead(getIds(notificationLimit))" ng-bind-template="忽略以上 {{ notificationLimit }} 条"></a></div></div>'),a.put("views/feedback/feedback.html",'<div class="streams" infinite-scroll="getObjects()" infinite-scroll-disabled="query.paused" infinite-scroll-distance="1"><div class="conversation-outer"><i dg-new-message="feedback" messages="objects" placeholder="用得高兴不高兴，都告诉我们。"></i><ol><li class="activity u-cf" ng-repeat="object in objects"><article class="thing thing-feedback"><div class="thing-info u-borderB u-cf"><a class="thing-highlight"><img class="avatar" width="40" height="40" dg-image="{{ object.owner.avatars.origin }}"></a><div><a title="{{ object.owner.nickname }}" ng-href="/{{ object.owner.name }}" ng-bind="object.owner.nickname"></a><div class="thing-content u-textBreak" ng-bind="object.content"></div></div></div><footer class="thing-actions u-cf"><a class="btn btn-large btn-like thing-action" ng-click="toggleVote(object)" ng-class="{\'btn-unlike\': object.voted}"><i class="icon-thumbs-up"></i> <small ng-bind="object.vote_count"></small></a></footer></article></li></ol></div><i dg-tracker="objects"></i></div>'),a.put("views/home/activity.html",'<div class="streams" ng-controller="TimelineCtrl as timeline" infinite-scroll="timeline.getObjects()" infinite-scroll-disabled="timeline.query.paused" infinite-scroll-distance="1"><i class="u-marginBl" dg-unread-notification="" limit="5"></i><div class="Box u-textCenter u-marginVl u-paddingAxl" ng-if="timeline.isDataEmpty" ng-init="hintType = \'home\'"><div ng-include="\'views/partials/hint/hint-\' + hintType + \'.html\'"></div></div><div class="activities"><div class="activity-outer" ng-repeat="object in timeline.objects"><div ng-include="\'views/partials/activity.html\'"></div></div></div><i ng-if="!timeline.isDataEmpty" dg-tracker="objects"></i></div>'),a.put("views/home/banner.html",'<a href="https://itunes.apple.com/cn/app/you-yan-chu-yin-le-yan-chu/id521415660?mt=8" title="下载有演出 iOS App"><img src="/images/banner/iOS-App-yyc.29e24358.png" alt="有演出 iOS App"></a>'),a.put("views/home/explore.html",'<div class="cards-outer" ng-include="\'views/partials/explore-nav.html\'"></div><div ng-controller="ExploreCtrl as explore"><div ng-include="\'views/partials/explore-recommend.html\'"></div></div>'),a.put("views/home/home.html",'<div class="u-marginBl" ng-if="dg.device.isDesktop()"><div ng-include="\'views/home/banner.html\'"></div></div><div class="home" ng-include="\'views/home/\' + home.templateName + \'.html\'"></div>'),a.put("views/music/music-list.html",'<div class="u-marginBl" ng-if="dg.device.isDesktop()"><div ng-include="\'views/home/banner.html\'"></div></div><div class="cards-outer" ng-include="\'views/partials/explore-nav.html\'"></div><div class="cards-outer u-cf" infinite-scroll="music.getObjects()" infinite-scroll-disabled="music.query.paused" infinite-scroll-distance="1"><div class="Box u-marginTm" dg-taxonomy="music/types" taxonomy-name="类型" ng-include="\'views/partials/taxonomy/tag-group.html\'"></div><div class="Box u-marginTm" dg-taxonomy="music/genres" taxonomy-name="曲风" ng-include="\'views/partials/taxonomy/tag-group.html\'"></div><div class="cards u-cf"><article class="card" ng-init="music = object" ng-repeat="object in music.objects"><div ng-include="\'views/partials/card/music.html\'"></div></article></div><i dg-tracker="objects"></i></div>'),a.put("views/music/music.html",'<div class="streams"><div ng-if="music"><div class="u-marginBm u-relative u-cf"><div class="activity-context u-pullLeft"><a class="u-pullLeft u-marginRm" title="{{ music.user.nickname }}" ng-href="/{{ music.user.name }}"><img class="avatar" alt="{{ music.user.nickname }}" width="40" height="40" dg-image="{{ music.user.avatars.origin }}"></a><div class="u-pullLeft"><p class="u-colorGray">由 <a title="{{ music.user.nickname }}" ng-bind="music.user.nickname" ng-href="/{{ music.user.name }}"></a> <span ng-if="music.published">发布</span> <span ng-if="!music.published">上传</span> <span class="u-colorPink" ng-if="!music.published">(未公开)</span></p><time class="u-colorGray" datetime="{{ music.created_at }}"></time></div></div><div class="activity-actions"><span class="u-inlineBlock u-colorGray"><i class="icon-headphone"></i> <small ng-bind="music.listen_count"></small></span> <span class="u-paddingLm" ng-if="music.own"><a class="btn btn-small" ng-if="!music.published" ng-click="actions.publish(music)">公开</a> <a class="btn btn-small" ng-if="dg.device.isDesktop()" ng-href="/music/{{ music.id }}/update">编辑</a></span></div></div><div class="thing-outer" ng-if="music" ng-init="thing = music; hideExtraButton = true;"><div ng-include="\'views/partials/thing/music.html\'"></div></div><dl class="separated Box u-bgBlue u-paddingAs u-marginTl list-inline"><dt><dfn>歌手</dfn>：</dt><dd><a ng-href="/{{ music.user.name }}" ng-bind="music.user.nickname"></a></dd><dt><dfn>标签</dfn>：</dt><dd><a ng-href="/search?q=%23{{ music.type.slug }}" ng-bind="music.type.name"></a></dd><dd><a ng-href="/search?q=%23{{ music.genre.slug }}" ng-bind="music.genre.name"></a></dd></dl><div class="thing-content u-paddingVm u-borderB u-textBreak" ng-if="music.lyric_html" ng-bind-html="music.lyric_html"></div><div class="Box u-marginTl" ng-if="music.published" ng-init="sharingThing = music; sharingThing.$type = \'music\';"><div ng-include="\'views/partials/sharing.html\'"></div></div><ol class="thing-fans u-paddingVm u-borderB" ng-if="music.likers.length > 0"><li class="u-inlineBlock" ng-repeat="user in music.likers | limitTo:10"><a ng-href="/{{ user.name }}"><img class="avatar avatar-small u-marginRs" alt="{{ user.nickname }}" width="30" height="30" dg-image="{{ user.avatars.origin }}"></a></li><li class="u-inlineBlock u-colorGray"><span ng-if="music.likers.length > 10">等</span> <span ng-bind-template="{{ music.likers.length }} 人赞了"></span></li></ol><div class="conversation-outer" ng-if="music.published"><i dg-comment="{{ music.id }}" host-type="music"></i></div></div></div>'),a.put("views/music/progress-bar.html",'<div class="player-progress-area"><div class="player-progress progress-outer"><div class="progress progress-loading" ng-style="{\'width\': percentLoaded + \'%\'}"></div><div class="progress progress-playing" ng-style="{\'width\': percentPlayed + \'%\'}"></div></div></div>'),a.put("views/music/uploading.html",'<div class="streams"><form name="uploadingForm" ng-hide="uploading.objectsTracker.active()" ng-submit="uploading.submit()"><div class="form-field u-cf"><label class="u-pullLeft uploader-cover"><i dg-uploader="" upload-type="image" upload-thing="封面" target-model="uploading.music.cover" upload-folder="covers"><img class="image-original" width="240" height="240" dg-image="{{ uploading.music.cover || uploading.music.covers.origin ||\n                                   \'https://dn-storm-image.qbox.me/default/cover.png\' }}" ng-model="uploading.music.cover"></i> <span class="input-message input-error" ng-if="uploading.errors.cover" ng-bind="uploading.errors.cover.message"></span></label><label class="u-pullLeft"><i dg-uploader="" upload-type="audio" upload-thing="音乐" target-model="uploading.music.audio" upload-folder="music"></i> <span class="input-message input-error" ng-if="uploading.errors.audio" ng-bind="uploading.errors.audio.message"></span></label></div><input type="hidden" name="audio" ng-model="uploading.music.audio" ng-change="uploading.errors.audio = null"><input type="hidden" name="cover" ng-model="uploading.music.cover" ng-change="uploading.errors.cover = null"><label class="form-field">歌名： <span class="input-message input-error" ng-if="uploading.errors.name" ng-bind="uploading.errors.name.message"></span><input name="name" type="text" ng-model="uploading.music.name" ng-change="uploading.errors.name = null"></label><label class="form-field">曲风：<select ng-model="uploading.music.genre.id" ng-options="genre.id as genre.name for genre in uploading.genres"></select></label><label class="form-field">类型：<select ng-model="uploading.music.type.id" ng-options="type.id as type.name for type in uploading.types"></select></label><div class="form-field form-textarea Box--small"><label class="textarea-header Box-header u-bgBlue u-cf" for="lyric">歌词：</label><textarea name="lyric" id="lyric" rows="10" cols="10" ng-model="uploading.music.lyric">\n            </textarea></div><label class="form-field u-borderB"><input name="published" type="checkbox" ng-model="uploading.music.published">公开</label><div class="u-paddingTl"><span class="btn-outer"><button class="btn btn-reverse btn-medium u-paddingHl" type="submit" ng-disabled="uploading.inputTracker.active()">保存</button> <i dg-tracker="uploading" type="input"></i></span></div></form><i dg-tracker="objects"></i></div>'),a.put("views/page/404.html",'<div class="page-404" ng-controller="NavCtrl as nav"><div class="page-404-vertical"><div class="page-404-image"><img class="page-404-image-banner" src="/images/404-banner.60cd5b93.png"> <img src="/images/404-shadow.66fe84f7.png"></div><div><p class="u-fontSizeXXL u-colorBlue">Oops, 页面出错了！</p><p>你可以调整搜索关键词，找到你想要的内容</p><form class="u-marginVm" ng-submit="nav.submit()"><input class="page-404-searchinput u-inlineBlock u-marginRm" name="search" type="text" ng-model="nav.g.searchString"><button class="btn btn-medium btn-reverse u-paddingHl" type="submit">搜索</button></form><p>或 <a href="/">返回首页</a></p></div></div></div>'),a.put("views/page/about.html",'<div class="u-widthDesktop u-alignCenter"><header class="about-header u-paddingLl u-cf"><a class="about-logo u-pullLeft" href="/"><img src="/images/about/logo.e9f19912.png"></a><div class="u-pullRight u-cf"><a class="about-header-link u-block u-pullLeft u-textCenter" href="/about" l42y-match-path="" ng-class="{\'current\': l42y.isPathMatched}">关于合拍</a> <a class="about-header-link u-block u-pullLeft u-textCenter" ng-href="/signup?returnUrl={{ dg.location.host() }}">登录/注册</a></div></header><img class="u-marginBl" src="/images/about/banner.d6bdadb3.png"><div class="about-main" ng-class="{\'u-paddingHl\': !dg.device.isDesktop()}"><div class="u-paddingVl u-marginBl u-borderB"><h2 class="u-fontSizeXXL u-fontNormal u-colorBlue">重新连接每一位音乐人</h2><div class="u-marginTm u-fontSizeL u-marginBl"><p>这是一个只属于音乐和音乐人的社区，没有多余的喧嚣和纷扰。</p><p>音乐是我们共同的纽带，无论何时、何地、何种风格，这里有最懂音乐的听众。</p><p>音乐也是我们最狂热的追求，从结识到合作、从录音到演出，这里让相距千里的梦想一拍即合！</p></div></div><div class="u-paddingTl u-borderB"><h2 class="u-marginBl u-fontSizeXXL u-fontNormal u-colorBlue">在合拍你可以</h2><ul class="u-cf u-marginBl"><li class="u-textCenter u-paddingVl" ng-class="{\'u-pullLeft u-paddingHl u-size1of3\': !dg.device.isPhone()}"><img src="/images/about/badass.928b6b02.png"><h3 class="u-marginVm u-fontNormal u-fontSizeXL u-colorBlue">遇见贵人，请教大牛</h3><div class="u-fontSizeL u-textLeft">这里有行业的从业人士，只要敢秀，就能换得录音，演出，签约的机会！ 这里也有玩转乐器的各路大牛，只要敢问，就会让你获益匪浅。</div></li><li class="u-textCenter u-paddingVl" ng-class="{\'u-pullLeft u-paddingHl u-size1of3\': !dg.device.isPhone()}"><img src="/images/about/friends.d0980fb9.png"><h3 class="u-marginVm u-fontNormal u-fontSizeXL u-colorBlue">结识伙伴，交流创作</h3><div class="u-fontSizeL u-textLeft">不管身处哪个城市、玩着什么风格，这里总有你的同道中人！ 交流学习，共同协作，这才是玩儿音乐的乐趣。</div></li><li class="u-textCenter u-paddingVl" ng-class="{\'u-pullLeft u-paddingHl u-size1of3\': !dg.device.isPhone()}"><img src="/images/about/fans.cfefacdb.png"><h3 class="u-marginVm u-fontNormal u-fontSizeXL u-colorBlue">赢得歌迷，崭露头角</h3><div class="u-fontSizeL u-textLeft">只要你的音乐够酷，就会出现在合拍推荐首页、音乐人攻略和各大媒体网站！ 让更多人听到，吸引更多的歌迷，从此开始你的音乐生涯。</div></li></ul></div><div class="u-paddingVl"><h3 class="u-fontSizeXXL u-fontNormal u-colorBlue">玩转合拍</h3><ul class="u-cf" ng-class="{\'u-textCenter\': !dg.device.isDesktop()}"><li class="u-paddingTl u-marginTl u-paddingHl u-borderB u-cf"><div ng-class="{\'u-pullLeft u-size2of5\': !dg.device.isPhone()}"><h3 class="u-fontSizeXL u-fontNormal u-colorBlue">上传音乐</h3><div class="u-fontSizeL" ng-class="{\'u-marginVm\': dg.device.isPhone()}">不论原创、翻唱、改编、混音，上传封面、选择风格、添加歌词，轻松建立你的音乐名片！</div></div><img src="/images/about/music.5d5f23b3.png" ng-class="{\'u-pullRight\': !dg.device.isPhone()}"></li><li class="u-paddingTl u-marginTl u-paddingHl u-borderB u-cf"><div ng-class="{\'u-pullRight u-size2of5\': !dg.device.isPhone()}"><h3 class="u-fontSizeXL u-fontNormal u-colorBlue">发布信息</h3><div class="u-fontSizeL" ng-class="{\'u-marginVm\': dg.device.isPhone()}">组建乐队、演出签约、二手乐器、词曲交易，点点鼠标就有你想要的！</div></div><img src="/images/about/post.24f7da60.png" ng-class="{\'u-pullLeft\': !dg.device.isPhone()}"></li><li class="u-paddingTl u-marginTl u-paddingHl u-borderB u-cf"><div ng-class="{\'u-pullLeft u-size2of5\': !dg.device.isPhone()}"><h3 class="u-fontSizeXL u-fontNormal u-colorBlue">探索推荐</h3><div class="u-fontSizeL" ng-class="{\'u-marginVm\': dg.device.isPhone()}">专业的音乐人社区有最雪亮的眼睛，每日推荐音乐和音乐人，引爆你的原创！</div></div><img src="/images/about/explore.386ed698.png" ng-class="{\'u-pullRight\': !dg.device.isPhone()}"></li><li class="u-paddingTl u-marginTl u-paddingHl u-borderB u-cf"><div ng-class="{\'u-pullRight u-size2of5\': !dg.device.isPhone()}"><h3 class="u-fontSizeXL u-fontNormal u-colorBlue">快速搜索</h3><div class="u-fontSizeL" ng-class="{\'u-marginVm\': dg.device.isPhone()}">电子？嘻哈？摇滚？一个关键字，直达你想要的内容。</div></div><img src="/images/about/search.489a8fd4.png" ng-class="{\'u-pullLeft\': !dg.device.isPhone()}"></li><li class="u-paddingTl u-marginTl u-paddingHl u-borderB u-cf"><div ng-class="{\'u-pullLeft u-size2of5\': !dg.device.isPhone()}"><h3 class="u-fontSizeXL u-fontNormal u-colorBlue">绑定社交帐号</h3><div class="u-fontSizeL" ng-class="{\'u-marginVm\': dg.device.isPhone()}">让你的朋友知道你在合拍，一键分享拓展人脉。</div></div><img src="/images/about/social.58b469a7.png" ng-class="{\'u-pullRight\': !dg.device.isPhone()}"></li><li class="u-paddingTl u-marginTl u-paddingHl u-borderB u-cf"><div ng-class="{\'u-pullRight u-size2of5\': !dg.device.isPhone()}"><h3 class="u-fontSizeXL u-fontNormal u-colorBlue">iPhone、iPad 自适应</h3><div class="u-fontSizeL" ng-class="{\'u-marginVm\': dg.device.isPhone()}">全新的网站设计，在各种设备上都有超凡的浏览体验。</div></div><img src="/images/about/responsive.11c1a50f.png" ng-class="{\'u-pullLeft\': !dg.device.isPhone()}"></li><li class="u-paddingTl u-marginTl u-paddingHl u-borderB u-cf"><div ng-class="{\'u-pullLeft u-size2of5\': !dg.device.isPhone()}"><h3 class="u-fontSizeXL u-fontNormal u-colorBlue">移动 App，随时随地合拍</h3><div class="u-fontSizeL" ng-class="{\'u-marginVm\': dg.device.isPhone()}">捕捉转瞬即逝的创作片段，随时随地接收合拍消息。</div></div><img src="/images/about/coming-soon.f2862b5a.png" ng-class="{\'u-pullRight\': !dg.device.isPhone()}"></li></ul></div></div><footer class="u-marginTl u-paddingBl u-textCenter"><h2 class="u-fontSizeXXL u-fontNormal u-colorBlue">马上加入合拍</h2><div class="u-marginTl"><a class="btn btn-medium btn-reverse btn-widthL u-marginRl" ng-href="/login?returnUrl={{ dg.location.host() }}">登录</a> <a class="btn btn-medium btn-reverse btn-widthL" ng-href="/signup?returnUrl={{ dg.location.host() }}">注册</a></div><p class="u-marginTl">或者你可以， <a href="/">先去逛逛 >></a></p></footer></div>'),a.put("views/page/links.html",'<div class="streams"><div class="u-marginBxxxl"><p class="u-marginBl u-paddingBs u-borderB u-fontSizeM u-fontBold">合拍</p><ul class="u-alignBottom u-fontSizeS"><li class="u-inlineBlock u-marginRxxl"><img class="u-marginBm" src="/images/page/logo120x60.745f6cc2.jpg"><p>logo大小: 120 x 60</p></li><li class="u-inlineBlock u-marginRxxl"><img class="u-marginBm" src="/images/page/logo80x30.a9196adf.jpg"><p>logo大小: 80 x 30</p></li><li class="u-inlineBlock"><p>文字链接: <a href="http://hepaimusic.com/">合拍(hepaimusic.com) 音乐人社区</a></p></li></ul></div><div><p class="u-marginBl u-paddingBs u-borderB u-fontSizeM">友情链接</p><ul class="u-cf"><li class="links-link u-marginRxl u-marginBxl u-inlineBlock" ng-repeat="object in link.objectsWithImage"><a title="{{ object.name }}" ng-href="{{ object.url }}"><img width="84" height="30" dg-image="{{ object.images.origin }}"></a></li></ul><ul class="u-cf u-fontSizeS"><li class="links-link u-marginRxl u-marginBxl u-inlineBlock u-textTruncate" ng-repeat="object in link.objectsWithoutImage"><a title="{{ object.name }}" ng-href="{{ object.url }}" ng-bind="object.name"></a></li></ul></div></div>'),a.put("views/page/services.html",'<article class="Services"><header class="Arrange Arrange--middle Services-header u-cf"><div class="Arrange-sizeFill"><h1 class="Services-logo"><span class="u-isHiddenVisually">音乐孵化器</span></h1></div><div class="Arrange-sizeFit"><a class="Logo--services" href="/" title="合拍"><span class="u-isHiddenVisually">回到首页</span></a></div></header><div class="Services-intro u-cf"><div class="Services-slogan"></div><form class="Services-subscribe" name="subscribeForm" ng-submit="services.subscribe(subscribe)"><label>订阅动态，近距离关注每一个激动人心的时刻： <span class="input-message input-success" ng-if="services.successes.subscribe">订阅成功</span> <span class="input-message input-error" ng-if="services.errors.subscribe.email">{{ services.errors.subscribe.email.message }}</span><input class="u-sm-sizeFull" type="email" name="email" ng-model="subscribe.email" ng-change="services.errors.subscribe.email = null" placeholder="请输入你的邮箱"><button class="btn btn-reverse btn-medium Button--services" type="submit">订阅</button></label></form></div><div class="Services-joining"><h2>成为参与者</h2><h4>不论你在什么城市，规模多大，只要你是以下机构，我们都欢迎你参与</h4><ul class="Grid Services-partners"><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--1"><span class="u-isHiddenVisually">厂牌</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--2"><span class="u-isHiddenVisually">唱片公司</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--3"><span class="u-isHiddenVisually">音乐节</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--4"><span class="u-isHiddenVisually">演出场地</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--5"><span class="u-isHiddenVisually">音乐品牌</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--6"><span class="u-isHiddenVisually">演出主办方</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--7"><span class="u-isHiddenVisually">综艺节目</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--8"><span class="u-isHiddenVisually">视频网站</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--9"><span class="u-isHiddenVisually">排练室</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--10"><span class="u-isHiddenVisually">音乐媒体</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--11"><span class="u-isHiddenVisually">经纪人</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--12"><span class="u-isHiddenVisually">众筹网站</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--13"><span class="u-isHiddenVisually">论坛</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--14"><span class="u-isHiddenVisually">文化投资机构</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--15"><span class="u-isHiddenVisually">音乐园区</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--16"><span class="u-isHiddenVisually">数字音乐网站 App</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--17"><span class="u-isHiddenVisually">品牌广告方</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--18"><span class="u-isHiddenVisually">发行公司</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--19"><span class="u-isHiddenVisually">音乐游戏</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--20"><span class="u-isHiddenVisually">音乐培训</span></li><li class="u-sm-size1of3 u-md-size1of6 u-lg-size1of6 Grid-cell Services-partner Services-partner--21"><span class="u-isHiddenVisually">还有你！(And you!)</span></li></ul></div><form class="Services-contact u-cf" name="contactForm" ng-submit="services.contact(contact)"><h3>联系我们</h3><div class="input-message input-success u-textCenter" ng-class="{\'u-isVisible\': services.successes.contact,\n                       \'u-isInvisible\': !services.successes.contact}">发送成功！</div><div class="u-cf"><label class="u-sm-sizeFull u-pullLeft">名称： <span class="input-message input-error" ng-if="services.errors.contact.name">{{ services.errors.contact.name.message }}</span><input class="u-sizeFull" id="name" type="text" name="name" ng-model="contact.name" ng-change="services.errors.contact.name = null" placeholder="请输入你的名称"></label><label class="u-sm-sizeFull u-pullRight">邮箱： <span class="input-message input-error" ng-if="services.errors.contact.email">{{ services.errors.contact.email.message }}</span><input class="u-sizeFull" type="email" name="email" ng-model="contact.email" ng-change="services.errors.contact.email = null" placeholder="请输入你的邮箱"></label></div><label class="u-sizeFull">简介： <span class="input-message input-error" ng-if="services.errors.contact.content">{{ services.errors.contact.content.message }}</span><textarea class="u-sizeFull" rows="10" cols="30" name="intro" ng-model="contact.content" ng-change="services.errors.contact.content = null" placeholder="请输入你要发送的内容">\n            </textarea></label><div class="u-textCenter"><button class="btn btn-medium btn-reverse Button--services" type="submit">发送</button></div></form><div class="Services-share u-textCenter"><div class="Services-shareInner u-cf"><div class="u-md-sizeFit u-lg-sizeFit"><div class="Services-qr"></div></div><div class="Services-weibo u-md-sizeFitAlt u-lg-sizeFitAlt">扫一扫分享<br>让更多人参与！<br>或<br><a class="Services-weiboButton" target="_blank" ng-href="{{ services.sharingLink }}"><i class="icon-weibo"></i> 分享到微博</a></div></div></div><footer class="Services-footer u-cf"><a class="Services-gaiamagic" href="http://gaiamagic.com" target="_blank"><span class="u-isHiddenVisually">Gaia Magic</span></a><dl class="Services-brands u-cf"><dt class="Services-brandsLabel">旗下品牌</dt><dd><a class="Services-musicianguide" href="http://musicianguide.cn" target="_blank"><span class="u-isHiddenVisually">音乐人攻略</span></a></dd><dd><a class="Services-hepai" href="/"><span class="u-isHiddenVisually">合拍</span></a></dd><dd><a class="Services-youyanchu" href="http://youyanchu.com" target="_blank"><span class="u-isHiddenVisually">有演出</span></a></dd></dl></footer></article>'),a.put("views/partials/activity.html",'<div class="activity" ng-init="thing = object.target;\n              thing.$prev = objects[$index - 1];\n              thing.$next = objects[$index + 1];" ng-controller="ActionCtrl"><div class="u-marginBm u-relative u-cf"><div class="activity-context u-pullLeft" ng-init="actor = object.actors[0]"><a class="u-marginRm u-pullLeft" title="{{ actor.nickname }}" ng-if="actor" target="_blank" ng-href="/{{ actor.name }}"><img class="avatar" alt="{{ actor.nickname }}" width="40" height="40" dg-image="{{ actor.avatars.origin }}"></a><div class="u-pullLeft"><p><a title="{{ actor.nickname }}" ng-if="actor" ng-bind="actor.nickname" target="_blank" ng-href="/{{ actor.name }}"></a> <span ng-if="object.action == \'like\'">赞了一首音乐</span> <span ng-if="object.action == \'create\'">发布了一首音乐</span></p><time class="u-block u-colorGray" datetime="{{ object.created_at }}"></time></div></div><div class="activity-actions"><span class="u-inlineBlock u-colorGray"><i class="icon-headphone"></i> <small ng-bind="object.target.listen_count"></small></span></div></div><div class="thing-outer" ng-include="\'views/partials/thing/music.html\'"></div><div class="action-outer" ng-if="extendedStatus" ng-switch="" on="actionType"><div ng-switch-when="comment"><div class="conversation-outer" dg-comment="{{ actionTarget.id }}" host-type="{{ actionTarget.type }}"></div></div><div ng-switch-when="sharing"><div class="Box u-marginTl" ng-init="sharingThing = actionTarget" ng-include="\'views/partials/sharing.html\'"></div></div></div></div>'),a.put("views/partials/aside.html",'<div class="aside" ng-controller="NavCtrl as nav"><nav class="nav-aside"><form class="nav-item nav-item-search" ng-hide="dg.g.isSearchPage" ng-submit="nav.submit()"><div class="input-outer u-sizeFull"><input class="input-reverse u-sizeFull" id="s" type="text" name="s" ng-model="nav.g.searchString"><button class="icon-search input-icon" type="submit"></button></div></form><ul class="nav" ng-hide="nav.tracker.active()"><li class="nav-item nav-item-user" ng-if="dg.session.currentUser"><a class="nav-item-link u-block u-textTruncate" ng-href="/{{ dg.session.currentUser.name }}" l42y-match-path="" ng-class="{\'nav-current\': l42y.isPathMatched}"><img class="avatar avatar-small u-marginRs" alt="{{ dg.session.currentUser.nickname }}" width="30" height="30" dg-image="{{ dg.session.currentUser.avatars.origin }}"> <span ng-bind="dg.session.currentUser.nickname"></span></a></li><li class="nav-item" ng-if="dg.modernizr.history"><a class="nav-item-link" href="/" l42y-match-path="true" ng-class="{\'nav-current\': l42y.isPathMatched}"><i class="icon-home"></i> 首页</a></li><li class="nav-item" ng-if="!dg.modernizr.history"><a class="nav-item-link" l42y-match-path="true" ng-click="dg.location.url(\'/\')" ng-class="{\'nav-current\': l42y.isPathMatched}"><i class="icon-home"></i> 首页</a></li><li class="nav-item" ng-if="dg.session.currentUser"><a class="nav-item-link" ng-href="/explore" l42y-match-path="true" ng-class="{\'nav-current\': l42y.isPathMatched}"><i class="icon-stats"></i> 探索</a></li><li class="nav-item" ng-if="dg.session.currentUser"><a class="nav-item-link" href="/connect" l42y-match-path="" ng-class="{\'nav-current\': l42y.isPathMatched}"><i class="icon-mail"></i> 通知 / 私信</a></li><li class="nav-item" ng-if="dg.session.currentUser"><a class="nav-item-link" href="/settings/account" l42y-match-path="true" ng-class="{\'nav-current\': l42y.isPathMatched}"><i class="icon-cog"></i> 设置</a></li><li class="nav-item" ng-if="dg.session.currentUser"><a class="nav-item-link" href="/feedback" l42y-match-path="true" ng-class="{\'nav-current\': l42y.isPathMatched}"><i class="icon-edit"></i> 意见反馈</a></li><li class="nav-item" ng-if="dg.session.currentUser"><a class="nav-item-link" ng-click="dg.session.logout()"><i class="icon-exit"></i> 退出登录</a></li><li class="nav-item-btn-signup" ng-if="!dg.session.currentUser"><a class="btn btn-reverse btn-medium u-sizeFull" href="/signup"><i class="icon-person"></i> 注册</a></li><li class="nav-item-login" ng-if="!dg.session.currentUser">已有帐号？ <a href="/login">直接登录</a></li></ul><i dg-tracker="session"></i></nav><div class="nav-aside nav-bottom u-paddingBl"><a class="nav-item-link u-paddingVn" href="/links">友情链接</a> <span class="u-paddingVn u-fontSizeS">© 2013 佛山市盖亚魔力网络有限公司</span> <a class="nav-item-link u-paddingVn u-fontSizeS" target="_blank" ref="nofollow" href="http://www.miitbeian.gov.cn/state/outPortal/loginPortal.action">粤ICP备12059236号-2</a></div></div>'),a.put("views/partials/card/music.html",'<div class="card-main"><a ng-href="/music/{{ music.id }}" target="_blank"><img class="cover" dg-image="{{ music.covers.origin }}" width="220" height="220" alt="{{ music.name }}"></a><header class="card-music u-textTruncate"><a title="{{ music.name }}" class="u-colorWhite" ng-bind="music.name" ng-href="/music/{{ music.id }}" target="_blank"></a> <a class="u-table u-colorBlue" ng-href="/{{ music.user.name }}" target="_blank" ng-bind="music.user.nickname"></a><div class="u-pullRight player"><a class="thing-play-right u-circle icon-outer icon-outer-small" ng-click="dg.player.toggle(music)"><i class="icon-circle"></i> <i class="icon-play" ng-class="{\'icon-pause u-colorBlue\': dg.playbackState.sounds[music.id].state\n                             == dg.playbackState.states.playing}"></i></a></div></header><div class="card-music-bg"></div></div>'),a.put("views/partials/card/post.html",'<div class="card-main card-post"><div class="u-textTruncate"><a class="thing-title" title="{{ post.title }}" ng-href="/posts/{{ post.id }}" target="_blank" ng-bind="post.title"></a></div><div><a class="u-colorGray" ng-href="/{{ post.user.name }}" target="_blank" ng-bind="post.user.nickname"></a></div><div class="card-content"><div ng-bind-html="post.content_html"></div></div></div>'),a.put("views/partials/card/user.html",'<div class="card-main u-textCenter"><a ng-href="/{{ user.name }}" target="_blank"><img class="avatar u-inlineBlock u-marginTs" dg-image="{{ user.avatars.origin }}" width="110" height="110" alt="{{ user.nickname }}"></a><header class="card-section u-textTruncate"><a ng-href="/{{ user.name }}" target="_blank" ng-bind="user.nickname"></a><ul class="list-inline separated u-colorGray"><li ng-if="user.city || user.province"><a ng-href="/search?q=%23{{ user.city.slug || user.province.slug }}" ng-bind="user.city.name || user.province.name"></a></li><li ng-if="user.domains" class="separated" ng-repeat="tag in user.domains"><a ng-href="/search?q=%23{{ tag.slug }}" ng-bind="tag.name"></a></li></ul></header><i class="card-section" dg-follow="user"></i></div>'),a.put("views/partials/comment.html",'<div class="comments"><i dg-new-message="comment" messages="comments" host-id="hostId" host-type="hostType" placeholder="输入新评论"></i><ol class="conversation"><li class="message" ng-repeat="object in comments" ng-controller="ActionCtrl"><article class="u-cf"><header class="thing-highlight"><a title="{{ object.actor.nickname }}" target="_blank" ng-href="/{{ object.actor.name }}"><img class="avatar avatar-medium" alt="{{ object.actor.nickname }}" width="40" height="40" dg-image="{{ object.actor.avatars.origin }}"></a></header><div class="thing-well"><div class="comment-content"><a title="{{ object.actor.nickname }}" target="_blank" ng-href="/{{ object.actor.name }}" ng-bind="object.actor.nickname"></a> <span class="u-colorGray u-fontSizeS">@{{ object.actor.name }}</span><div class="thing-content u-textBreak" ng-bind-html="object.content_html"></div></div><footer class="u-cf"><div class="u-pullLeft"><time class="u-colorGray" datetime="{{ object.created_at }}"></time></div><div class="u-pullRight"><a ng-class="{\'u-marginRm\': object.own}" ng-click="dispatch(\'reply\')">回复</a> <a ng-show="object.own" ng-click="removeComment(object)">删除</a></div></footer></div><div ng-if="extendedStatus"><i dg-new-message="comment" messages="comments" host-id="hostId" host-type="hostType" placeholder="输入新评论"></i></div></article></li></ol></div>'),a.put("views/partials/conversation/message-new.html",'<form name="messageForm" class="form-message form-inline u-cf" ng-submit="addMessage()"><div><textarea name="content" rows="1" cols="100" class="textarea-message-new" ng-model="message.content" placeholder="{{ placeholder }}"></textarea></div><input type="submit" value="发布" class="btn btn-medium btn-reverse u-paddingHl"></form>'),a.put("views/partials/explore-nav.html",'<div class="tabs-outer tabs-4cols" ng-controller="SearchMatchingCtrl as match"><a class="tab" href="/" ng-if="!dg.session.currentUser" ng-class="{\'tab-current\': l42y.isPathMatched}" l42y-match-path="true"><i class="icon-stats"></i> 推荐</a> <a class="tab" href="/explore" ng-if="dg.session.currentUser" ng-class="{\'tab-current\': l42y.isPathMatched}" l42y-match-path="true"><i class="icon-stats"></i> 推荐</a> <a class="tab" href="/search?type=music" ng-class="{\'tab-current\': match.test(\'type\', \'music\')}"><i class="icon-music"></i> 音乐</a> <a class="tab" href="/search?type=user" ng-class="{\'tab-current\': match.test(\'type\', \'user\')}"><i class="icon-person"></i> 用户</a> <a class="tab" href="/search?type=post" ng-class="{\'tab-current\': match.test(\'type\', \'post\')}"><i class="icon-post"></i> 合作信息</a></div>'),a.put("views/partials/explore-recommend.html",'<div class="cards-outer u-cf" infinite-scroll="explore.getObjects()" infinite-scroll-disabled="explore.query.paused" infinite-scroll-distance="1"><div class="cards u-cf"><article class="card" ng-class="{\'card-2x\': object.size == \'large\'}" ng-repeat="object in explore.objects"><div class="card-outer" ng-if="object.target.klass == \'Music\'" ng-init="music = object.target"><div ng-include="\'views/partials/card/music.html\'"></div></div><div class="card-outer" ng-if="object.target.klass == \'User\'" ng-init="user = object.target"><div ng-include="\'views/partials/card/user.html\'"></div></div><div class="card-outer" ng-if="object.target.klass == \'Post\'" ng-init="post = object.target"><div ng-include="\'views/partials/card/post.html\'"></div></div><div class="card-extra u-colorGray" ng-if="object.target.klass == \'Music\' && object.size == \'large\'"><ul class="card-stats u-cf"><li class="card-stat u-textLeft"><i class="icon-thumbs-up"></i> <span ng-bind="object.target.like_count"></span></li><li class="card-stat u-textCenter"><i class="icon-comment"></i> <span ng-bind="object.target.comments_count"></span></li><li class="card-stat u-textRight"><i class="icon-headphone"></i> <span ng-bind="object.target.listen_count"></span></li></ul><dl class="card-section list-inline separated"><dt><dfn>标签</dfn>：</dt><dd ng-bind="object.target.genre.name"></dd><dd ng-bind="object.target.type.name"></dd></dl><dl class="list-inline"><dt><dfn>作者</dfn>：</dt><dd><a ng-href="/{{ object.target.user.name }}" ng-bind="object.target.user.nickname"></a></dd></dl><dl class="card-section card-section-recommend list-inline" ng-if="object.reason"><dd ng-bind="object.reason"></dd></dl></div><div class="card-extra u-colorGray" ng-if="object.target.klass == \'User\' && object.size == \'large\'"><ul class="card-stats u-cf"><li class="card-stat u-textLeft"><i class="icon-music"></i> <span ng-bind="object.target.music_count"></span></li><li class="card-stat u-textCenter"><i class="icon-person"></i> <span ng-bind="object.target.following_count"></span></li><li class="card-stat u-textRight"><i class="icon-people"></i> <span ng-bind="object.target.followers_count"></span></li></ul><dl class="card-section list-inline u-textTruncate" ng-if="object.target.description"><dt><dfn>简介</dfn>：</dt><dd ng-bind="object.target.description"></dd></dl><dl class="card-section card-section-recommend list-inline" ng-if="object.reason"><dd ng-bind="object.reason"></dd></dl></div></article></div><i dg-tracker="objects"></i></div>'),a.put("views/partials/flashing.html","<div ng-class=\"dg.layout.current=='2cols' &&\n              'main-outer flash flash-' + flash.category ||\n              'flash flash-' + flash.category\" ng-repeat=\"flash in dg.flash.messages\"><span ng-bind=\"flash.content\"></span></div>"),a.put("views/partials/follow.html",'<a class="btn btn-small btn-follow" ng-hide="session.currentUser.id == target.id" ng-click="toggleFollow()" ng-class="{\'btn-reverse\': !target.is_following, \'btn-unfollow\': target.is_following}"></a>'),a.put("views/partials/header-1col.html",'<header class="u-marginBl u-textCenter"><a class="logo u-circle u-inlineBlock" href="/"></a></header>'),a.put("views/partials/hint/hint-comment.html",'<p>没有新通知, 去 <a href="/music/new">上传音乐</a> , 获得更多的评论！</p>'),a.put("views/partials/hint/hint-follow.html",'<p>没有新通知, 去 <a href="/music/new">上传音乐</a> , 获得更多关注！</p>'),a.put("views/partials/hint/hint-home.html",'<div><p>你还没有关注任何人，</p><p>快到探索页，发现更多精彩吧！</p><a class="btn btn-medium btn-reverse u-marginTm btn-widthL" href="/explore">进入探索</a></div>'),a.put("views/partials/hint/hint-like.html",'<p>没有新通知, 去 <a href="/music/new">上传音乐</a> , 获得更多的赞！</p>'),a.put("views/partials/hint/hint-messageList.html","<p>没有新通知</p>"),a.put("views/partials/hint/hint-search.html",'<div class="u-textBreak"><i class="icon-eye u-colorBlue"></i> 抱歉，未找到与搜索条件相关的内容</div>'),a.put("views/partials/hint/hint-userActivity.html",'<p>没有更多内容 <span ng-if="dg.session.currentUser.id === ctrl.user.id">, 去 <a href="/explore">赞</a> 更多音乐吧！</span></p>'),a.put("views/partials/hint/hint-userFollow.html","<p>没有更多内容</p>"),a.put("views/partials/hint/hint-userInfo.html",'<div ng-if="dg.session.currentUser.id != ctrl.user.id"><p class="u-colorGray u-textCenter" ng-if="!ctrl.user.personal_page">该用户还没填写详细信息</p><p ng-if="ctrl.user.personal_page" ng-bind-html="ctrl.user.personal_page_html"></p></div><div ng-if="dg.session.currentUser.id == ctrl.user.id"><div ng-if="!ctrl.isEditing"><p class="u-colorGray u-textCenter" ng-if="!ctrl.user.personal_page">马上 <a ng-click="ctrl.editInfo()">编辑详细信息</a>，让别人了解你更多</p><p ng-if="ctrl.user.personal_page" ng-bind-html="ctrl.user.personal_page_html"></p></div></div>'),a.put("views/partials/hint/hint-userMusic.html",'<p>没有更多内容 <span ng-if="dg.session.currentUser.id === ctrl.user.id">, 去 <a href="/music/new">上传音乐</a> 吧！</span></p>'),a.put("views/partials/hint/hint-userPosts.html",'<p>没有更多内容 <span ng-if="dg.session.currentUser.id === ctrl.user.id">, 去 <a href="/posts/new">发布信息</a> 吧！</span></p>'),a.put("views/partials/notification.html",'<div class="u-cf" ng-switch="object.operation"><div class="thing u-cf"><span class="thing-highlight" ng-switch="object.operation"><a ng-href="/{{ object.actor.name }}" ng-click="notification.markAsRead(object.id)" ng-switch-when="follow"><img class="avatar" alt="{{ object.actor.nickname }}" width="30" height="30" dg-image="{{ object.actor.avatars.origin }}"></a> <a ng-href="/{{ object.actor.name }}" ng-switch-default=""><img class="avatar" alt="{{ object.actor.nickname }}" width="30" height="30" dg-image="{{ object.actor.avatars.origin }}"></a></span><div class="thing-well"><span ng-switch="object.operation"><a ng-href="/{{ object.actor.name }}" ng-switch-when="follow" ng-click="notification.markAsRead(object.id)"><span ng-bind="object.actor.nickname"></span></a> <a ng-href="/{{ object.actor.name }}" ng-switch-default=""><span ng-bind="object.actor.nickname"></span></a></span> <span ng-switch-when="message">私信了你： <a ng-href="/connect/message/{{ object.actor.name }}" ng-bind="object.notifiable.content" ng-click="notification.markAsRead(object.id)"></a></span> <span ng-switch-when="follow">关注了你</span> <span ng-switch-when="like" ng-switch="object.notifiable.type">赞了你的 <span ng-switch-when="music">音乐： <a ng-href="/music/{{ object.notifiable.id }}" ng-bind="object.notifiable.content" ng-click="notification.markAsRead(object.id)"></a></span></span> <span ng-switch="object.notifiable.type" ng-switch-when="comment">评论了你的 <span ng-switch-when="music">音乐： <a ng-href="/music/{{ object.notifiable.id }}" ng-bind="object.notifiable.content" ng-click="notification.markAsRead(object.id)"></a></span> <span ng-switch-when="post">合作信息： <a ng-href="/posts/{{ object.notifiable.id }}" ng-bind="object.notifiable.content" ng-click="notification.markAsRead(object.id)"></a></span></span> <span ng-switch-when="mention" ng-switch="object.notifiable.type">在评论中提到了你： <span ng-switch-when="music"><a ng-href="/music/{{ object.notifiable.id }}" ng-bind="object.notifiable.content" ng-click="notification.markAsRead(object.id)"></a></span> <span ng-switch-when="post"><a ng-href="/posts/{{ object.notifiable.id }}" ng-bind="object.notifiable.content" ng-click="notification.markAsRead(object.id)"></a></span></span> <span ng-switch-when="reply" ng-switch="object.notifiable.type">回复了你的评论： <span ng-switch-when="music"><a ng-href="/music/{{ object.notifiable.id }}" ng-bind="object.notifiable.content" ng-click="notification.markAsRead(object.id)"></a></span> <span ng-switch-when="post"><a ng-href="/posts/{{ object.notifiable.id }}" ng-bind="object.notifiable.content" ng-click="notification.markAsRead(object.id)"></a></span></span></div></div></div>'),a.put("views/partials/player-global.html",'<div class="main-outer" ng-init="state = dg.playbackState"><div class="player-current u-cf" ng-show="state.expanded"><a class="thing-highlight" title="{{ state.lastMusic.name }}" ng-href="/music/{{ state.lastMusic.id }}"><img class="cover" alt="state.lastMusic.name" width="80" height="80" dg-image="{{ state.lastMusic.covers.origin }}"></a><div class="u-textTruncate"><a class="thing-title" title="{{ state.lastMusic.name }}" ng-href="/music/{{ state.lastMusic.id }}" ng-bind="state.lastMusic.name"></a> <a class="u-table" title="{{ state.lastMusic.user.nickname }}" ng-href="/{{ state.lastMusic.user.name }}" ng-bind="state.lastMusic.user.nickname"></a></div><a class="player-like icon-outer icon-outer-large" ng-click="dg.like.toggle(state.lastMusic)"><i class="icon-circle"></i> <i class="icon-thumbs-up-small" ng-class="{\'u-colorBlue\': state.lastMusic.liked}"></i></a></div><progress-bar percent-loaded="state.getLastSound().percentLoaded" percent-played="state.getLastSound().percentPlayed" on-seek="dg.player.seek(percentOffset)"></progress-bar><div class="player-actions u-cf"><div class="player-controls u-pullLeft"><a class="player-play icon-outer icon-outer-large" ng-class="{\'player-playing\': state.getLastSound().state\n                         == state.states.playing}" ng-click="dg.player.toggle(state.lastMusic)"><i class="icon-circle"></i> <i class="icon-play" ng-class="{\'icon-pause u-colorBlue\':\n                             state.getLastSound().state ==\n                             state.states.playing}"></i></a></div><div class="u-pullRight"><a class="player-expand icon-outer icon-outer-large" ng-click="state.toggleExpandStatus()"><i class="icon-circle"></i> <i class="icon-list" ng-class="{\'u-colorBlue\': state.expanded}"></i></a></div></div></div>'),a.put("views/partials/publishing.html",'<a class="btn btn-reverse btn-medium" href="/music/new" l42y-match-path="true" ng-hide="l42y.isPathMatched" ng-if="dg.device.isDesktop()"><i class="icon-music"></i>上传音乐</a><a class="btn btn-medium" href="/posts/new" l42y-match-path="true" ng-hide="l42y.isPathMatched"><i class="icon-post"></i>发布信息</a>'),a.put("views/partials/sharing.html",'<div class="Arrange Arrange--middle u-paddingVs u-paddingHm" ng-controller="SharingCtrl as sharing"><span class="Arrange-sizeFit u-inline u-colorGray">分享到：</span> <a class="u-inlineBlock u-marginRm Arrange-sizeFit" target="_blank" ng-href="{{ sharing.getLink(\'tsina\', sharingThing, sharingThing.$type) }}" dg-icon="weibo" icon-size="26"></a> <a class="u-inlineBlock u-marginRm Arrange-sizeFit" target="_blank" ng-href="{{ sharing.getLink(\'douban\', sharingThing, sharingThing.$type) }}" dg-icon="douban" icon-size="26"></a> <a class="u-inlineBlock u-marginRm Arrange-sizeFit" target="_blank" ng-href="{{ sharing.getLink(\'tqq\', sharingThing, sharingThing.$type) }}" dg-icon="tqq" icon-size="26"></a></div>'),a.put("views/partials/taxonomy/category.html",'<dl class="u-borderB u-paddingLm u-cf"><dt class="tag-header"><dfn ng-bind="taxonomy.taxonomyName"></dfn>：</dt><dd class="tag-item" ng-repeat="category in taxonomy.taxonomies"><a class="btn-tag" ng-bind="category.name" ng-click="taxonomy.g.activeCategory = category" ng-class="{\'btn-tag-active\': category.id == taxonomy.g.activeCategory.id}"></a></dd></dl><div ng-if="taxonomy.g.activeCategory"><dl class="u-borderB u-paddingLm u-cf" ng-repeat="group in taxonomy.g.activeCategory.groups"><dt class="tag-header"><dfn ng-bind="group.name"></dfn>：</dt><dd class="tag-item" ng-repeat="tag in group.tags"><a class="btn-tag" ng-bind="tag.name" ng-click="taxonomy.tag.toggle(tag.slug)" ng-class="{\'btn-tag-active\': taxonomy.tag.isActive(tag.slug)}"></a></dd></dl></div>'),a.put("views/partials/taxonomy/tag-group.html",'<dl class="u-paddingLm u-cf"><dt class="tag-header"><dfn ng-bind="taxonomy.taxonomyName"></dfn>：</dt><dd class="tag-item" ng-repeat="tag in taxonomy.taxonomies"><a class="btn-tag" ng-bind="tag.name" ng-click="taxonomy.tag.toggle(tag.slug)" ng-class="{\'btn-tag-active\': taxonomy.tag.isActive(tag.slug)}"></a></dd></dl>'),a.put("views/partials/thing/music.html",'<article class="thing thing-music u-cf"><div class="u-relative u-pullLeft" ng-class="{\'cover-small u-marginRm\': dg.device.isPhone(),\n                   \'cover-medium\': !dg.device.isPhone()}"><a ng-href="/music/{{ thing.id }}" target="_blank"><img class="cover cover-medium" alt="{{ thing.name }}" width="120" height="120" ng-if="!dg.device.isPhone()" dg-image="{{ thing.covers.origin }}"> <img class="cover cover-small" alt="{{ thing.name }}" width="80" height="80" ng-if="dg.device.isPhone()" dg-image="{{ thing.covers.origin }}"></a><div class="player"><a class="thing-play u-circle icon-outer icon-outer-large" ng-click="dg.player.toggle(thing)"><i class="icon-circle"></i> <i class="icon-play" ng-class="{\'icon-pause u-colorBlue\': dg.playbackState.sounds[thing.id].state\n                             == dg.playbackState.states.playing}"></i></a></div></div><div ng-class="{\'thing-well\': !dg.device.isPhone()}"><header class="thing-info thing-separator u-borderB"><div class="u-textTruncate"><a class="thing-title" ng-href="/music/{{ thing.id }}" target="_blank" ng-bind="thing.name"></a></div><div class="u-textTruncate"><a ng-href="/{{ thing.user.name }}" target="_blank" ng-bind="thing.user.nickname"></a></div></header><footer class="thing-actions u-cf" ng-if="thing.published"><a class="btn btn-action btn-large btn-like thing-action" ng-click="dg.like.toggle(thing)" ng-class="{\'btn-unlike\': thing.liked}"><i class="icon-thumbs-up"></i> <small ng-bind="thing.like_count"></small></a> <a class="btn btn-action btn-large thing-action" ng-if="!hideExtraButton" ng-class="{\'btn-highlight\': actionType === \'comment\' && extendedStatus === true}" ng-click="dispatch(\'comment\')"><i class="icon-comment"></i> <span ng-hide="thing.comments_count">评论</span> <small ng-show="thing.comments_count" ng-bind="thing.comments_count"></small></a> <a class="btn btn-action btn-large thing-action" ng-if="!hideExtraButton" ng-class="{\'btn-highlight\': actionType === \'sharing\' && extendedStatus === true}" ng-click="dispatch(\'sharing\')"><i class="icon-share"></i>分享</a></footer></div></article>'),a.put("views/partials/thing/post-excerpt.html",'<article class="thing thing-post u-cf"><div class="thing-info u-borderB"><header class="u-cf"><div class="u-pullLeft"><a class="thing-title" ng-href="/posts/{{ thing.id }}" target="_blank" ng-bind="thing.title"></a><ul class="separated u-colorGray"><li class="u-inline" ng-repeat="tag in thing.tags"><a ng-href="/search?q=%23{{ tag.slug }}" ng-bind="tag.name"></a></li></ul></div></header><div class="thing-content post-content-excerpt u-marginTl u-textBreak" ng-bind="thing.content"></div></div><footer><div class="thing-actions" ng-if="!hideExtraButton"><a class="btn btn-large btn-action thing-action" ng-class="{\'btn-highlight\': actionType === \'comment\' && extendedStatus === true}" ng-click="dispatch(\'comment\', \'post\')"><i class="icon-comment"></i> <span ng-hide="thing.comments_count">评论</span> <small ng-show="thing.comments_count" ng-bind="thing.comments_count"></small></a> <a class="btn btn-action btn-large thing-action" ng-class="{\'btn-highlight\': actionType === \'sharing\' && extendedStatus === true}" ng-click="dispatch(\'sharing\', \'post\')"><i class="icon-share"></i>分享</a></div></footer></article>'),a.put("views/partials/thing/post.html",'<article class="thing thing-post u-cf"><div class="thing-info u-borderB"><header class="u-cf"><div class="u-pullLeft"><a class="thing-title" ng-href="/posts/{{ thing.id }}" target="_blank" ng-bind="thing.title"></a><ul class="separated u-colorGray"><li class="u-inline" ng-repeat="tag in thing.tags"><a ng-href="/search?q=%23{{ tag.slug }}" ng-bind="tag.name"></a></li></ul></div></header><div class="thing-content u-marginTl u-textBreak" ng-bind-html="thing.content_html"></div></div><footer><div class="thing-actions" ng-if="!hideExtraButton"><a class="btn btn-large btn-action thing-action" ng-class="{\'btn-highlight\': actionType === \'comment\' && extendedStatus === true}" ng-click="dispatch(\'comment\', \'post\')"><i class="icon-comment"></i> <span ng-hide="thing.comments_count">评论</span> <small ng-show="thing.comments_count" ng-bind="thing.comments_count"></small></a> <a class="btn btn-action btn-large thing-action" ng-class="{\'btn-highlight\': actionType === \'sharing\' && extendedStatus === true}" ng-click="dispatch(\'sharing\', \'post\')"><i class="icon-share"></i>分享</a></div></footer></article>'),a.put("views/partials/thing/user.html",'<article class="thing thing-user u-cf"><a class="thing-highlight" ng-href="/{{ thing.name }}" target="_blank"><img class="avatar" width="40" height="40" dg-image="{{ thing.avatars.origin }}"></a> <i class="u-pullRight" dg-follow="thing"></i><div class="thing-info"><a ng-href="/{{ thing.name }}" target="_blank" ng-bind="thing.nickname"></a><dl class="list-inline"><dt ng-if="thing.city || thing.province"><dfn>地区</dfn>：</dt><dd ng-if="thing.city || thing.province"><a ng-href="/search?q=%23{{ thing.city.slug || thing.province.slug }}" ng-bind="thing.city.name || thing.province.name"></a></dd></dl><dl class="thing-user-domains-separated list-inline"><dt ng-if="thing.identity || thing.domains"><dfn>身份</dfn>：</dt><dd ng-if="thing.identity && !thing.domains.length>0"><a ng-href="/search?q=%23{{ thing.identity.slug }}" ng-bind="thing.identity.name"></a></dd><dd ng-if="thing.domains" ng-repeat="tag in thing.domains"><a ng-href="/search?q=%23{{ tag.slug }}" ng-bind="tag.name"></a></dd></dl></div></article>'),a.put("views/partials/tracker/input.html",'<div class="tracker-input"><i class="tracker-spinner" ng-show="tracker.active()" ng-show="!isHidden"></i> <span class="icon-ok-circle u-colorGreen" ng-show="onSuccess"></span> <span class="icon-cancel-circle u-colorRed" ng-show="onFailure"></span></div>'),a.put("views/partials/tracker/objects.html",'<div class="tracker" ng-hide="isHidden"><i class="tracker-spinner spinner" ng-show="tracker.active()"></i><div class="tracker-notice" ng-show="onLastPage">已经到最后一页啦</div></div>'),a.put("views/partials/tracker/session.html",'<div class="tracker" ng-hide="isHidden"><i class="tracker-spinner spinner" ng-show="tracker.active()"></i></div>'),a.put("views/partials/uploading/dragndrop.html",'<div class="uploading"><div class="uploading-dnd u-cf" dg-uploader-dnd=""><div ng-transclude="" ng-show="uploadState==\'normal\'"></div><div class="uploading-info"><div class="uploading-message" ng-if="uploadType == \'audio\'"><div class="uploading-icon" ng-class="\'uploading-icon-\' + uploadType"></div></div><div class="uploading-message-outer u-isHidden" ng-show="uploadState==\'normal\'"><div class="uploading-message-bg"></div><div class="uploading-message"><span class="u-colorGray"><span ng-if="supportFeatures.dragndrop">将文件拖放到这里或</span> 点击下方的按钮上传文件</span><p class="u-colorGray" ng-if="uploadType == \'image\'">请上传尺寸大于 240x240 的图片</p></div></div><div class="progress-outer uploading-progress" ng-show="uploadState==\'uploading\'"><div class="progress"></div><div class="progress progress-playing" ng-style="{\'width\': percentUploaded}"></div></div><span class="uploading-message u-colorGray" ng-if="uploadState==\'success\' || uploadState==\'failed\'"><div class="uploading-message-success" ng-if="uploadState==\'success\'"><div class="uploading-icon"></div><span ng-bind-template="{{ uploadThing }}上传成功！"></span></div><div class="uploading-message-fail" ng-if="uploadState==\'failed\'"><div class="uploading-icon uploading-icon-fail"></div><span ng-bing-template="{{ uploadThing }}上传失败，请重新上传"></span></div></span></div></div><div class="uploading-select"><a class="btn btn-medium btn-reverse" ng-hide="uploadState==\'uploading\'" ng-bind-template="上传{{ uploadThing }}"></a> <span class="btn btn-medium" ng-if="uploadState==\'uploading\'" ng-bind-template="上传{{ uploadThing }}中"></span></div></div>'),a.put("views/partials/uploading/insert.html",'<span class="icon-image btn-right"><a ng-hide="uploadState==\'uploading\'">插入图片</a> <span ng-if="uploadState==\'uploading\'">上传图片中 {{percentUploaded}}</span> <span ng-if="uploadState==\'failed\'">失败，请重试上传</span></span>'),a.put("views/partials/user-info.html",'<div class="u-textCenter" itemscope="" itemtype="http://schema.org/Person"><a title="{{ ctrl.user.nickname }}" ng-href="/{{ ctrl.user.name }}"><img class="avatar avatar-large u-marginBm" alt="{{ ctrl.user.nickname }}" width="80" height="80" itemprop="image" dg-image="{{ ctrl.user.avatars.origin }}"><div class="u-fontSizeL u-marginBm" itemprop="name" ng-bind="ctrl.user.nickname"></div></a><div class="u-marginBm" ng-if="ctrl.user"><i dg-follow="ctrl.user"></i> <a class="btn btn-small btn-message u-marginLm" ng-href="/connect/message/{{ ctrl.user.name }}" ng-if="dg.session.currentUser && dg.session.currentUser.id != ctrl.user.id">私信</a></div><div class="u-marginBm" ng-if="ctrl.user"><a class="btn btn-small" href="/settings/profile" ng-if="dg.session.currentUser.id == ctrl.user.id"><i class="icon-profile"></i>更改个人资料</a></div><ul class="separated list-inline"><li ng-if="ctrl.user.city || ctrl.user.province"><a itemprop="addressLocality" ng-if="ctrl.user.city || ctrl.user.province" ng-href="/search?q=%23{{ ctrl.user.city.slug || ctrl.user.province.slug }}" ng-bind="ctrl.user.city.name || ctrl.user.province.name"></a></li><li ng-if="ctrl.user.identity && !ctrl.user.domains.length>0"><a ng-href="/search?q=%23{{ ctrl.user.identity.slug }}" ng-bind="ctrl.user.identity.name"></a></li><li ng-if="ctrl.user.domains" ng-repeat="tag in ctrl.user.domains" class="separated"><a ng-href="/search?q=%23{{ tag.slug }}" ng-bind="tag.name"></a></li></ul><ul class="separated list-inline"><li itemprop="description" ng-if="ctrl.user.description" ng-bind="ctrl.user.description"></li></ul><dl class="separated list-inline"><dt ng-if="ctrl.user.following_count"><dfn>关注</dfn>：</dt><dd ng-if="ctrl.user.following_count"><a ng-href="/{{ ctrl.user.name }}/following" ng-bind="ctrl.user.following_count"></a></dd><dt ng-if="ctrl.user.followers_count"><dfn>粉丝</dfn>：</dt><dd ng-if="ctrl.user.followers_count"><a ng-href="/{{ ctrl.user.name }}/followers" ng-bind="ctrl.user.followers_count"></a></dd><dt ng-if="ctrl.user.music_count"><dfn>音乐</dfn>：</dt><dd ng-if="ctrl.user.music_count"><a ng-href="/{{ ctrl.user.name }}/music" ng-bind="ctrl.user.music_count"></a></dd></dl><ul class="ButtonGroup ButtonGroup--hz u-marginTm"><li class="ButtonGroup-item" ng-if="ctrl.user.sns.weibo"><a class="Button" ng-href="{{ ctrl.user.sns.weibo.link }}" rel="nofollow" target="_blank"><i class="u-inlineBlock" dg-icon="weibo" icon-size="30"></i></a></li><li class="ButtonGroup-item" ng-if="ctrl.user.sns.douban"><a class="Button" ng-href="{{ ctrl.user.sns.douban.link }}" rel="nofollow" target="_blank"><i class="u-inlineBlock" dg-icon="douban" icon-size="30"></i></a></li><li class="ButtonGroup-item" ng-if="ctrl.user.sns.tqq"><a class="Button" ng-href="{{ ctrl.user.sns.tqq.link }}" rel="nofollow" target="_blank"><i class="u-inlineBlock" dg-icon="tqq" icon-size="30"></i></a></li><li class="ButtonGroup-item" ng-if="ctrl.user.website"><a class="Button" itemprop="url" ng-href="{{ ctrl.user.website }}" rel="me nofollow" target="_blank"><i class="u-inlineBlock" dg-icon="link" icon-size="30"></i></a></li></ul></div>'),a.put("views/post/new.html",'<form class="streams" name="postForm" ng-submit="newPost.submit()"><label class="form-field">标题： <span class="input-message input-error" ng-if="newPost.errors.title" ng-bind="newPost.errors.title.message"></span><input class="u-sizeFull" type="text" name="title" ng-model="newPost.post.title" ng-change="newPost.errors.title = null" ng-maxlength="40" placeholder="请输入 40 字以内的标题"></label><div class="form-field form-textarea Box--small"><label class="textarea-header Box-header u-bgBlue" for="content">正文： <span class="input-message input-error" ng-if="newPost.errors.content" ng-bind="newPost.errors.content.message"></span><dg-uploader template-name="insert" upload-type="image" upload-callback="newPost.insertImg(\'content\', url)" upload-folder="posts"></dg-uploader></label><textarea id="content" cols="10" rows="15" name="content" ng-model="newPost.post.content" ng-change="newPost.errors.content = null">\n        </textarea></div><div class="form-field Box u-paddingBn"><dl class="u-borderB u-paddingLm u-cf"><dt class="tag-header"><dfn>分类</dfn>： <span class="input-message input-error" ng-if="newPost.errors.category" ng-bind="newPost.errors.category.message"></span></dt><dd class="tag-item" ng-repeat="category in newPost.categories"><a class="btn-tag" ng-bind="category.name" ng-click="newPost.activeCategory = category;newPost.errors.category = null" ng-class="{\'btn-tag-active\': category.id == newPost.activeCategory.id}"></a></dd></dl><dl class="u-borderB u-paddingLm u-cf" ng-init="group.activeTags = []" ng-repeat="group in newPost.activeCategory.groups"><dt class="tag-header"><dfn ng-bind="group.name"></dfn> <span ng-if="group.multi_selectable">（多选）</span>： <span class="input-message input-error" ng-if="newPost.errors.tags && !group.activeTags.length" ng-bind="newPost.errors.tags.message"></span></dt><dd class="tag-item" ng-repeat="tag in group.tags"><a class="btn-tag" ng-bind="tag.name" ng-init="newPost.taxonomy.initActiveTags(tag, group, newPost.post.tags)" ng-click="newPost.taxonomy.selectTag(tag, group)" ng-class="{\'btn-tag-active\': newPost.taxonomy.isTagActive(tag, group.activeTags)}"></a></dd></dl></div><div class="u-paddingTl"><span class="btn-outer"><button class="btn btn-medium btn-reverse u-paddingHl" type="submit">提交</button> <i dg-tracker="updating" type="input"></i></span></div></form>'),a.put("views/post/post.html",'<div class="streams" ng-if="post"><div class="u-marginBm u-relative u-cf"><div class="activity-context u-pullLeft"><a class="u-pullLeft u-marginRm" title="{{ post.user.nickname }}" ng-href="/{{ post.user.name }}"><img class="avatar" width="40" height="40" dg-image="{{ post.user.avatars.origin }}"></a><div class="u-pullLeft u-colorGray"><p>由 <a title="{{ post.user.nickname }}" ng-bind="post.user.nickname" ng-href="/{{ post.user.name }}"></a> 发布</p><time datetime="{{ post.created_at }}"></time></div></div><div class="activity-actions" ng-if="post.own"><a class="btn btn-small" ng-href="/posts/{{ post.id }}/update">编辑</a></div></div><div class="thing-outer" ng-if="post" ng-init="thing = post; hideExtraButton = true;"><div ng-include="\'views/partials/thing/post.html\'"></div></div><div class="Box u-marginTl" ng-init="sharingThing = post; sharingThing.$type = \'post\';" ng-include="\'views/partials/sharing.html\'"></div><div class="conversation-outer"><i dg-comment="{{ post.id }}" host-type="post"></i></div></div>'),a.put("views/post/posts.html",'<div class="u-marginBl" ng-if="dg.device.isDesktop()"><div ng-include="\'views/home/banner.html\'"></div></div><div class="cards-outer" ng-include="\'views/partials/explore-nav.html\'"></div><div class="cards-outer u-cf" infinite-scroll="posts.getObjects()" infinite-scroll-disabled="posts.query.paused" infinite-scroll-distance="1"><div class="Box u-marginTm" dg-taxonomy="posts/categories" taxonomy-name="分类" ng-include="\'views/partials/taxonomy/category.html\'"></div><div class="cards u-cf"><article class="card" ng-init="post = object" ng-repeat="object in posts.objects"><div ng-include="\'views/partials/card/post.html\'"></div></article></div><i dg-tracker="objects"></i></div>'),a.put("views/search/filter.html",'<div class="tabs-outer tabs-4cols" ng-controller="SearchMatchingCtrl as match"><a class="tab" ng-if="!search.g.searchString" ng-href="{{ dg.session.currentUser ? \'/explore\' : \'/\' }}" ng-class="{\'tab-current\': l42y.isPathMatched}" l42y-match-path="true"><i class="icon-stats"></i> 推荐</a> <a class="tab" ng-if="search.g.searchString" ng-click="match.location.search(\'type\', null);\n                 search.g.activeCategory = null" ng-class="{\'tab-current\': match.test(\'type\')}"><i class="icon-stats"></i> 全部</a> <a class="tab" ng-click="match.location.search(\'type\', \'music\');\n                 search.g.activeCategory = null" ng-class="{\'tab-current\': match.test(\'type\', \'music\')}"><i class="icon-music"></i> 音乐</a> <a class="tab" ng-click="match.location.search(\'type\', \'user\');\n                 search.g.activeCategory = null" ng-class="{\'tab-current\': match.test(\'type\', \'user\')}"><i class="icon-person"></i> 用户</a> <a class="tab" ng-click="match.location.search(\'type\', \'post\');\n                 search.g.activeCategory = null" ng-class="{\'tab-current\': match.test(\'type\', \'post\')}"><i class="icon-post"></i> 合作信息</a></div>'),a.put("views/search/search.html",'<div class="streams" infinite-scroll="search.getObjects()" infinite-scroll-disabled="search.query.paused" infinite-scroll-distance="1"><div ng-include="\'views/search/filter.html\'"></div><form class="u-marginTm" id="searchForm" ng-submit="search.getObjects(true)"><input class="u-sizeFull" id="q" type="text" name="q" placeholder="输入搜索字词并回车" x-webkit-speech="" x-webkit-grammar="builtin:translate" ng-if="!search.isTag()" ng-model="search.g.searchString"><div class="input-search u-cf" ng-if="search.isTag()"><span class="Tag Tag--blue Tag--input u-marginRm u-marginTm" ng-click="search.tag.remove(tag.slug)" ng-repeat="tag in search.tags">{{ tag.name }} <small>x</small></span></div></form><div ng-if="search.type == \'music\'"><div class="Box u-marginTm"><div dg-taxonomy="music/types" taxonomy-name="类型" ng-include="\'views/partials/taxonomy/tag-group.html\'"></div><div class="u-borderT" dg-taxonomy="music/genres" taxonomy-name="曲风" ng-include="\'views/partials/taxonomy/tag-group.html\'"></div></div></div><div ng-if="search.type == \'user\'"><div class="Box u-marginTm" dg-taxonomy="users/identities" taxonomy-name="分类" ng-include="\'views/partials/taxonomy/category.html\'"></div></div><div ng-if="search.type == \'post\'"><div class="Box u-marginTm" dg-taxonomy="posts/categories" taxonomy-name="分类" ng-include="\'views/partials/taxonomy/category.html\'"></div></div><div class="Box u-textCenter u-marginVl u-paddingAxl" ng-if="search.isDataEmpty" ng-init="hintType = \'search\'"><div ng-include="\'views/partials/hint/hint-\' + hintType + \'.html\'"></div></div><div class="u-marginVl" ng-repeat="thing in search.objects" ng-controller="ActionCtrl"><div class="Box u-paddingAm" ng-if="thing.klass == \'User\' || search.type == \'user\'"><div ng-include="\'views/partials/thing/user.html\'"></div></div><div ng-if="thing.klass == \'Post\' || search.type == \'post\'" class="thing-outer"><div ng-include="\'views/partials/thing/post-excerpt.html\'"></div><div class="action-outer" ng-if="extendedStatus" ng-switch="actionType"><div ng-switch-when="comment"><div class="conversation-outer" dg-comment="{{ actionTarget.id }}" host-type="{{ actionTarget.type }}"></div></div><div ng-switch-when="sharing"><div class="Box u-marginTl" ng-init="sharingThing = actionTarget; sharingThing.$type = \'post\'" ng-include="\'views/partials/sharing.html\'"></div></div></div></div><div class="thing-outer" ng-if="thing.klass == \'Music\' || search.type == \'music\'"><div ng-include="\'views/partials/thing/music.html\'"></div><div class="action-outer" ng-if="extendedStatus" ng-switch="actionType"><div ng-switch-when="comment"><div class="conversation-outer" dg-comment="{{ actionTarget.id }}" host-type="{{ actionTarget.type }}"></div></div><div ng-switch-when="sharing"><div class="Box u-marginTl" ng-init="sharingThing = actionTarget" ng-include="\'views/partials/sharing.html\'"></div></div></div></div></div><i ng-if="!search.isDataEmpty" dg-tracker="objects"></i></div>'),a.put("views/setting/account.html",'<div class="streams"><form class="form-field u-borderB u-paddingTm" name="notifForm" ng-submit="setting.submitNotif()">邮件通知设置：<label class="input-outer"><input class="u-marginRs" type="checkbox" name="followed_notification" ng-model="setting.notification.followed_notification">新的关注</label><label class="input-outer"><input class="u-marginRs" type="checkbox" name="message_notification" ng-model="setting.notification.message_notification">新的私信</label><label class="input-outer"><input class="u-marginRs" type="checkbox" name="comment_notification" ng-model="setting.notification.comment_notification">新的评论</label><button class="btn btn-medium btn-reverse u-marginTm" type="submit">更改邮件通知设置</button></form><form class="form-field u-borderB u-paddingTm" name="nameForm" ng-submit="setting.submit(\'name\')"><label>个性域名： <span class="input-message input-error" ng-if="setting.errors.name" ng-bind="setting.errors.name.message"></span><div class="input-outer"><input id="name" type="text" name="name" ng-model="setting.user.name" ng-change="setting.errors.name = null" ng-required="true"></div></label><label class="u-colorGray" for="name" ng-bind-template="{{ dg.location.host() }}/{{ setting.user.name }}"></label><button class="btn btn-medium btn-reverse" type="submit">更改个性域名</button></form><form class="form-field u-borderB u-paddingTm" name="emailForm" ng-submit="emailForm.$valid && setting.submit([\'email\',\'current_password\'])"><label>更改邮箱： <span class="input-message input-error" ng-if="setting.errors.email" ng-bind="setting.errors.email.message"></span><div class="input-outer"><input type="email" name="email" placeholder="请输入新邮箱" ng-model="setting.user.email" ng-change="setting.errors.email = null"></div></label><div ng-show="emailForm.$dirty"><label class="input-outer">当前密码： <span class="input-message input-error" ng-if="setting.errors.current_password" ng-bind="setting.errors.current_password.message"></span><input type="password" name="current_password" ng-model="setting.user.current_password" ng-change="setting.errors.current_password = null" placeholder="验证当前密码后即可更改邮箱"></label><div class="u-paddingTl"><button class="btn btn-medium btn-reverse" type="submit">更改邮箱</button></div></div></form><form class="form-field u-paddingTm" name="passwordForm" ng-submit="setting.submit([\'password\',\'password_confirmation\',\'current_password\'])"><label>更改密码： <span class="input-message input-error" ng-if="setting.errors.password" ng-bind="setting.errors.password.message"></span><div class="input-outer"><input type="password" name="password" ng-model="setting.user.password" ng-change="setting.errors.password = null" placeholder="请输入新密码"></div></label><div ng-show="passwordForm.$dirty"><label class="input-outer">确认新密码： <span class="input-message input-error" ng-if="setting.errors.password_confirmation" ng-bind="setting.errors.password_confirmation.message"></span><input type="password" name="password_confirmation" ng-model="setting.user.password_confirmation" ng-change="setting.errors.password = null" placeholder="再次输入新密码"></label><label class="input-outer">当前密码： <span class="input-message input-error" ng-if="setting.errors.current_password" ng-bind="setting.errors.current_password.message"></span><input type="password" name="current_password" ng-model="setting.user.current_password" ng-change="setting.errors.current_password = null" placeholder="验证当前密码后即可更改密码"></label><div class="u-paddingTl"><button class="btn btn-medium btn-reverse" type="submit">更改密码</button></div></div></form><i dg-tracker="session"></i></div>'),a.put("views/setting/profile.html",'<div class="streams"><form class="setting" name="profile" ng-submit="setting.submit()"><label class="form-field u-cf u-table"><i dg-uploader="" upload-type="image" upload-folder="avatars" upload-thing="头像" target-model="setting.user.avatar"><img class="image-original" width="240" height="240" dg-image="{{ setting.user.avatar || setting.user.avatars.origin }}" ng-model="setting.user.avatar"></i></label><input class="u-isHidden" type="text" name="avatar" ng-model="setting.user.avatar"><label class="form-field">用户昵称： <span class="input-messages"><span class="input-message input-error" ng-if="setting.errors.nickname" ng-bind="setting.errors.nickname.message"></span></span><div class="input-outer"><input type="text" name="nickname" ng-required="true" ng-model="setting.user.nickname" ng-change="setting.errors.nickname = null"></div></label><label class="form-field">个人网站： <span class="input-messages"><span class="input-message input-error" ng-show="profile.website.$error.url"></span></span><div class="input-outer"><input type="text" name="website" ng-model="setting.user.website"></div></label><label class="form-field">个人简介：<div class="input-outer"><input type="text" name="description" ng-model="setting.user.description"></div></label><div class="form-field user-area"><div class="input-outer">地区：</div><select name="province" ng-model="setting.user.province.id" ng-change="setting.changeProvince(setting.user.province.id, setting.areas);\n                               setting.resetSelectedCity()" ng-options="area.id as area.name\n                                for area in setting.areas"></select><select name="city" ng-if="setting.cities" ng-model="setting.user.city.id" ng-options="city.id as city.name\n                                for city in setting.cities"></select></div><div class="form-field Box u-paddingBn"><dl class="u-borderB u-paddingLm u-cf"><dt class="tag-header"><dfn>身份</dfn>：</dt><dd class="tag-item" ng-repeat="identity in setting.identities"><a class="btn-tag" ng-bind="identity.name" ng-click="setting.changeIdentityClick(identity, setting.identities)" ng-class="{\'btn-tag-active\': identity.id == setting.activeIdentity.id}"></a></dd></dl><dl class="u-borderB u-paddingLm u-cf" ng-repeat="group in setting.activeIdentity.groups"><dt class="tag-header"><dfn ng-bind="group.name"></dfn> <span ng-if="group.multi_selectable">（多选）</span>：</dt><dd class="tag-item" ng-repeat="tag in group.tags"><a class="btn-tag" ng-bind="tag.name" ng-init="setting.taxonomy.initActiveTags(tag, group, setting.user.domains)" ng-click="setting.taxonomy.selectTag(tag, group)" ng-class="{\'btn-tag-active\': setting.taxonomy.isTagActive(tag, group.activeTags)}"></a></dd></dl></div><div class="u-paddingTl u-borderT"><button class="btn btn-medium btn-reverse" type="submit">提交更改</button></div></form><div class="u-marginTl u-marginBs">绑定账号：</div><ul class="list-sns" ng-if="setting.user"><li class="u-paddingVm u-borderB u-cf"><i class="u-inlineBlock u-alignMiddle u-marginRs" dg-icon="weibo" icon-size="20"></i> <a ng-if="!setting.user.sns.weibo" ng-href="/users/auth/weibo" target="_self">绑定新浪微博帐号</a> <span ng-if="setting.user.sns.weibo">已绑定新浪微博帐号 <a class="u-pullRight" ng-href="/accounts/authentications/unbind/weibo" target="_self">取消绑定</a></span></li><li class="u-paddingVm u-borderB u-cf"><i class="u-inlineBlock u-alignMiddle u-marginRs" dg-icon="tqq" icon-size="20"></i> <a ng-if="!setting.user.sns.tqq" ng-href="/users/auth/tqq" target="_self">绑定腾讯微博帐号</a> <span ng-if="setting.user.sns.tqq">已绑定腾讯微博帐号 <a class="u-pullRight" ng-href="/accounts/authentications/unbind/tqq" target="_self">取消绑定</a></span></li><li class="u-paddingVm u-borderB u-cf"><i class="u-inlineBlock u-alignMiddle u-marginRs" dg-icon="douban" icon-size="20"></i> <a ng-if="!setting.user.sns.douban" ng-href="/users/auth/douban" target="_self">绑定豆瓣帐号</a> <span ng-if="setting.user.sns.douban">已绑定豆瓣帐号 <a class="u-pullRight" ng-href="/accounts/authentications/unbind/douban" target="_self">取消绑定</a></span></li></ul><i dg-tracker="objects"></i></div>'),a.put("views/user/auth/login.html",'<form class="streams" name="loginForm" novalidate="" ng-submit="login.submitLogin()"><label class="form-field">邮箱 <span class="input-message input-error" ng-if="login.errors.email" ng-bind="login.errors.email.message"></span><input type="email" ng-model="login.user.email" ng-change="login.errors.email = null"></label><label class="form-field">密码 <span class="input-message input-error" ng-if="signup.errors.password" ng-bind="signup.errors.password"></span><input type="password" ng-model="login.user.password" ng-change="signup.errors.password = null"></label><button class="btn btn-medium btn-reverse u-paddingHl" type="submit">登录</button> <a class="u-colorGray u-fontSizeS u-marginLm btn-medium" href="/password/lost">忘记密码？</a><ul class="list-sns u-marginTl" ng-include="\'views/user/auth/social-login.html\'"></ul></form>'),a.put("views/user/auth/lost-password.html",'<div class="Layout--1col"><div ng-include="\'views/partials/header-1col.html\'"></div><div class="Box Box--large"><div class="Box-header u-fontSizeXL u-paddingVm">忘记密码</div><form class="Box-item" ng-if="!lost.submitSucceed" ng-submit="lost.submit(lost.email)">我们将向你的注册邮箱发送确认邮件，点击邮件中的链接，确认邮件。<label class="u-marginTs">邮箱： <span class="input-message input-error" ng-if="lost.errors.email" ng-bind="lost.errors.email.message"></span><input type="email" name="email" placeholder="请输入注册邮箱" ng-model="lost.email" ng-change="lost.errors.email = null"></label><button class="btn btn-reverse btn-medium u-marginTl u-paddingHl">发送邮件</button></form><div class="Box-item" ng-if="lost.submitSucceed"><div class="u-borderB u-marginBl">重置密码邮件已经发送到 {{ lost.email }}, 请按邮件中的指引重置你的密码。<br><a class="btn btn-reverse btn-medium u-paddingHl u-marginVl" ng-href="{{ lost.getEmailDomain(lost.email) }}" target="_blank">进入邮箱</a></div><p>没有收到？ <a ng-click="lost.submit(lost.email, true)">重新发送</a> <span class="u-colorGray" ng-if="lost.isSubmitAgain">(已重新发送)</span></p><p>邮箱输入错误？ <a ng-click="lost.submitSucceed = false">返回上一步</a> 并重新输入邮箱</p></div><div class="Box-footer u-paddingVs"><a href="/login">返回登录</a></div></div></div>'),a.put("views/user/auth/reset-password.html",'<div class="Layout--1col"><div ng-include="\'views/partials/header-1col.html\'"></div><div class="Box Box--large"><div class="Box-header u-fontSizeXL u-paddingVm">重置密码</div><form class="Box-item" ng-submit="reset.submit(reset.submitModel)"><label class="u-marginBm">新密码： <span class="input-message input-error" ng-if="reset.errors.password" ng-bind="reset.errors.password.message"></span><input type="password" name="password" placeholder="请输入至少 6 个字符长度的新密码" ng-model="reset.submitModel.password" ng-change="reset.errors.password = null" ng-minlength="6"></label><label class="u-marginBl">确认密码：<input type="password" name="password_confirmation" placeholder="请确认你的新密码" ng-model="reset.submitModel.password_confirmation" ng-minlength="6"></label><button class="btn btn-reverse btn-medium u-paddingHl" type="submit">修改密码</button></form></div></div>'),a.put("views/user/auth/signup.html",'<form class="streams" name="signupForm" novalidate="" ng-submit="signup.submitSignup()"><label class="form-field">邮箱 <span class="input-message input-error" ng-if="signup.errors.email" ng-bind="signup.errors.email.message"></span><input type="email" name="email" ng-model="signup.user.email" ng-change="signup.errors.email = null"></label><label class="form-field">昵称 <span class="input-message input-error" ng-if="signup.errors.nickname" ng-bind="signup.errors.nickname.message"></span><input type="text" name="nickname" ng-model="signup.user.nickname" ng-change="signup.errors.nickname = null"></label><label class="form-field">密码 <span class="input-message input-error" ng-if="signup.errors.password" ng-bind="signup.errors.password.message"></span><input type="password" name="password" ng-model="signup.user.password" ng-change="signup.errors.password = null"></label><button class="btn btn-medium btn-reverse u-paddingHl" type="submit">注册</button><ul class="list-sns u-marginTl" ng-include="\'views/user/auth/social-login.html\'"></ul></form>'),a.put("views/user/auth/social-login.html",'<li class="u-paddingVm u-borderB"><i class="icon-weibo"></i> <a href="/users/auth/weibo" target="_self">新浪微博帐号登录</a></li><li class="u-paddingVm u-borderB"><i class="icon-tqq"></i> <a href="/users/auth/tqq" target="_self">腾讯微博帐号登录</a></li><li class="u-paddingVm u-borderB"><i class="icon-douban"></i> <a href="/users/auth/douban" target="_self">豆瓣帐号登录</a></li>'),a.put("views/user/profile/activity.html",'<div class="streams" infinite-scroll="getObjects()" infinite-scroll-disabled="query.paused" infinite-scroll-distance="1" ng-init="ctrl = userActivity"><div class="Box u-paddingVl u-marginBl" ng-if="ctrl.user"><div ng-include="\'views/partials/user-info.html\'"></div></div><div ng-if="ctrl.user"><div ng-include="\'views/user/profile/nav.html\'"></div></div><div class="Box u-textCenter u-marginVl u-paddingAxl" ng-if="isDataEmpty" ng-init="hintType = \'userActivity\'"><div ng-include="\'views/partials/hint/hint-\' + hintType + \'.html\'"></div></div><div class="activities"><div class="activity-outer" ng-repeat="object in objects"><div ng-include="\'views/partials/activity.html\'"></div></div></div><i ng-if="!isDataEmpty" dg-tracker="objects"></i></div>'),a.put("views/user/profile/follow.html",'<div class="streams" infinite-scroll="getObjects()" infinite-scroll-disabled="query.paused" infinite-scroll-distance="1" ng-init="ctrl = userFollow"><div class="Box u-paddingVl u-marginBl" ng-include="\'views/partials/user-info.html\'"></div><div class="tabs-outer tabs-2cols u-cf"><a class="tab" ng-href="/{{ ctrl.user.name }}/following" ng-class="{\'tab-current\': l42y.isPathMatched}" l42y-match-path=""><i class="icon-eye"></i>关注</a> <a class="tab" ng-href="/{{ ctrl.user.name }}/followers" ng-class="{\'tab-current\': l42y.isPathMatched}" l42y-match-path=""><i class="icon-people"></i>粉丝</a></div><div class="Box u-textCenter u-marginVl u-paddingAxl" ng-if="isDataEmpty" ng-init="hintType = \'userFollow\'"><div ng-include="\'views/partials/hint/hint-\' + hintType + \'.html\'"></div></div><div class="activity" ng-repeat="thing in objects"><div class="thing-outer" ng-include="\'views/partials/thing/user.html\'"></div></div><i ng-if="!isDataEmpty" dg-tracker="objects"></i></div>'),a.put("views/user/profile/info.html",'<div class="streams" ng-init="ctrl = userInfo"><div class="Box u-paddingVl u-marginBl" ng-include="\'views/partials/user-info.html\'"></div><div ng-include="\'views/user/profile/nav.html\'"></div><form class="form-field form-textarea Box--small u-marginTl" name="infoForm" ng-submit="userInfo.submit()" ng-show="userInfo.isEditing"><label class="Box-header textarea-header u-bgBlue" for="content">编辑详细信息：<dg-uploader template-name="insert" upload-type="image" upload-callback="ctrl.insertImg(\'content\', url)" upload-folder="user"></dg-uploader></label><textarea id="content" cols="10" rows="15" name="content" ng-model="userInfo.user.personal_page">\n        </textarea><div class="u-paddingTl u-borderT"><button class="btn btn-medium btn-reverse" type="submit">保存</button></div></form><div class="Box Box--small u-marginTl" ng-init="hintType = \'userInfo\'" ng-show="!userInfo.isEditing"><div class="Box-header u-bgBlue u-cf"><span ng-if="ctrl.user.personal_page">详细信息：</span> <a class="u-pullRight" ng-if="dg.session.currentUser.id == ctrl.user.id && ctrl.user.personal_page" ng-click="ctrl.editInfo()"><i class="icon-edit"></i> 编辑详细信息</a></div><div class="u-paddingAm" ng-include="\'views/partials/hint/hint-\' + hintType + \'.html\'"></div></div></div>'),a.put("views/user/profile/music.html",'<div class="streams" infinite-scroll="getObjects()" infinite-scroll-disabled="query.paused" infinite-scroll-distance="1" ng-init="ctrl = userMusic"><div class="Box u-paddingVl u-marginBl" ng-include="\'views/partials/user-info.html\'"></div><div ng-include="\'views/user/profile/nav.html\'"></div><div class="Box u-textCenter u-marginVl u-paddingAxl" ng-if="isDataEmpty" ng-init="hintType = \'userMusic\'"><div ng-include="\'views/partials/hint/hint-\' + hintType + \'.html\'"></div></div><div class="activities"><div class="activity" ng-repeat="object in objects" ng-init="thing = object;\n                      thing.$prev = objects[$index - 1];\n                      thing.$next = objects[$index + 1];" ng-controller="ActionCtrl"><div class="u-marginBm u-relative"><div class="activity-context u-colorGray"><time datetime="{{ object.created_at }}"></time></div><div class="activity-actions"><span class="u-inlineBlock u-colorGray"><i class="icon-headphone"></i> <small ng-bind="object.listen_count"></small></span> <span class="u-paddingLm" ng-if="object.own"><a class="btn btn-small" ng-if="!object.published" ng-click="userMusic.music.publish(object)">公开</a> <a class="btn btn-small" ng-if="dg.device.isDesktop()" ng-href="/music/{{ object.id }}/update">编辑</a> <a class="btn btn-small" ng-click="userMusic.music.remove(object, objects, \'music\')">删除</a></span></div></div><div class="thing-outer" ng-include="\'views/partials/thing/music.html\'"></div><div class="action-outer" ng-if="extendedStatus" ng-switch="" on="actionType"><div ng-switch-when="comment"><div class="conversation-outer" dg-comment="{{ actionTarget.id }}" host-type="{{ actionTarget.type }}"></div></div><div ng-switch-when="sharing"><div class="Box u-marginTl" ng-init="sharingThing = actionTarget" ng-include="\'views/partials/sharing.html\'"></div></div></div></div></div><i ng-if="!isDataEmpty" dg-tracker="objects"></i></div>'),a.put("views/user/profile/nav.html",'<div class="tabs-outer tabs-4cols u-cf"><a class="tab" ng-href="/{{ ctrl.user.name }}" ng-class="{\'tab-current\': l42y.isPathMatched}" l42y-match-path="true"><i class="icon-stats"></i>动态</a> <a class="tab" ng-href="/{{ ctrl.user.name }}/music" ng-class="{\'tab-current\': l42y.isPathMatched}" l42y-match-path=""><i class="icon-music"></i>音乐</a> <a class="tab" ng-href="/{{ ctrl.user.name }}/posts" ng-class="{\'tab-current\': l42y.isPathMatched}" l42y-match-path=""><i class="icon-post"></i>合作信息</a> <a class="tab" ng-href="/{{ ctrl.user.name }}/info" ng-class="{\'tab-current\': l42y.isPathMatched}" l42y-match-path=""><i class="icon-profile"></i>详细信息</a></div>'),a.put("views/user/profile/post.html",'<div class="streams" infinite-scroll="userPosts.getObjects()" infinite-scroll-disabled="userPosts.query.paused" infinite-scroll-distance="1" ng-init="ctrl = userPosts"><div class="Box u-paddingVl u-marginBl" ng-include="\'views/partials/user-info.html\'"></div><div ng-include="\'views/user/profile/nav.html\'"></div><div class="Box u-textCenter u-marginVl u-paddingAxl" ng-if="userPosts.isDataEmpty" ng-init="hintType = \'userPosts\'"><div ng-include="\'views/partials/hint/hint-\' + hintType + \'.html\'"></div></div><div class="activities"><div class="activity" ng-repeat="object in userPosts.objects" ng-init="thing = object;" ng-controller="ActionCtrl"><div class="u-marginBm u-relative"><div class="activity-context u-colorGray"><time datetime="{{ object.created_at }}"></time></div><div class="activity-actions u-pullRight" ng-if="object.own"><a class="btn btn-small" ng-href="/posts/{{ object.id }}/update">编辑</a> <a class="btn btn-small" ng-click="userPosts.actions.remove(object, userPosts.objects, \'post\')">删除</a></div></div><div class="thing-outer" ng-include="\'views/partials/thing/post.html\'"></div><div class="action-outer" ng-if="extendedStatus" ng-switch="" on="actionType"><div ng-switch-when="comment"><div class="conversation-outer" dg-comment="{{ actionTarget.id }}" host-type="{{ actionTarget.type }}"></div></div><div ng-switch-when="sharing"><div class="Box u-marginTl" ng-init="sharingThing = actionTarget; sharingThing.$type = \'post\'" ng-include="\'views/partials/sharing.html\'"></div></div></div></div></div><i ng-if="!userPosts.isDataEmpty" dg-tracker="objects"></i></div>'),a.put("views/user/users.html",'<div class="u-marginBl" ng-if="dg.device.isDesktop()"><div ng-include="\'views/home/banner.html\'"></div></div><div class="cards-outer" ng-include="\'views/partials/explore-nav.html\'"></div><div class="cards-outer u-cf" infinite-scroll="users.getObjects()" infinite-scroll-disabled="users.query.paused" infinite-scroll-distance="1"><div class="Box u-marginTm" dg-taxonomy="users/identities" taxonomy-name="分类" ng-include="\'views/partials/taxonomy/category.html\'"></div><div class="cards u-cf"><article class="card" ng-init="user = object" ng-repeat="object in users.objects"><div ng-include="\'views/partials/card/user.html\'"></div></article></div><i dg-tracker="objects"></i></div>'),a.put("views/wizard/profile.html",'<div class="wizard-outer Layout--1col"><div ng-include="\'views/partials/header-1col.html\'"></div><div class="u-paddingVxl u-paddingHxl Box u-cf"><form name="profile" ng-submit="wizard.submit()"><div class="u-cf"><div class="wizard-profile-avatar u-pullLeft u-paddingTm u-marginRxxl u-marginTl u-textCenter"><label class="form-field u-table"><i dg-uploader="" upload-type="image" upload-folder="avatars" upload-thing="头像" target-model="wizard.user.avatar"><img dg-image="{{ wizard.user.avatar || wizard.user.avatars.origin }}" width="160" height="160" ng-model="wizard.user.avatar"></i></label><input type="hidden" name="avatar" ng-model="wizard.user.avatar"><span class="u-colorGray u-fontSizeS u-inlineBlock avatar-info">支持JPG/PNG/GIF格式。</span></div><div class="u-pullLeft wizard-profile-info"><label class="form-field">昵称： <span class="input-message input-error" ng-if="wizard.errors.nickname" ng-bind="wizard.errors.nickname.message"></span><div class="input-outer"><input type="text" name="nickname" ng-model="wizard.user.nickname" ng-required="true"></div></label><label class="form-field">用户名： <span class="input-message input-error" ng-if="wizard.errors.name" ng-bind="wizard.errors.name.message"></span><div class="input-outer"><span class="u-colorGray name-icon">@</span><input type="text" name="name" class="name-input" ng-model="wizard.user.name" ng-required="true"></div><span class="u-colorGray">hepaimusic.com/{{wizard.user.name}}</span></label><div class="form-field user-area"><div class="input-outer">地区： <span class="input-message input-error" ng-if="wizard.errors.province" ng-bind="wizard.errors.province.message"></span> <span class="input-message input-error" ng-if="wizard.errors.city" ng-bind="wizard.errors.city.message"></span></div><select name="province" ng-model="wizard.user.province.id" ng-change="wizard.changeProvince(wizard.user.province.id, wizard.areas);\n                                           wizard.resetSelectedCity()" ng-options="area.id as area.name for area in wizard.areas"></select><select name="city" ng-if="wizard.province.cities" ng-model="wizard.user.city.id" ng-options="city.id as city.name for city in wizard.province.cities"></select></div><label class="form-field">一句话简介： <span class="u-colorGray">（50字以内）</span> <span class="input-message input-error" ng-if="wizard.errors.description" ng-bind="wizard.errors.description.message"></span><div class="input-outer"><textarea name="description" class="textarea-desc" rows="2" type="text" ng-model="wizard.user.description">\n                            </textarea></div></label><div class="form-field"><div class="input-outer">身份： <span class="input-message input-error" ng-if="wizard.errors.identity" ng-bind="wizard.errors.identity.message"></span></div><div class="form-choosers u-cf"><label class="btn btn-medium u-paddingHl" ng-class="{\'btn-reverse\': identity.id == wizard.activeIdentity.id}" ng-repeat="identity in wizard.identities"><input type="radio" name="identity" value="{{ identity.id }}" ng-model="wizard.user.identity.id" ng-change="wizard.activeIdentity = wizard.changeIdentity(identity.id, wizard.identities)"><span ng-bind="identity.name"></span></label></div><div class="form-field Box u-paddingBn tag-group" ng-if="wizard.activeIdentity"><dl class="u-borderB u-paddingLm u-cf" ng-repeat="group in wizard.activeIdentity.groups"><dt class="tag-header"><dfn ng-bind="group.name"></dfn> <span ng-if="group.multi_selectable">（多选）</span>：</dt><dd class="tag-item" ng-repeat="tag in group.tags"><a class="btn-tag" ng-bind="tag.name" ng-init="wizard.taxonomy.initActiveTags(tag, group, wizard.user.domains)" ng-click="wizard.taxonomy.selectTag(tag, group)" ng-class="{\'btn-tag-active\': wizard.taxonomy.isTagActive(tag, group.activeTags)}"></a></dd></dl></div></div></div></div><div class="u-paddingTl u-textCenter"><button class="btn btn-medium btn-reverse" type="submit">下一步</button></div></form></div><div></div></div>'),a.put("views/wizard/social.html",'<div class="wizard-outer Layout--1col"><div ng-include="\'views/partials/header-1col.html\'"></div><div class="u-paddingAxl Box"><div class="u-marginBl u-paddingBs u-borderB"><p class="u-fontSizeL u-fontNormal u-marginBs">绑定新浪微博，</p><p class="u-fontSizeL u-fontNormal u-marginBs">找朋友，也让朋友找到你，</p><p class="u-fontSizeL u-fontNormal u-marginBs">让你在音乐领域的精彩在这里开始：</p><p class="u-paddingTs u-marginBl"><a ng-href="/users/auth/weibo?returnUrl={{ dg.location.host() }}/wizard/social" ng-if="!wizardSocial.weiboBound" class="btn btn-medium btn-sns-bind" target="_self"><i class="icon-weibo"></i> 绑定新浪微博</a> <a ng-href="/accounts/authentications/unbind/weibo?returnUrl={{ dg.location.host() }}/wizard/social" ng-if="wizardSocial.weiboBound" class="btn btn-medium u-colorRed" target="_self"><i class="icon-weibo"></i> 已绑定新浪微博</a></p><div class="u-cf u-paddingBs" ng-if="wizardSocial.users.friends"><h3 class="u-fontSizeL u-fontNormal u-pullLeft">你的微博朋友：</h3><label class="u-pullRight u-isActionable">全选<input name="published" type="checkbox" ng-checked="wizardSocial.isAllSeleted(\'friends\')" ng-click="wizardSocial.toggleAll(\'friends\')"></label></div><ul class="wizard-social-user-card-outer" ng-if="wizardSocial.users.friends"><li ng-repeat="user in wizardSocial.users.friends" ng-click="wizardSocial.toggleSelected(\'friends\', user)" class="wizard-social-user-card Box u-inlineBlock u-paddingAm"><article><header class="thing-highlight u-block avatar-medium"><img dg-image="{{ user.avatars.origin }}" class="avatar avatar-medium u-inlineBlock u-borderA u-alignTop" width="50" height="50"></header></article><div class="thing-well"><p class="wizard-social-user-card-desc">{{user.nickname}}</p><dl class="wizard-social-user-card-desc list-inline u-textTruncate"><dd ng-if="user.city || user.province">{{user.city.name || user.province.name}}</dd><dd ng-if="user.city || user.province">/</dd><dd>{{user.identity.name}}</dd></dl><i class="wizard-social-selected u-fontSizeL u-colorBlue icon-ok-circle" ng-hide="wizardSocial.isNotSelected(\'friends\', user)"></i></div></li></ul></div><div class="u-cf u-paddingBs" ng-if="wizardSocial.users.recommended"><h3 class="u-fontSizeL u-fontNormal u-pullLeft">我们为你推荐：</h3><label class="u-pullRight u-isActionable">全选<input name="published" type="checkbox" ng-checked="wizardSocial.isAllSeleted(\'recommended\')" ng-click="wizardSocial.toggleAll(\'recommended\')"></label></div><ul class="wizard-social-user-card-outer" ng-if="wizardSocial.users.recommended"><li ng-repeat="user in wizardSocial.users.recommended" ng-click="wizardSocial.toggleSelected(\'recommended\', user)" class="wizard-social-user-card Box u-inlineBlock u-paddingAm"><article><header class="thing-highlight u-block avatar-medium"><img dg-image="{{ user.avatars.origin }}" class="avatar avatar-medium u-inlineBlock u-borderA u-alignTop" width="50" height="50"></header></article><div class="thing-well"><p class="wizard-social-user-card-desc">{{user.nickname}}</p><dl class="wizard-social-user-card-desc list-inline u-textTruncate"><dd ng-if="user.city || user.province">{{user.city.name || user.province.name}}</dd><dd ng-if="user.city || user.province">/</dd><dd>{{user.identity.name}}</dd></dl><i class="wizard-social-selected u-fontSizeL u-colorBlue icon-ok-circle" ng-hide="wizardSocial.isNotSelected(\'recommended\', user)"></i></div></li></ul><div class="u-textCenter u-marginTl"><a ng-click="wizardSocial.followThem()" class="btn btn-reverse btn-medium">关注并完成</a> <a href="/explore" class="wizard-skip-social u-colorGray u-fontSizeS btn-medium">跳过这一步，开始探索</a></div></div><div></div></div>')
}]),a.module("dgWizard",["dgWizardProfile","WizardSocial"]),a.module("dgWizardProfile",[]).controller("WizardProfileCtrl",["$location","Session","Taxonomy","Restangular","UserRestangular",function(b,c,d,e,f){var g=this;g.taxonomy=d,g.changeProvince=function(a,b){g.province=_.find(b,{id:a})},g.resetSelectedCity=function(){g.user&&(g.user.city=_.first(g.province.cities))},g.changeIdentity=function(a,b){var c=_.find(b,{id:a});return g.taxonomy.deactiveTags(c,b)};var h=e.all("areas").getList(),i=e.all("users/identities").getList();c.requestCurrentUser().then(function(a){return g.user=a,h.then(function(b){g.areas=b,a.province&&(g.province=_.find(b,{id:a.province.id}))}),i.then(function(b){g.identities=b,a.identity&&(g.activeIdentity=_.find(b,{id:a.identity.id}))}),a}),g.submit=function(){var c;g.activeIdentity&&(c=d.getTagIds(g.activeIdentity.groups));var e={avatar:g.user.avatar,nickname:g.user.nickname,name:g.user.name,description:g.user.description,province_id:g.user.province?g.user.province.id:null,city_id:g.user.city?g.user.city.id:null,identity_id:g.user.identity?g.user.identity.id:null,domain_ids:c},h=f.one("user");a.extend(h,e),h.put().then(function(){b.path("/wizard/social")},function(a){window.scrollTo(0,0),g.errors=a.data.errors})}}]),a.module("WizardSocial",[]).controller("WizardSocialCtrl",["$location","$routeParams","Flash","Session","Restangular",function(b,c,d,e,f){var g=this;g.selectedIds={friends:[],recommended:[]},g.users={friends:[],recommended:[]},"1"===c.success?c.connected?d.pushMessage("绑定新浪微博成功","success"):c.disconnected&&d.pushMessage("解除绑定新浪微博成功","success"):"0"===c.success&&d.pushMessage("绑定新浪微博失败","warning"),e.requestCurrentUser().then(function(a){g.weiboBound=!!a.sns.weibo,g.weiboBound&&f.all("user/weibo_friends").getList().then(function(a){g.users.friends=a,g.toggleAll("friends")})}),f.all("users/recommended").getList().then(function(a){g.users.recommended=a,g.toggleAll("recommended")}),g.toggleSelected=function(a,b){if(g.isNotSelected(a,b))g.selectedIds[a].push(b.id);else{var c=g.selectedIds[a].indexOf(b.id);g.selectedIds[a].splice(c,1)}},g.isNotSelected=function(a,b){return-1===g.selectedIds[a].indexOf(b.id)},g.toggleAll=function(b){g.isAllSeleted(b)?g.selectedIds[b]=[]:a.forEach(g.users[b],function(a){g.isNotSelected(b,a)&&g.selectedIds[b].push(a.id)})},g.isAllSeleted=function(a){return g.users[a].length===g.selectedIds[a].length},g.followThem=function(){var a=g.selectedIds.recommended.concat(g.selectedIds.friends);if(a.length){var c=f.one("user/following/batch");c.ids=a,c.put().then(function(){b.path("/")})}else b.path("/")}}])}(window.angular);